# Модуль управления параметрами Fast API сервера

## Обзор

Модуль `src.fast_api.main` предназначен для управления Fast API серверами через командную строку. Он предоставляет интерфейс для запуска, остановки, просмотра статуса и настройки маршрутов серверов.

## Подробнее

Этот модуль предоставляет основную точку входа для управления серверами Fast API. Он включает в себя функцию `main`, которая запускает цикл обработки команд, позволяющий пользователю взаимодействовать с серверами через консоль. Модуль использует класс `CommandHandler` из `src.fast_api.fast_api` для выполнения фактических операций с серверами.

## Функции

### `display_menu`

```python
def display_menu():
    """Выводит меню с доступными командами."""
    ...
```

**Назначение**:
Выводит в консоль список доступных команд для управления серверами.

**Параметры**:
- Отсутствуют

**Возвращает**:
- Ничего

**Вызывает исключения**:
- Отсутствуют

**Как работает функция**:

1. Функция выводит в консоль перечень доступных команд и их описание.

2. Функция не выполняет никаких действий, кроме вывода текста.

**Примеры**:

```python
display_menu()
```

### `main`

```python
def main():
    """Основная функция управления сервером."""
    ...
```

**Назначение**:
Основная функция, управляющая жизненным циклом серверов Fast API.

**Параметры**:
- Отсутствуют

**Возвращает**:
- Ничего

**Вызывает исключения**:
- `ValueError`: Если введен некорректный номер порта.
- `Exception`: При возникновении других ошибок в процессе выполнения команд.

**Внутренние функции**:
- Отсутствуют

**Как работает функция**:

1. **Инициализация:** Создается экземпляр класса `CommandHandler`, который используется для выполнения команд управления серверами.
2. **Главный цикл:** Функция входит в бесконечный цикл, который позволяет пользователю вводить команды для управления серверами.
3. **Вывод меню:** На каждой итерации цикла вызывается функция `display_menu`, которая отображает список доступных команд.
4. **Ввод команды:** Пользователь вводит команду через консоль. Ввод преобразуется к нижнему регистру и разделяется на части.
5. **Обработка команд:** В зависимости от введенной команды, выполняются следующие действия:
   - `start`: Запускает сервер на указанном порту. Запрашивает у пользователя адрес хоста.
   - `status`: Отображает статус всех серверов.
   - `routes`: Отображает все зарегистрированные маршруты.
   - `stop`: Останавливает сервер на указанном порту.
   - `stop_all`: Останавливает все запущенные серверы.
   - `add_route`: Добавляет новый маршрут к серверу. Запрашивает у пользователя HTTP методы.
   - `shutdown`: Останавливает все серверы и завершает работу программы.
   - `help`: Выводит меню с доступными командами.
   - `exit`: Завершает работу программы.
   - Если введена неизвестная команда, выводится сообщение об ошибке.
6. **Обработка ошибок:** Если в процессе выполнения команды возникает исключение, оно перехватывается, и информация об ошибке записывается в лог с использованием `logger.error`.
7. **Завершение работы:** Цикл продолжается до тех пор, пока пользователь не введет команду `exit` или `shutdown`.

**Примеры**:

```python
# Запуск сервера на порту 8000
Enter command: start 8000
Enter host address (default: 127.0.0.1): 

# Просмотр статуса серверов
Enter command: status

# Остановка сервера на порту 8000
Enter command: stop 8000

# Завершение работы программы
Enter command: exit
```

## ASCII flowchart для `main`

```
Начало
   │
   │
   ▼
Создание CommandHandler
   │
   │
   ▼
Главный цикл (while True)
   │
   │
   ▼
Вывод меню (display_menu)
   │
   │
   ▼
Ввод команды
   │
   │
   ▼
Разбор команды
   │
   │
   ▼
Выполнение команды
   │
   ├── start ── Запуск сервера
   │   │
   │   └── Ввод порта и хоста
   │
   ├── status ── Отображение статуса
   │
   ├── routes ── Отображение маршрутов
   │
   ├── stop ── Остановка сервера
   │   │
   │   └── Ввод порта
   │
   ├── stop_all ── Остановка всех серверов
   │
   ├── add_route ── Добавление маршрута
   │   │
   │   └── Ввод пути и методов
   │
   ├── shutdown ── Остановка и выход
   │
   ├── help ── Вывод меню
   │
   └── exit ── Выход
   │
   │
   ▼
Обработка ошибок (try...except)
   │
   │
   ▼
Логгирование ошибок
   │
   │
   ▼
Конец (Выход из цикла по команде exit/shutdown)