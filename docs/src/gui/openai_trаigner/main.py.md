# Модуль `main.py`

## Обзор

Модуль `main.py` представляет собой основное окно приложения, которое предоставляет пользовательский интерфейс для взаимодействия с различными онлайн-сервисами и моделями, такими как ChatGPT, Gemini и Claude. Приложение использует библиотеку PyQt6 для создания графического интерфейса и позволяет пользователю вводить URL, выбирать сервисы Google и модели для загрузки в QWebEngineView.

## Подробней

Этот модуль реализует главное окно приложения AssistantMainWindow, которое позволяет пользователю взаимодействовать с различными сервисами Google и моделями, такими как ChatGPT, Gemini и Claude, через интерфейс PyQt6. Приложение предоставляет возможность ввода URL, выбора сервисов Google и моделей через меню, а также сворачивания окна в системный трей.

## Классы

### `AssistantMainWindow`

**Описание**:
Основной класс окна приложения, наследующийся от `QMainWindow`. Отвечает за создание и управление пользовательским интерфейсом, включая верхнюю панель с кнопками, поле ввода URL, QWebEngineView для отображения веб-страниц, а также иконку в системном трее.

**Как работает класс**:
1.  **Инициализация**:
    *   Вызывается конструктор базового класса `QMainWindow`.
    *   Устанавливаются флаги окна для управления поведением окна (запрет максимизации).
    *   Определяются размеры окна на основе размеров экрана (3/4 экрана).
    *   Запрашивается у пользователя выбор браузера по умолчанию.
    *   Создается профиль браузера на основе выбранного браузера.
    *   Создается экземпляр `QWebEngineView` для отображения веб-контента.
    *   Инициализируется верхняя панель с кнопками и полем ввода URL.
    *   Создается и настраивается иконка системного трея.
    *   Настраивается контекстное меню для иконки в трее.
    *   Создаются меню для выбора URL и моделей.
    *   Добавляются кнопки для открытия меню URL и моделей на верхней панели.
2.  **Методы**:
    *   `ask_for_browser`: Запрашивает у пользователя выбор браузера по умолчанию.
    *   `load_url`: Загружает URL в `QWebEngineView`.
    *   `hide_to_tray`: Сворачивает окно в системный трей.
    *   `quit_app`: Закрывает приложение.
    *   `closeEvent`: Переопределенный метод для обработки события закрытия окна, который скрывает окно в трей вместо закрытия.

**Методы**:

*   `__init__`: Инициализирует экземпляр класса `AssistantMainWindow`.
*   `ask_for_browser`: Запрашивает у пользователя выбор браузера по умолчанию.
*   `load_url`: Загружает указанный URL в `QWebEngineView`.
*   `hide_to_tray`: Скрывает главное окно и помещает иконку в системный трей.
*   `quit_app`: Завершает работу приложения.
*   `closeEvent`: Перехватывает событие закрытия окна и скрывает окно в системный трей вместо закрытия.

#### `__init__`

```python
def __init__(self):
    """
    Инициализирует окно приложения, устанавливает размеры, создает элементы интерфейса,
    настраивает системный трей и подключает обработчики событий.
    """
    ...
```

**Описание**:
Инициализирует экземпляр класса `AssistantMainWindow`.

**Как работает функция**:

1.  Вызывает конструктор базового класса `QMainWindow`.
2.  Устанавливает флаги окна для управления поведением окна (запрет максимизации).
3.  Определяет размеры окна на основе размеров экрана (3/4 экрана).
4.  Запрашивает у пользователя выбор браузера по умолчанию.
5.  Создает профиль браузера на основе выбранного браузера.
6.  Создает экземпляр `QWebEngineView` для отображения веб-контента.
7.  Инициализирует верхнюю панель с кнопками и полем ввода URL.
8.  Создает и настраивает иконку системного трея.
9.  Настраивает контекстное меню для иконки в трее.
10. Создает меню для выбора URL и моделей.
11. Добавляет кнопки для открытия меню URL и моделей на верхней панели.

**Параметры**:
Нет.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
window = AssistantMainWindow()
```

#### `ask_for_browser`

```python
def ask_for_browser(self):
    """
    Запрашивает у пользователя выбор браузера по умолчанию из списка доступных вариантов.
    """
    ...
```

**Описание**:
Запрашивает у пользователя выбор браузера по умолчанию из списка доступных вариантов.

**Как работает функция**:

1.  Определяет список доступных браузеров (`Chrome`, `Firefox`, `Edge`).
2.  Использует `QMessageBox.getItem` для отображения диалогового окна с вариантами выбора.
3.  Возвращает выбранный браузер, если пользователь сделал выбор и нажал "OK".
4.  Возвращает `None`, если пользователь отменил выбор.

**Параметры**:
Нет.

**Возвращает**:
- `str | None`: Выбранный браузер или `None`, если выбор отменен.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
browser = self.ask_for_browser()
if browser:
    print(f"Выбран браузер: {browser}")
```

#### `load_url`

```python
def load_url(self, url: str = None):
    """
    Загружает указанный URL в `QWebEngineView`.
    """
    ...
```

**Описание**:
Загружает указанный URL в `QWebEngineView`.

**Как работает функция**:

1.  Получает URL из поля ввода, если URL не передан в качестве аргумента.
2.  Проверяет, что URL не пустой.
3.  Добавляет префикс "http://", если URL не начинается с "http".
4.  Устанавливает URL в `QWebEngineView` с использованием `QUrl`.

**Параметры**:

*   `url` (`str`, optional): URL для загрузки. Если не указан, используется URL из поля ввода. По умолчанию `None`.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
self.load_url("https://www.google.com/")
```

```python
self.load_url()  # Загружает URL из поля ввода
```

#### `hide_to_tray`

```python
def hide_to_tray(self):
    """
    Скрывает главное окно и помещает иконку в системный трей.
    """
    ...
```

**Описание**:
Скрывает главное окно и помещает иконку в системный трей.

**Как работает функция**:

1.  Скрывает главное окно с помощью `self.hide()`.

**Параметры**:
Нет.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
self.hide_to_tray()
```

#### `quit_app`

```python
def quit_app(self):
    """
    Завершает работу приложения.
    """
    ...
```

**Описание**:
Завершает работу приложения.

**Как работает функция**:

1.  Скрывает иконку системного трея с помощью `self.tray_icon.hide()`.
2.  Завершает работу приложения с помощью `QApplication.quit()`.

**Параметры**:
Нет.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
self.quit_app()
```

#### `closeEvent`

```python
def closeEvent(self, event):
    """
    Перехватывает событие закрытия окна и скрывает окно в системный трей вместо закрытия.
    """
    ...
```

**Описание**:
Перехватывает событие закрытия окна и скрывает окно в системный трей вместо закрытия.

**Как работает функция**:

1.  Игнорирует событие закрытия окна с помощью `event.ignore()`.
2.  Скрывает окно в системный трей с помощью `self.hide_to_tray()`.

**Параметры**:

*   `event`: Событие закрытия окна.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
def closeEvent(self, event):
    event.ignore()
    self.hide_to_tray()
```

## Функции

### `main`

```python
if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setQuitOnLastWindowClosed(False)  # Чтобы приложение оставалось в трее

    window = AssistantMainWindow()
    window.show()

    sys.exit(app.exec())
```

**Описание**:
Главная функция, которая запускает приложение.

**Как работает функция**:

1.  Создает экземпляр `QApplication`.
2.  Устанавливает флаг `setQuitOnLastWindowClosed(False)`, чтобы приложение оставалось в трее после закрытия последнего окна.
3.  Создает экземпляр `AssistantMainWindow`.
4.  Отображает главное окно.
5.  Запускает основной цикл обработки событий приложения.

**Параметры**:
Нет.

**Возвращает**:
Нет.

**Вызывает исключения**:
Нет.

**Примеры**:

```python
if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setQuitOnLastWindowClosed(False)

    window = AssistantMainWindow()
    window.show()

    sys.exit(app.exec())
```