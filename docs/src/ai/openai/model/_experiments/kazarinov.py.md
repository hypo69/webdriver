# Модуль для экспериментов с OpenAI (kazarinov.py)

## Обзор

Модуль предназначен для экспериментов с моделью OpenAI. Он включает в себя класс `OpenAIChat` для взаимодействия с моделью и функцию `chat` для организации диалога с пользователем через консоль. Модуль позволяет отправлять запросы к OpenAI и получать ответы, используя предоставленный API-ключ.

## Подробнее

Модуль предоставляет простой интерфейс для работы с OpenAI, позволяя пользователям взаимодействовать с моделью через консоль. Он загружает системную инструкцию из файла и использует ее для инициализации модели.

## Классы

### `OpenAIChat`

**Описание**: Класс для взаимодействия с моделью OpenAI.

**Принцип работы**: Класс инициализируется с API-ключом и системной инструкцией. Он хранит историю сообщений в атрибуте `messages` и использует метод `ask` для отправки запросов к модели OpenAI.

**Аттрибуты**:

- `api_key` (str): API-ключ для доступа к OpenAI.
- `system_instruction` (str): Системная инструкция для модели.
- `messages` (list): Список сообщений, отправленных в модель и полученных от нее.

**Методы**:

- `__init__(api_key: str, system_instruction: str = None)`: Инициализирует класс `OpenAIChat`.
- `ask(prompt: str) -> str`: Отправляет запрос в модель OpenAI и получает ответ.

#### `__init__(api_key: str, system_instruction: str = None)`

```python
def __init__(self, api_key: str, system_instruction: str = None):
    """
    Инициализирует класс `OpenAIChat`.

    Args:
        api_key (str): API-ключ для доступа к OpenAI.
        system_instruction (str, optional): Системная инструкция для модели. По умолчанию `None`.
    """
```

**Назначение**: Инициализирует экземпляр класса `OpenAIChat`, устанавливая API-ключ и системную инструкцию.

**Параметры**:

- `api_key` (str): API-ключ для доступа к OpenAI.
- `system_instruction` (str, optional): Системная инструкция для модели. По умолчанию `None`.

**Как работает функция**:

1. Устанавливает API-ключ OpenAI.
2. Сохраняет системную инструкцию в атрибуте `system_instruction`.
3. Инициализирует пустой список `messages` для хранения истории сообщений.
4. Если предоставлена системная инструкция, добавляет ее в список сообщений в качестве сообщения от системы.

#### `ask(prompt: str) -> str`

```python
def ask(self, prompt: str) -> str:
    """
    Отправляет запрос в модель OpenAI и получает ответ.

    Args:
        prompt (str): Запрос пользователя.

    Returns:
        str: Ответ от модели OpenAI.
    """
```

**Назначение**: Отправляет запрос в модель OpenAI и возвращает ответ.

**Параметры**:

- `prompt` (str): Запрос пользователя.

**Возвращает**:

- `str`: Ответ от модели OpenAI.

**Вызывает исключения**:

- `Exception`: Если происходит ошибка при отправке запроса или обработке ответа.

**Как работает функция**:

1. Добавляет сообщение пользователя в список сообщений.
2. Отправляет запрос в модель OpenAI с использованием `openai.ChatCompletion.create`.
3. Извлекает ответ из полученного ответа.
4. Добавляет ответ модели в список сообщений.
5. Возвращает ответ модели.
6. В случае возникновения ошибки, логирует ошибку с использованием `logger.error` и возвращает сообщение об ошибке.

```
A: Добавление сообщения пользователя в список сообщений
|
B: Отправка запроса в модель OpenAI
|
C: Извлечение ответа из ответа OpenAI
|
D: Добавление ответа модели в список сообщений
|
E: Возврат ответа модели
```

**Примеры**:

```python
ai = OpenAIChat(api_key="test_api_key", system_instruction="You are a helpful assistant.")
response = ai.ask(prompt="What is the capital of France?")
print(response)  # Output: The capital of France is Paris.
```

## Функции

### `chat()`

```python
def chat():
    """
    Организует диалог с пользователем через консоль.
    """
```

**Назначение**: Функция `chat` организует диалог с пользователем через консоль, позволяя отправлять запросы к OpenAI и получать ответы.

**Как работает функция**:

1. Выводит приветственное сообщение.
2. Запрашивает у пользователя OpenAI API ключ.
3. Инициализирует класс `OpenAIChat` с использованием введенного API ключа и системной инструкции.
4. Входит в бесконечный цикл, в котором запрашивает у пользователя вопрос.
5. Если пользователь вводит 'exit', цикл завершается.
6. Отправляет запрос модели и получает ответ с использованием метода `ask` класса `OpenAIChat`.
7. Выводит ответ в консоль.

```
A: Вывод приветственного сообщения
|
B: Запрос OpenAI API ключа у пользователя
|
C: Инициализация класса OpenAIChat
|
D: Вход в бесконечный цикл
|
E: Запрос вопроса у пользователя
|
F: Проверка ввода пользователя на 'exit'
|
G: Отправка запроса модели и получение ответа
|
H: Вывод ответа в консоль
```

**Примеры**:

```python
chat() # Запуск чата с OpenAI