# Модуль для работы с Google Sheets API

## Обзор

Модуль `reach_spreadsheet.py` предоставляет класс `ReachSpreadsheet` для взаимодействия с Google Sheets API v4 и Google Drive API v3. Он позволяет создавать, совместно использовать и манипулировать таблицами Google Sheets.

## Подробней

Этот модуль предназначен для упрощения работы с Google Sheets API, предоставляя удобный интерфейс для выполнения таких задач, как создание таблиц, добавление листов, установка размеров ячеек, форматирование и обмен данными. Он был создан для использования в проекте `TimeManagementBot` и содержит функциональность, необходимую для автоматизации работы с таблицами.

## Классы

### `SpreadsheetError`

**Описание**: Базовый класс исключений для модуля `reach_spreadsheet`.

**Как работает класс**:
Этот класс служит базовым классом для других исключений, специфичных для работы с таблицами. Он не содержит дополнительной логики.

### `SpreadsheetNotSetError`

**Описание**: Исключение, выбрасываемое, когда не установлена таблица.

**Как работает класс**:
Этот класс исключений используется, когда операции требуют установленного идентификатора таблицы, но он отсутствует.

### `SheetNotSetError`

**Описание**: Исключение, выбрасываемое, когда не установлен лист таблицы.

**Как работает класс**:
Этот класс исключений используется, когда операции требуют установленного идентификатора листа таблицы, но он отсутствует.

### `ReachSpreadsheet`

**Описание**: Класс для взаимодействия с Google Sheets API.

**Как работает класс**:
Класс `ReachSpreadsheet` предоставляет методы для создания, совместного использования и манипулирования таблицами Google Sheets. Он использует учетные данные сервисного аккаунта для аутентификации и взаимодействия с API.

**Методы**:
- `__init__`: Инициализирует экземпляр класса `ReachSpreadsheet`, настраивает аутентификацию и создает сервисы для работы с Google Sheets и Drive API.
- `create`: Создает новую таблицу Google Sheets с указанными свойствами.
- `share`: Предоставляет доступ к таблице для указанных пользователей или групп.
- `shareWithEmailForReading`: Предоставляет доступ на чтение к таблице для указанного email.
- `shareWithEmailForWriting`: Предоставляет доступ на запись к таблице для указанного email.
- `shareWithAnybodyForReading`: Предоставляет доступ на чтение к таблице для всех пользователей.
- `shareWithAnybodyForWriting`: Предоставляет доступ на запись к таблице для всех пользователей.
- `getSheetURL`: Возвращает URL текущего листа таблицы.
- `setSpreadsheetById`: Устанавливает текущую таблицу по её идентификатору.
- `runPrepared`: Выполняет подготовленные запросы на обновление таблицы.
- `prepare_addSheet`: Подготавливает запрос на добавление нового листа в таблицу.
- `addSheet`: Добавляет новый лист в текущую таблицу и устанавливает его как текущий.
- `toGridRange`: Преобразует строковый диапазон ячеек в объект `GridRange`.
- `prepare_setDimensionPixelSize`: Подготавливает запрос на изменение размера столбца или строки.
- `prepare_setColumnsWidth`: Подготавливает запрос на изменение ширины столбцов.
- `prepare_setColumnWidth`: Подготавливает запрос на изменение ширины одного столбца.
- `prepare_setRowsHeight`: Подготавливает запрос на изменение высоты строк.
- `prepare_setRowHeight`: Подготавливает запрос на изменение высоты одной строки.
- `prepare_setValues`: Подготавливает запрос на установку значений в указанном диапазоне ячеек.
- `prepare_mergeCells`: Подготавливает запрос на объединение ячеек.
- `prepare_setCellStringFormatterormat`: Подготавливает запрос на установку формата ячеек.
- `prepare_setCellStringFormatterormats`: Подготавливает запрос на установку формата для нескольких ячеек.

### `__init__`

```python
def __init__(self, debugMode = False):
    """
    Args:
        debugMode (bool, optional): Флаг для включения режима отладки. По умолчанию `False`.
    
    Raises:
        Exception: Если возникает ошибка при создании credentials.

    Как работает функция:
        Инициализирует экземпляр класса `ReachSpreadsheet`. Загружает учетные данные из временного файла,
        создает сервисы для работы с Google Sheets и Drive API, а также инициализирует переменные для хранения
        идентификатора таблицы, идентификатора листа и списка запросов.
    """
```

### `create`

```python
def create(self, title, sheetTitle, rows = 1000, cols = 26, locale = \'en-US\', timeZone = \'Etc/GMT\'):
    """
    Args:
        title (str): Заголовок создаваемой таблицы.
        sheetTitle (str): Заголовок создаваемого листа.
        rows (int, optional): Количество строк в листе. По умолчанию 1000.
        cols (int, optional): Количество столбцов в листе. По умолчанию 26.
        locale (str, optional): Локаль таблицы. По умолчанию 'en-US'.
        timeZone (str, optional): Временная зона таблицы. По умолчанию 'Etc/GMT'.

    Как работает функция:
        Создает новую таблицу Google Sheets с указанными свойствами.
        Использует Google Sheets API для создания таблицы с указанным заголовком,
        листом, количеством строк и столбцов, локалью и временной зоной.
        Сохраняет идентификатор таблицы и листа в атрибутах экземпляра класса.
    """
```

### `share`

```python
def share(self, shareRequestBody):
    """
    Args:
        shareRequestBody (dict): Тело запроса для предоставления доступа к таблице.

    Raises:
        SpreadsheetNotSetError: Если не установлен идентификатор таблицы.

    Как работает функция:
        Предоставляет доступ к таблице для указанных пользователей или групп.
        Использует Google Drive API для предоставления доступа к таблице на основе
        тела запроса, содержащего информацию о типе доступа, роли и email.
    """
```

### `shareWithEmailForReading`

```python
def shareWithEmailForReading(self, email):
    """
    Args:
        email (str): Email пользователя, которому предоставляется доступ на чтение.

    Как работает функция:
        Предоставляет доступ на чтение к таблице для указанного email.
        Вызывает метод `share` с телом запроса, указывающим тип доступа как "user",
        роль как "reader" и email пользователя.
    """
```

### `shareWithEmailForWriting`

```python
def shareWithEmailForWriting(self, email):
    """
    Args:
        email (str): Email пользователя, которому предоставляется доступ на запись.

    Как работает функция:
        Предоставляет доступ на запись к таблице для указанного email.
        Вызывает метод `share` с телом запроса, указывающим тип доступа как "user",
        роль как "writer" и email пользователя.
    """
```

### `shareWithAnybodyForReading`

```python
def shareWithAnybodyForReading(self):
    """
    Как работает функция:
        Предоставляет доступ на чтение к таблице для всех пользователей.
        Вызывает метод `share` с телом запроса, указывающим тип доступа как "anyone"
        и роль как "reader".
    """
```

### `shareWithAnybodyForWriting`

```python
def shareWithAnybodyForWriting(self):
    """
    Как работает функция:
        Предоставляет доступ на запись к таблице для всех пользователей.
        Вызывает метод `share` с телом запроса, указывающим тип доступа как "anyone"
        и роль как "writer".
    """
```

### `getSheetURL`

```python
def getSheetURL(self):
    """
    Returns:
        str: URL текущего листа таблицы.

    Raises:
        SpreadsheetNotSetError: Если не установлен идентификатор таблицы.
        SheetNotSetError: Если не установлен идентификатор листа таблицы.

    Как работает функция:
        Возвращает URL текущего листа таблицы.
        Формирует URL на основе идентификатора таблицы и идентификатора листа.
    """
```

### `setSpreadsheetById`

```python
def setSpreadsheetById(self, spreadsheetId):
    """
    Args:
        spreadsheetId (str): Идентификатор таблицы.

    Как работает функция:
        Устанавливает текущую таблицу по её идентификатору.
        Получает информацию о таблице с помощью Google Sheets API и сохраняет
        идентификатор таблицы, идентификатор листа и заголовок листа в атрибутах
        экземпляра класса.
    """
```

### `runPrepared`

```python
def runPrepared(self, valueInputOption = "USER_ENTERED"):
    """
    Args:
        valueInputOption (str, optional): Способ интерпретации входных данных. По умолчанию "USER_ENTERED".

    Returns:
        tuple[list, list]: Кортеж, содержащий ответы на запросы batchUpdate и batchUpdateValues.

    Raises:
        SpreadsheetNotSetError: Если не установлен идентификатор таблицы.

    Как работает функция:
        Выполняет подготовленные запросы на обновление таблицы.
        Использует Google Sheets API для выполнения запросов на обновление таблицы,
        таких как добавление листов, изменение размеров ячеек и форматирование.
        Очищает списки запросов после выполнения.
    """
```

### `prepare_addSheet`

```python
def prepare_addSheet(self, sheetTitle, rows = 1000, cols = 26):
    """
    Args:
        sheetTitle (str): Заголовок добавляемого листа.
        rows (int, optional): Количество строк в листе. По умолчанию 1000.
        cols (int, optional): Количество столбцов в листе. По умолчанию 26.

    Как работает функция:
        Подготавливает запрос на добавление нового листа в таблицу.
        Формирует запрос на добавление листа с указанным заголовком, количеством
        строк и столбцов и добавляет его в список запросов.
    """
```

### `addSheet`

```python
def addSheet(self, sheetTitle, rows = 1000, cols = 26):
    """
    Args:
        sheetTitle (str): Заголовок добавляемого листа.
        rows (int, optional): Количество строк в листе. По умолчанию 1000.
        cols (int, optional): Количество столбцов в листе. По умолчанию 26.

    Returns:
        int: Идентификатор добавленного листа.

    Raises:
        SpreadsheetNotSetError: Если не установлен идентификатор таблицы.

    Как работает функция:
        Добавляет новый лист в текущую таблицу и устанавливает его как текущий.
        Вызывает метод `prepare_addSheet` для подготовки запроса на добавление листа,
        затем выполняет запрос с помощью метода `runPrepared`.
        Сохраняет идентификатор и заголовок добавленного листа в атрибутах
        экземпляра класса.
    """
```

### `toGridRange`

```python
def toGridRange(self, cellsRange):
    """
    Args:
        cellsRange (str): Строковый диапазон ячеек, например, "A3:B4".

    Returns:
        dict: Объект GridRange, представляющий диапазон ячеек.

    Raises:
        SheetNotSetError: Если не установлен идентификатор листа таблицы.

    Как работает функция:
        Преобразует строковый диапазон ячеек в объект `GridRange`.
        Разбирает строковый диапазон ячеек на начальную и конечную ячейки,
        определяет индексы строк и столбцов и формирует объект `GridRange`,
        который содержит информацию об идентификаторе листа, начальном и конечном
        индексах строк и столбцов.
    """
```

### `prepare_setDimensionPixelSize`

```python
def prepare_setDimensionPixelSize(self, dimension, startIndex, endIndex, pixelSize):
    """
    Args:
        dimension (str): Измерение, которое нужно изменить ("ROWS" или "COLUMNS").
        startIndex (int): Начальный индекс строки или столбца.
        endIndex (int): Конечный индекс строки или столбца.
        pixelSize (int): Размер в пикселях.

    Raises:
        SheetNotSetError: Если не установлен идентификатор листа таблицы.

    Как работает функция:
        Подготавливает запрос на изменение размера столбца или строки.
        Формирует запрос на изменение размера столбца или строки с указанными
        параметрами и добавляет его в список запросов.
    """
```

### `prepare_setColumnsWidth`

```python
def prepare_setColumnsWidth(self, startCol, endCol, width):
    """
    Args:
        startCol (int): Начальный индекс столбца.
        endCol (int): Конечный индекс столбца.
        width (int): Ширина столбцов в пикселях.

    Как работает функция:
        Подготавливает запрос на изменение ширины столбцов.
        Вызывает метод `prepare_setDimensionPixelSize` с указанием измерения
        "COLUMNS" и передает параметры начального и конечного индексов столбцов
        и ширины.
    """
```

### `prepare_setColumnWidth`

```python
def prepare_setColumnWidth(self, col, width):
    """
    Args:
        col (int): Индекс столбца.
        width (int): Ширина столбца в пикселях.

    Как работает функция:
        Подготавливает запрос на изменение ширины одного столбца.
        Вызывает метод `prepare_setColumnsWidth` с указанием начального и
        конечного индексов столбца как одного и того же индекса и передает параметр
        ширины.
    """
```

### `prepare_setRowsHeight`

```python
def prepare_setRowsHeight(self, startRow, endRow, height):
    """
    Args:
        startRow (int): Начальный индекс строки.
        endRow (int): Конечный индекс строки.
        height (int): Высота строк в пикселях.

    Как работает функция:
        Подготавливает запрос на изменение высоты строк.
        Вызывает метод `prepare_setDimensionPixelSize` с указанием измерения
        "ROWS" и передает параметры начального и конечного индексов строк и высоты.
    """
```

### `prepare_setRowHeight`

```python
def prepare_setRowHeight(self, row, height):
    """
    Args:
        row (int): Индекс строки.
        height (int): Высота строки в пикселях.

    Как работает функция:
        Подготавливает запрос на изменение высоты одной строки.
        Вызывает метод `prepare_setRowsHeight` с указанием начального и
        конечного индексов строки как одного и того же индекса и передает параметр
        высоты.
    """
```

### `prepare_setValues`

```python
def prepare_setValues(self, cellsRange, values, majorDimension = "ROWS"):
    """
    Args:
        cellsRange (str): Диапазон ячеек, в которые нужно установить значения.
        values (list[list]): Список списков значений для установки в ячейки.
        majorDimension (str, optional): Главное измерение ("ROWS" или "COLUMNS"). По умолчанию "ROWS".

    Raises:
        SheetNotSetError: Если не установлен заголовок листа.

    Как работает функция:
        Подготавливает запрос на установку значений в указанном диапазоне ячеек.
        Формирует запрос на установку значений в указанном диапазоне ячеек с
        указанием главного измерения и добавляет его в список запросов.
    """
```

### `prepare_mergeCells`

```python
def prepare_mergeCells(self, cellsRange, mergeType = "MERGE_ALL"):
    """
    Args:
        cellsRange (str): Диапазон ячеек, которые нужно объединить.
        mergeType (str, optional): Тип объединения ("MERGE_ALL", "MERGE_COLUMNS", "MERGE_ROWS"). По умолчанию "MERGE_ALL".

    Как работает функция:
        Подготавливает запрос на объединение ячеек.
        Вызывает метод `toGridRange` для преобразования строкового диапазона ячеек
        в объект `GridRange`, затем формирует запрос на объединение ячеек с
        указанием типа объединения и добавляет его в список запросов.
    """
```

### `prepare_setCellStringFormatterormat`

```python
def prepare_setCellStringFormatterormat(self, cellsRange, formatJSON, fields = "userEnteredFormat"):
    """
    Args:
        cellsRange (str): Диапазон ячеек, для которых нужно установить формат.
        formatJSON (dict): Словарь с информацией о формате ячеек.
        fields (str, optional): Поля, которые нужно обновить. По умолчанию "userEnteredFormat".

    Как работает функция:
        Подготавливает запрос на установку формата ячеек.
        Вызывает метод `toGridRange` для преобразования строкового диапазона ячеек
        в объект `GridRange`, затем формирует запрос на установку формата ячеек с
        указанием формата и полей и добавляет его в список запросов.
    """
```

### `prepare_setCellStringFormatterormats`

```python
def prepare_setCellStringFormatterormats(self, cellsRange, formatsJSON, fields = "userEnteredFormat"):
    """
    Args:
        cellsRange (str): Диапазон ячеек, для которых нужно установить формат.
        formatsJSON (list[list[dict]]): Список списков словарей с информацией о формате ячеек.
        fields (str, optional): Поля, которые нужно обновить. По умолчанию "userEnteredFormat".

    Как работает функция:
        Подготавливает запрос на установку формата для нескольких ячеек.
        Вызывает метод `toGridRange` для преобразования строкового диапазона ячеек
        в объект `GridRange`, затем формирует запрос на установку формата для
        нескольких ячеек с указанием форматов и полей и добавляет его в список
        запросов.
    """
```

## Функции

### `htmlColorToJSON`

```python
def htmlColorToJSON(htmlColor):
    """
    Args:
        htmlColor (str): HTML-код цвета в формате "#RRGGBB".

    Returns:
        dict: JSON-представление цвета в формате {"red": значение, "green": значение, "blue": значение}.

    Как работает функция:
        Преобразует HTML-код цвета в JSON-представление.
        Разбирает HTML-код цвета на составляющие красного, зеленого и синего цветов
        и формирует JSON-представление цвета в виде словаря с ключами "red",
        "green" и "blue".
    """
```

### `create_pricelist`

```python
def create_pricelist(docTitle,sheetTitle,values:list):
    """
    Args:
        docTitle (str): Заголовок документа.
        sheetTitle (str): Заголовок листа.
        values (list): Список списков значений для заполнения таблицы.

    Как работает функция:
        Создает таблицу с заданным заголовком и заполняет ее данными из списка `values`.
        Устанавливает общий доступ на запись для всех пользователей.
        Предполагается, что `values` содержит данные для заполнения таблицы, включая заголовок.
    """
```

### `testCreateTimeManagementReport`

```python
def testCreateTimeManagementReport():
    """
    Как работает функция:
        Создает таблицу Google Sheets, имитирующую отчет по управлению временем.
        Устанавливает ширину столбцов, объединяет ячейки, устанавливает форматы ячеек
        и добавляет данные в таблицу.
    """