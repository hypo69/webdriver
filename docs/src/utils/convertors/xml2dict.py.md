# Модуль `xml2dict`

## Обзор

Модуль `xml2dict` предоставляет инструменты для преобразования XML данных в словари. Он включает функции для парсинга XML строк и преобразования деревьев XML элементов в словарные представления.

## Подробней

Модуль предназначен для упрощения работы с XML данными, представляя их в виде Python словарей, что облегчает доступ к информации и манипулирование ею. Он использует библиотеки `xml.etree.cElementTree` или `xml.etree.ElementTree` для обработки XML. В проекте `hypotez` может использоваться для обработки конфигурационных файлов или данных, полученных из внешних источников в формате XML.

## Функции

### `_parse_node`

```python
def _parse_node(node: ET.Element) -> dict | str:
    """Parse an XML node into a dictionary.

    Args:
        node (ET.Element): The XML element to parse.

    Returns:
        dict | str: A dictionary representation of the XML node, or a string if the node has no attributes or children.
    """
    ...
```

**Назначение**: Преобразует XML узел в словарь.

**Параметры**:
- `node` (ET.Element): XML элемент для парсинга.

**Возвращает**:
- `dict | str`: Словарное представление XML узла, или строка, если узел не имеет атрибутов или дочерних элементов.

**Как работает функция**:
1. Инициализирует пустой словарь `tree` для хранения структуры узла и пустой словарь `attrs` для хранения атрибутов узла.
2. Проходит по атрибутам узла, исключая атрибуты `href` (атрибуты `href` не поддерживаются при конвертации в словарь).
3. Обновляет словарь `attrs` значениями атрибутов, используя функцию `_make_dict`.
4. Извлекает текстовое значение узла, удаляя начальные и конечные пробелы.
5. Если есть атрибуты, добавляет их в словарь `tree` под ключом `'attrs'`.
6. Проходит по дочерним элементам узла, рекурсивно вызывая `_parse_node` для каждого дочернего элемента.
7. Создает словарь `cdict` для каждого дочернего элемента с помощью функции `_make_dict`.
8. Если узел имеет дочерние элементы, значение узла устанавливается в пустую строку.
9. Если дочерний элемент встречается впервые, добавляет его в словарь `tree`. Если дочерний элемент встречается несколько раз, преобразует значение в список и добавляет новый элемент в список.
10. Если у узла нет дочерних элементов, добавляет значение узла в словарь `tree` под ключом `'value'`.
11. Если в словаре `tree` есть только ключ `'value'`, возвращает значение напрямую.

```ascii
Начало
  ↓
Инициализация: tree = {}, attrs = {}
  ↓
Обработка атрибутов:
  → Проход по атрибутам узла
  → Исключение 'href' атрибутов
  → Обновление attrs через _make_dict
  ↓
Извлечение значения: value = node.text.strip()
  ↓
Добавление атрибутов в tree (если есть)
  ↓
Обработка дочерних элементов:
  → Проход по дочерним элементам
  → Рекурсивный вызов _parse_node для каждого дочернего элемента
  → Создание cdict через _make_dict
  → Обновление tree (добавление или преобразование в список)
  ↓
Добавление значения в tree (если нет дочерних элементов)
  ↓
Проверка: Если только 'value' в tree
  → Возврат значения
  ↓
Конец
```

### `_make_dict`

```python
def _make_dict(tag: str, value: any) -> dict:
    """Generate a new dictionary with tag and value.

    Args:
        tag (str): The tag name of the XML element.
        value (any): The value associated with the tag.

    Returns:
        dict: A dictionary with the tag name as the key and the value as the dictionary value.
    """
    ...
```

**Назначение**: Создает новый словарь с тегом и значением.

**Параметры**:
- `tag` (str): Имя тега XML элемента.
- `value` (any): Значение, связанное с тегом.

**Возвращает**:
- `dict`: Словарь с именем тега в качестве ключа и значением в качестве значения словаря.

**Как работает функция**:
1. Инициализирует `tag_values` значением параметра `value`.
2. Использует регулярное выражение для поиска пространства имен в теге.
3. Если пространство имен найдено, обновляет `tag_values`, добавляя информацию о пространстве имен (`xmlns`).
4. Возвращает словарь с тегом в качестве ключа и `tag_values` в качестве значения.

```ascii
Начало
  ↓
Инициализация: tag_values = value
  ↓
Поиск пространства имен в теге: re.compile(...).search(tag)
  ↓
Если пространство имен найдено:
  → Обновление tag_values с информацией о пространстве имен
  ↓
Возврат словаря: {tag: tag_values}
  ↓
Конец
```

### `xml2dict`

```python
def xml2dict(xml: str) -> dict:
    """Parse XML string into a dictionary.

    Args:
        xml (str): The XML string to parse.

    Returns:
        dict: The dictionary representation of the XML.
    """
    ...
```

**Назначение**: Преобразует XML строку в словарь.

**Параметры**:
- `xml` (str): XML строка для парсинга.

**Возвращает**:
- `dict`: Словарное представление XML.

**Как работает функция**:
1. Преобразует XML строку в дерево элементов с помощью `ET.fromstring(xml)`.
2. Вызывает функцию `ET2dict` для преобразования дерева элементов в словарь.
3. Возвращает полученный словарь.

```ascii
Начало
  ↓
Преобразование XML строки в дерево элементов: ET.fromstring(xml)
  ↓
Преобразование дерева элементов в словарь: ET2dict(element_tree)
  ↓
Возврат словаря
  ↓
Конец
```

### `ET2dict`

```python
def ET2dict(element_tree: ET.Element) -> dict:
    """Convert an XML element tree into a dictionary.

    Args:
        element_tree (ET.Element): The XML element tree.

    Returns:
        dict: The dictionary representation of the XML element tree.
    """
    ...
```

**Назначение**: Преобразует дерево XML элементов в словарь.

**Параметры**:
- `element_tree` (ET.Element): Дерево XML элементов.

**Возвращает**:
- `dict`: Словарное представление дерева XML элементов.

**Как работает функция**:
1. Вызывает функцию `_make_dict` с корневым тегом дерева элементов и результатом вызова `_parse_node` для дерева элементов.
2. Возвращает полученный словарь.

```ascii
Начало
  ↓
Вызов _make_dict с корневым тегом и результатом _parse_node
  ↓
Возврат словаря
  ↓
Конец
```