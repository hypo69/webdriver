# Модуль для работы с XML
=================================================

Модуль содержит функции для очистки и сохранения XML данных. Он включает в себя функции для удаления пустых элементов и CDATA секций, а также для сохранения XML в файл с форматированием.

## Обзор

Модуль `src.utils.xml` предоставляет инструменты для обработки XML данных, такие как очистка от пустых элементов и сохранение в файл с отступами для улучшения читаемости. Этот модуль полезен для работы с XML файлами, которые могут содержать лишние пробелы или пустые элементы, затрудняющие их обработку.

## Подробней

Этот модуль используется для предобработки XML данных перед их дальнейшим использованием в проекте. Он помогает обеспечить чистоту и консистентность XML файлов, что упрощает их парсинг и обработку другими компонентами системы.

## Функции

### `clean_empty_cdata`

```python
def clean_empty_cdata(xml_string: str) -> str:
    """! Cleans empty CDATA sections and unnecessary whitespace in XML string.

    Args:
        xml_string (str): Raw XML content.

    Returns:
        str: Cleaned and formatted XML content.
    """
    ...
```

**Назначение**: Очищает XML строку от пустых CDATA секций и лишних пробелов.

**Параметры**:
- `xml_string` (str): XML контент в виде строки.

**Возвращает**:
- `str`: Очищенный и отформатированный XML контент.

**Как работает функция**:

1.  **Преобразование XML строки в дерево элементов**: Функция `ET.fromstring(xml_string)` преобразует входную XML строку в дерево элементов, используя библиотеку `xml.etree.ElementTree`.
2.  **Рекурсивное удаление пустых элементов**: Функция `remove_empty_elements` рекурсивно проходит по всем элементам дерева. Если элемент не содержит текста или атрибутов и не имеет дочерних элементов, он удаляется из дерева.
3.  **Преобразование дерева обратно в строку**: Функция `ET.tostring(root, encoding="utf-8").decode("utf-8")` преобразует очищенное дерево элементов обратно в XML строку.
4.  **Удаление лишних пробелов**: Регулярное выражение `re.sub(r">\s+<", "><", cleaned_xml)` удаляет все пробелы между закрывающим и открывающим тегами.

```ascii
    XML строка -> Преобразование в дерево элементов (ET.fromstring)
         |
         ↓
    Рекурсивное удаление пустых элементов (remove_empty_elements)
         |
         ↓
    Преобразование дерева в строку (ET.tostring)
         |
         ↓
    Удаление лишних пробелов (re.sub)
         |
         ↓
    Очищенная XML строка
```

**Внутренние функции**:

### `remove_empty_elements`
```python
def remove_empty_elements(element):
    """
    Рекурсивно удаляет пустые элементы из XML дерева.

    Args:
        element: Текущий XML элемент для проверки.

    Returns:
        None: Функция изменяет дерево XML напрямую.
    """
    ...
```
**Назначение**: Рекурсивно удаляет пустые элементы из XML дерева.

**Параметры**:
- `element`: Текущий XML элемент для проверки.

**Возвращает**:
- `None`: Функция изменяет дерево XML напрямую.

**Как работает функция**:

1.  **Итерация по дочерним элементам**: Функция проходит по всем дочерним элементам текущего элемента.
2.  **Рекурсивный вызов для дочерних элементов**: Для каждого дочернего элемента функция вызывает саму себя, чтобы обработать его дочерние элементы.
3.  **Проверка на пустоту**: Если элемент не содержит текста, атрибутов и дочерних элементов, он считается пустым и удаляется из дерева.

**Примеры**:

```python
import xml.etree.ElementTree as ET

xml_string = "<root><item>Value</item><empty/></root>"
cleaned_xml = clean_empty_cdata(xml_string)
print(cleaned_xml)  # Вывод: <root><item>Value</item></root>
```

### `save_xml`

```python
def save_xml(xml_string: str, file_path: str) -> None:
    """! Saves cleaned XML data from a string to a file with indentation.

    Args:
        xml_string (str): XML content as a string.
        file_path (str): Path to the output file.

    Returns:
        None
    """
    ...
```

**Назначение**: Сохраняет очищенные XML данные из строки в файл с отступами.

**Параметры**:
- `xml_string` (str): XML контент в виде строки.
- `file_path` (str): Путь к выходному файлу.

**Возвращает**:
- `None`

**Как работает функция**:

1.  **Очистка XML**: Функция вызывает `clean_empty_cdata` для очистки XML строки от пустых элементов и лишних пробелов.
2.  **Парсинг XML**: Очищенная XML строка парсится в дерево элементов с помощью `ET.fromstring`.
3.  **Преобразование в строку с отступами**: Дерево элементов преобразуется в строку с отступами с помощью `minidom.parseString` и `toprettyxml`.
4.  **Запись в файл**: Отформатированная XML строка записывается в файл, указанный в `file_path`.

```ascii
    XML строка -> Очистка XML (clean_empty_cdata)
         |
         ↓
    Парсинг XML (ET.fromstring)
         |
         ↓
    Преобразование в строку с отступами (minidom.parseString, toprettyxml)
         |
         ↓
    Запись в файл
```

**Примеры**:

```python
xml_data = "<root><item>Value</item><item attr='test'>Another</item></root>"
save_xml(xml_data, "output.xml")