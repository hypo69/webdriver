# Модуль `__morlevi__.py`

## Обзор

Модуль `__morlevi__.py` предназначен для работы с поставщиком Morlevi. Он содержит функции для авторизации на сайте поставщика, сбора информации о товарах и навигации по категориям.

## Подробнее

Этот модуль является частью системы сбора данных о товарах у различных поставщиков для последующей загрузки в PrestaShop. Он использует библиотеки `pathlib`, `requests`, `pandas` и `selenium` для взаимодействия с сайтом поставщика Morlevi.

## Функции

### `login`

```python
def login(supplier):
    """
    Выполняет вход на сайт поставщика.

    Args:
        supplier: Объект поставщика, содержащий информацию о драйвере и локаторах.

    Returns:
        bool: `True`, если вход выполнен успешно, в противном случае - `False`.

    Raises:
        Exception: Если не удается залогиниться.

    Example:
        >>> supplier = ...  # Объект поставщика
        >>> if login(supplier):
        ...     print("Вход выполнен успешно")
        ... else:
        ...     print("Не удалось выполнить вход")
    """
```

**Как работает функция**:

1.  Получает URL сайта поставщика из объекта `supplier` и открывает его в браузере.
2.  Пытается выполнить вход, используя функцию `_login`.
3.  Если вход не удался, пытается закрыть модальные окна, которые могут мешать входу.
4.  Повторно пытается выполнить вход.
5.  Если вход все равно не удался, перехватывает исключение и логирует ошибку.

```
        Получение URL и открытие страницы
        │
        ├──> Попытка входа (_login)
        │   │
        │   └──> Успех: Возврат True
        │   │
        │   └──> Неудача: Попытка закрытия модальных окон
        │       │
        │       └──> Повторная попытка входа (_login)
        │           │
        │           └──> Успех: Возврат True
        │           │
        │           └──> Неудача: Логирование ошибки
        │
        └──> Завершение
```

### `_login`

```python
def _login(_s):
    """
    Выполняет фактический вход на сайт поставщика, используя предоставленные учетные данные.

    Args:
        _s: Объект поставщика, содержащий информацию о драйвере и локаторах.

    Returns:
        bool | None: `True`, если вход выполнен успешно, `None` - в случае ошибки.

    Raises:
        Exception: Если не удается выполнить вход.
    """
```

**Как работает функция**:

1.  Обновляет страницу браузера.
2.  Извлекает локаторы для полей электронной почты, пароля и кнопки входа из объекта `supplier`.
3.  Вводит учетные данные и нажимает кнопку входа.
4.  Логирует успешный вход или ошибку в случае неудачи.

```
        Обновление страницы
        │
        ├──> Извлечение локаторов
        │   │
        │   ├──> Ввод данных в поля (email, password)
        │   │
        │   └──> Клик на кнопку "Login"
        │
        ├──> Успех: Логирование и возврат True
        │
        └──> Неудача: Логирование ошибки и возврат None
```

### `grab_product_page`

```python
def grab_product_page(s):
    """
    Собирает информацию о товаре со страницы товара на сайте поставщика.

    Args:
        s: Объект поставщика.

    Returns:
        Product: Объект `Product`, содержащий собранную информацию о товаре.
    """
```

**Как работает функция**:

1.  Создает объект `Product`.
2.  Извлекает локаторы для различных элементов страницы товара из объекта `supplier`.
3.  Определяет внутренние функции для установки различных полей объекта `Product` (ID, SKU, название, описание, цена и т. д.).
4.  Вызывает эти внутренние функции для заполнения объекта `Product` данными со страницы товара.
5.  Возвращает заполненный объект `Product`.

```
        Создание объекта Product
        │
        ├──> Извлечение локаторов элементов страницы
        │
        ├──> Определение внутренних функций для установки полей
        │   │
        │   ├──> set_id: Установка ID продукта
        │   │
        │   ├──> set_sku_suppl: Установка SKU поставщика
        │   │
        │   ├──> set_sku_prod: Установка SKU продукта
        │   │
        │   ├──> set_title: Установка заголовка
        │   │
        │   ├──> set_summary: Установка краткого описания
        │   │
        │   ├──> set_description: Установка полного описания
        │   │
        │   ├──> set_cost_price: Установка цены
        │   │
        │   ├──> set_before_tax_price: Установка цены без налога
        │   │
        │   ├──> set_delivery: Установка информации о доставке (TODO)
        │   │
        │   ├──> set_images: Установка URL изображений
        │   │
        │   ├──> set_combinations: Установка комбинаций (TODO)
        │   │
        │   ├──> set_qty: Установка количества (TODO)
        │   │
        │   ├──> set_specification: Установка спецификации
        │   │
        │   ├──> set_customer_reviews: Установка отзывов (TODO)
        │   │
        │   ├──> set_supplier: Установка поставщика
        │   │
        │   └──> set_rewritted_URL: Установка переписанного URL
        │
        └──> Вызов внутренних функций для заполнения объекта Product
        │
        └──> Возврат объекта Product
```

### `list_products_in_category_from_pagination`

```python
def list_products_in_category_from_pagination(supplier):
    """
    Собирает список ссылок на товары в категории, переходя по страницам пагинации.

    Args:
        supplier: Объект поставщика.

    Returns:
        list: Список ссылок на товары в категории.
    """
```

**Как работает функция**:

1.  Извлекает локаторы для ссылок на товары и элементов пагинации из объекта `supplier`.
2.  Собирает ссылки на товары с текущей страницы.
3.  Переходит по страницам пагинации, собирая ссылки с каждой страницы.
4.  Удаляет дубликаты из списка ссылок.
5.  Возвращает список ссылок на товары.

```
        Получение локаторов ссылок на товары и пагинации
        │
        ├──> Сбор ссылок на товары с текущей страницы
        │
        ├──> Проверка наличия пагинации
        │   │
        │   └──> Переход по страницам пагинации
        │       │
        │       └──> Сбор ссылок на товары с каждой страницы
        │
        ├──> Удаление дубликатов из списка ссылок
        │
        └──> Возврат списка ссылок
```

### `get_list_products_in_category`

```python
def get_list_products_in_category(s, scenario, presath):
    """
    Получает список товаров в категории.

    Args:
        s: Supplier
        scenario: JSON
        presath: PrestaShopWebServiceDict
    """
```

**Как работает функция**:

1.  Вызывает функцию `list_products_in_category_from_pagination` для получения списка товаров.
2.  ...

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s, scenario_file, brand=''):
    """

    """
```

**Как работает функция**:

1.  ...