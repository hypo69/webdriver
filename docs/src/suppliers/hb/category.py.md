# Модуль `category.py`

## Обзор

Модуль предназначен для сбора данных о товарах и категориях с сайта поставщика hb.co.il. Он использует веб-драйвер для взаимодействия с сайтом и извлечения необходимой информации. Модуль включает функции для сбора списка категорий, списка товаров в каждой категории и дальнейшей обработки информации о товарах.

## Подробней

Этот модуль играет важную роль в процессе сбора данных о товарах с сайта hb.co.il. Он автоматизирует навигацию по категориям сайта и извлечение ссылок на товары. Собранные данные используются для дальнейшей обработки и интеграции с другими системами, такими как PrestaShop.

## Функции

### `get_list_products_in_category`

```python
def get_list_products_in_category(s: Supplier) -> list[str, str, None]:
    """
    Возвращает список URL товаров со страницы категории.

    Args:
        s (Supplier): Объект поставщика.

    Returns:
        list[str, str, None]: Список URL товаров или None.
    """
```

**Назначение**: Извлекает список URL товаров со страницы категории, используя объект поставщика `Supplier`.

**Параметры**:
- `s` (Supplier): Объект поставщика, содержащий информацию о текущем поставщике, включая драйвер и локаторы.

**Возвращает**:
- `list[str, str, None]`: Список URL товаров, найденных на странице категории. Возвращает `None`, если список товаров не найден.

**Как работает функция**:

1.  **Инициализация**: Извлекает драйвер и локаторы из объекта поставщика.
2.  **Ожидание**: Ожидает 1 секунду, чтобы страница успела загрузиться.
3.  **Закрытие баннера**: Пытается закрыть всплывающий баннер, используя локатор `close_banner`.
4.  **Прокрутка страницы**: Выполняет прокрутку страницы для загрузки динамического контента.
5.  **Извлечение ссылок на товары**: Извлекает список ссылок на товары, используя локатор `product_links`.
6.  **Обработка пагинации**: Если есть пагинация, переходит на следующую страницу и добавляет новые ссылки на товары в общий список.
7.  **Формирование результата**: Преобразует результат в список, если он представлен строкой.
8.  **Логирование**: Записывает в лог количество найденных товаров в текущей категории.

**ASCII Flowchart**:

```
    Supplier (s)
    |
    V
    Драйвер (d), Локаторы (l)
    |
    V
    Ожидание загрузки страницы
    |
    V
    Закрытие баннера (если есть)
    |
    V
    Прокрутка страницы
    |
    V
    Извлечение ссылок на товары
    |
    V
    Проверка пагинации
    |
    V
    Добавление новых ссылок
    |
    V
    Список URL товаров
```

**Примеры**:

```python
# Пример использования функции
from src.suppliers import Supplier
from src.webdriver.driver import Driver, Chrome

# Создаем объект Supplier (в реальном коде он должен быть создан ранее)
s = Supplier(driver=Driver(Chrome), locators={'category': {'product_links': {'by': 'XPATH', 'selector': '//a[@class="product-link"]', 'many': True}, 'close_banner': {'by': 'XPATH', 'selector': '//button[@class="close-banner"]', 'many': False}}})
s.driver.get('https://hb.co.il/category/some_category')

product_list = get_list_products_in_category(s)

if product_list:
    print(f"Найдено {len(product_list)} товаров.")
else:
    print("Товары не найдены.")
```

### `paginator`

```python
def paginator(d: Driver, locator: dict, list_products_in_category: list) -> bool | None:
    """
    Осуществляет переход на следующую страницу, если доступна пагинация.

    Args:
        d (Driver): Объект драйвера.
        locator (dict): Словарь с локаторами.
        list_products_in_category (list): Список товаров в категории.

    Returns:
        bool | None: True, если переход на следующую страницу успешен, None - если нет.
    """
```

**Назначение**: Функция `paginator` предназначена для автоматического перехода на следующую страницу категории, если на сайте поставщика реализована пагинация. Она использует драйвер и локаторы для поиска кнопки "следующая страница" и кликает по ней.

**Параметры**:

-   `d` (Driver): Объект драйвера, используемый для взаимодействия с веб-страницей.
-   `locator` (dict): Словарь, содержащий локаторы элементов страницы, включая кнопку пагинации.
-   `list_products_in_category` (list): Список текущих товаров в категории. Используется для обновления списка после перехода на новую страницу.

**Возвращает**:

-   `bool | None`: Возвращает `True`, если переход на следующую страницу был успешен, и `None` в противном случае.

**Как работает функция**:

1.  **Поиск кнопки пагинации**: Использует `d.execute_locator` для поиска кнопки "следующая страница" (предположительно, `<--`) на странице.
2.  **Проверка наличия кнопки**: Проверяет, что кнопка была найдена и не является пустым списком.
3.  **Переход на следующую страницу**: Кликает по кнопке пагинации, и, если клик успешен, функция предполагает, что произошел переход на следующую страницу.
4.  **Возврат значения**: Если кнопка найдена и клик успешен, возвращает `True`, иначе возвращает `None`.

**ASCII Flowchart**:

```
    Начало
    │
    ├── Поиск кнопки пагинации "<--" (d.execute_locator)
    │
    ├── Кнопка найдена?
    │   ├── Нет: Возврат None
    │   └── Да:
    │       ├── Клик по кнопке
    │       ├── Возврат True
    │
    Конец
```

**Примеры**:

```python
from src.webdriver.driver import Driver, Chrome

# Пример использования функции
driver = Driver(Chrome)
driver.get('https://hb.co.il/category/some_category')
locator = {'pagination': {'<--': {'by': 'XPATH', 'selector': '//a[@class="next-page"]', 'many': False}}}
list_products = ['product1', 'product2']

if paginator(driver, locator, list_products):
    print("Переход на следующую страницу успешен.")
else:
    print("Пагинация отсутствует или переход не удался.")
```

### `get_list_categories_from_site`

```python
def get_list_categories_from_site(s):
    """
    Сборщик актуальных категорий с сайта.

    Args:
        s: Объект, представляющий сайт.

    Returns:
        None:
    """
```

**Назначение**: Функция `get_list_categories_from_site` предназначена для сбора актуального списка категорий с веб-сайта.

**Параметры**:
-   `s`: Объект, представляющий веб-сайт, с которого необходимо собрать категории.

**Возвращает**:
-   `None`: Функция ничего не возвращает явно.

**Как работает функция**:

1.  **Извлечение категорий**: Функция выполняет извлечение списка категорий с веб-сайта.
2.  **Обновление списка категорий**: Сохраняет или обновляет список категорий.

**ASCII Flowchart**:

```
    Начало
    │
    ├── Извлечение списка категорий с сайта
    │
    └── Обновление списка категорий
    │
    Конец
```

**Примеры**:

```python
# Пример использования функции
class MockSite:
    def __init__(self):
        self.categories = []

    def add_category(self, category):
        self.categories.append(category)

site = MockSite()
get_list_categories_from_site(site)
print(site.categories)