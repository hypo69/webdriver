# Модуль `supplier`

## Обзор

Модуль `supplier` содержит базовый класс `Supplier`, предназначенный для представления и управления поставщиками. Этот класс отвечает за загрузку конфигурации поставщика, выполнение сценариев и вход на сайты поставщиков. Он использует `pydantic` для валидации данных, `importlib` для динамической загрузки модулей поставщиков, и `src.scenario` для выполнения сценариев.

## Подробней

Модуль предоставляет абстракцию для работы с различными поставщиками, позволяя единообразно управлять их настройками и поведением. Класс `Supplier` является базовым классом, от которого могут наследоваться классы, представляющие конкретных поставщиков. Он обеспечивает загрузку настроек из JSON-файлов, динамический импорт модулей поставщиков и выполнение сценариев. Расположение файла в проекте `hypotez` указывает на его роль как центрального элемента в подсистеме управления поставщиками.

## Классы

### `Supplier`

**Описание**: Базовый класс для представления поставщиков.

**Как работает класс**:
Класс `Supplier` использует `pydantic` для определения структуры данных и валидации, `importlib` для динамической загрузки модулей, связанных с поставщиком, `j_loads_ns` для загрузки настроек из JSON, а также модули `src.scenario` и `src.logger` для выполнения сценариев и логирования событий. При инициализации класса происходит загрузка настроек через метод `_payload`, который пытается найти и загрузить JSON-файл с настройками поставщика и динамически импортировать соответствующий модуль. Валидация входных данных обеспечивается с помощью `pydantic`.

**Методы**:
- `__init__`: Инициализирует объект поставщика, загружает настройки через метод `_payload()`.
- `_payload`: Загружает настройки поставщика из JSON-файла, используя `j_loads_ns`, и динамически импортирует модуль, связанный с поставщиком.
- `login`: Выполняет вход на сайт поставщика, вызывая метод `login` из модуля, связанного с поставщиком.
- `run_scenario_files`: Выполняет сценарии, указанные в файлах.
- `run_scenarios`: Выполняет сценарии, переданные как словарь или список словарей.
- `check_supplier_prefix`: Валидатор для проверки, что `supplier_prefix` не пустая строка.

**Параметры**:
- `supplier_id` (Optional[Any]): Идентификатор поставщика (может быть `None`).
- `supplier_prefix` (str): Префикс поставщика (строка, обязательное поле).
- `locale` (str): Код локали поставщика (по умолчанию `'en'`).
- `price_rule` (Optional[str]): Правило расчета цен (может быть `None`).
- `related_modules` (Optional[ModuleType]): Модуль, содержащий специфические функции для поставщика (может быть `None`).
- `scenario_files` (List[str]): Список файлов сценариев для поставщика.
- `current_scenario` (Optional[Dict[str, Any]]): Текущий исполняемый сценарий (словарь).
- `locators` (Dict[str, str]): Локаторы для элементов страницы.
- `driver` (Optional[Driver]): Экземпляр веб-драйвера.

**Примеры**:

```python
from src.suppliers.supplier import Supplier

# Пример создания экземпляра класса Supplier
supplier = Supplier(supplier_prefix='test_supplier', locale='ru')

# Пример вызова метода login
# Предварительно должен быть определен модуль src.suppliers.test_supplier с функцией login
# supplier.login()

# Пример вызова метода run_scenarios
# scenarios = [{"step1": "action1"}, {"step2": "action2"}]
# supplier.run_scenarios(scenarios)
```

## Функции

### `_payload`

```python
def _payload(self) -> bool:
    """
    Args:
        self: экземпляр класса `Supplier`.

    Returns:
        bool: Возвращает `True` в случае успеха, `False` в случае ошибки.

    Raises:
        DefaultSettingsException: если не удалось загрузить настройки.
    """
```

**Описание**: Загружает настройки поставщика из JSON-файла.

**Как работает функция**:
Метод `_payload` пытается динамически импортировать модуль, связанный с поставщиком, формирует путь к файлу настроек поставщика (например, `src/suppliers/test_supplier_settings.json`) и загружает данные с помощью `j_loads_ns` в виде `SimpleNamespace`. Затем загруженные данные (правило расчета цен, локаль, файлы сценариев и локаторы) устанавливаются в качестве атрибутов объекта `Supplier`.

**Параметры**:
- `self`: Экземпляр класса `Supplier`.

**Возвращает**:
- `bool`: `True` в случае успешной загрузки настроек, `False` в случае ошибки.

**Вызывает исключения**:
- `DefaultSettingsException`: Если не удалось загрузить настройки.

**Примеры**:

```python
supplier = Supplier(supplier_prefix="test_supplier")
success = supplier._payload()
if success:
    print("Настройки успешно загружены")
else:
    print("Не удалось загрузить настройки")
```

### `login`

```python
def login(self) -> bool:
    """
    Args:
        self: экземпляр класса `Supplier`.

    Returns:
        bool: Возвращает `True` в случае успеха, `False` в случае ошибки.

    """
```

**Описание**: Выполняет вход на сайт поставщика.

**Как работает функция**:
Метод `login` вызывает метод `login` из динамически загруженного модуля поставщика, передавая ему экземпляр класса `Supplier`.

**Параметры**:
- `self`: Экземпляр класса `Supplier`.

**Возвращает**:
- `bool`: `True`, если вход выполнен успешно, `False` в противном случае.

**Примеры**:

```python
supplier = Supplier(supplier_prefix="test_supplier")
if supplier.login():
    print("Вход выполнен успешно")
else:
    print("Не удалось выполнить вход")
```

### `run_scenario_files`

```python
def run_scenario_files(self, scenario_files: Optional[str | List[str]] = None) -> bool:
    """
    Args:
        self: экземпляр класса `Supplier`.
        scenario_files (Optional[str | List[str]], optional): Список файлов сценариев или путь к одному файлу. Если не указан, использует `self.scenario_files`. По умолчанию `None`.

    Returns:
        bool: Возвращает `True` в случае успеха, `False` в случае ошибки.

    """
```

**Описание**: Выполняет сценарии, указанные в файлах.

**Как работает функция**:
Метод `run_scenario_files` вызывает функцию `run_scenario_files` из модуля `src.scenario` для выполнения сценариев. Если `scenario_files` не указан, используется список файлов из атрибута `self.scenario_files`.

**Параметры**:
- `self`: Экземпляр класса `Supplier`.
- `scenario_files`: Список файлов сценариев для выполнения. Если не указан, используется `self.scenario_files`.

**Возвращает**:
- `bool`: `True`, если все сценарии выполнены успешно, `False` в противном случае.

**Примеры**:

```python
supplier = Supplier(supplier_prefix="test_supplier", scenario_files=["scenario1.json", "scenario2.json"])
if supplier.run_scenario_files():
    print("Сценарии из файлов выполнены успешно")
else:
    print("Не удалось выполнить сценарии из файлов")

# Пример с указанием файлов сценариев
if supplier.run_scenario_files(scenario_files=["new_scenario.json"]):
    print("Сценарий из new_scenario.json выполнен успешно")
else:
    print("Не удалось выполнить сценарий из new_scenario.json")
```

### `run_scenarios`

```python
def run_scenarios(self, scenarios: dict | List[dict]) -> bool:
    """
    Args:
        self: экземпляр класса `Supplier`.
        scenarios (dict | List[dict]): Словарь или список словарей, представляющих сценарии.

    Returns:
        bool: Возвращает `True` в случае успеха, `False` в случае ошибки.

    """
```

**Описание**: Выполняет сценарии, переданные как словарь или список словарей.

**Как работает функция**:
Метод `run_scenarios` вызывает функцию `run_scenarios` из модуля `src.scenario` для выполнения сценариев.

**Параметры**:
- `self`: Экземпляр класса `Supplier`.
- `scenarios`: Словарь или список словарей, представляющих сценарии.

**Возвращает**:
- `bool`: `True`, если все сценарии выполнены успешно, `False` в противном случае.

**Примеры**:

```python
supplier = Supplier(supplier_prefix="test_supplier")
scenarios = {"step1": "action1", "step2": "action2"}
if supplier.run_scenarios(scenarios):
    print("Сценарий выполнен успешно")
else:
    print("Не удалось выполнить сценарий")

# Пример с передачей списка сценариев
scenarios = [{"step1": "action1"}, {"step2": "action2"}]
if supplier.run_scenarios(scenarios):
    print("Сценарии выполнены успешно")
else:
    print("Не удалось выполнить сценарии")
```