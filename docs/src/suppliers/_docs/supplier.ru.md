# Класс Supplier

## Обзор

Класс `Supplier` является базовым классом для работы с поставщиками данных в приложении `hypotez`. Он предоставляет общие методы и атрибуты, которые используются или переопределяются в конкретных реализациях поставщиков (например, Amazon, AliExpress, Walmart и т.д.). Класс инкапсулирует логику взаимодействия с сайтом, настройку драйвера, управление сценариями и парсинг данных.

## Подробнее

Класс служит основой для создания более специфичных классов, предназначенных для каждого поставщика данных. Он определяет общие свойства и методы, которые могут быть переопределены в конкретных реализациях для работы с различными сайтами и API.
## Классы

### `Supplier`

**Описание**: Базовый класс для работы с поставщиками данных.

**Принцип работы**:

Класс `Supplier` предназначен для обеспечения унифицированного интерфейса для взаимодействия с различными поставщиками данных. При инициализации класса загружаются настройки поставщика, инициализируется веб-драйвер и настраиваются параметры локализации. Класс предоставляет методы для входа на сайт поставщика, запуска сценариев и обработки данных.

#### Атрибуты:

- `supplier_id` (str): Уникальный идентификатор поставщика.
- `supplier_prefix` (str): Префикс для поставщика, например, `aliexpress` или `amazon`.
- `supplier_settings` (dict): Настройки для поставщика, загруженные из файла конфигурации.
- `locale` (str): Код локализации (например, `en` для английского, `ru` для русского).
- `price_rule` (str): Правило для расчета цены (например, добавление НДС или скидки).
- `related_modules` (module): Модуль, содержащий специфические для поставщика функции.
- `scenario_files` (list[str]): Список файлов сценариев, которые должны быть выполнены.
- `current_scenario` (dict): Текущий сценарий выполнения.
- `login_data` (dict): Данные для входа на сайт поставщика (если требуется).
- `locators` (dict): Локаторы для веб-элементов на страницах сайта поставщика.
- `driver` (Driver): Веб-драйвер для взаимодействия с сайтом поставщика.
- `parsing_method` (str): Метод парсинга данных (например, `webdriver`, `api`, `xls`, `csv`).

#### Методы:
- `__init__`: Конструктор класса, инициализирующий атрибуты.
- `_payload`: Загружает настройки поставщика, конфигурационные файлы и инициализирует веб-драйвер.
- `login`: Метод для выполнения входа на сайт поставщика (если требуется).
- `run_scenario_files`: Запускает выполнение файлов сценариев.
- `run_scenarios`: Запускает один или несколько сценариев.

## Методы класса `Supplier`

### `__init__`

```python
def __init__(self, supplier_prefix: str, locale: str = 'en', webdriver: str | Driver | bool = 'default', *attrs, **kwargs)
```

**Назначение**: Инициализация экземпляра класса `Supplier`.

**Параметры**:

- `supplier_prefix` (str): Префикс поставщика (например, 'aliexpress').
- `locale` (str): Локаль поставщика (например, 'en' или 'ru'). По умолчанию 'en'.
- `webdriver` (str | Driver | bool): Используемый веб-драйвер. Может быть строкой ('default', 'chrome', 'firefox'), экземпляром класса `Driver` или булевым значением. По умолчанию 'default'.
- `*attrs`: Дополнительные атрибуты.
- `**kwargs`: Дополнительные именованные аргументы.

**Как работает функция**:

1. **Инициализация атрибутов**: Устанавливает значения атрибутов `supplier_prefix` и `locale` из переданных аргументов.
2. **Логирование**: Выводит информационное сообщение о создании поставщика с указанным префиксом и локалью.

```
Инициализация атрибутов -> Логирование
```

**Примеры**:

```python
# Создание объекта поставщика с префиксом 'aliexpress' и локалью 'en'
supplier = Supplier(supplier_prefix='aliexpress', locale='en')

# Создание объекта поставщика с префиксом 'amazon' и использованием драйвера Chrome
supplier = Supplier(supplier_prefix='amazon', webdriver='chrome')
```

### `_payload`

```python
def _payload(self, webdriver: str | Driver | bool, *attrs, **kwargs) -> bool
```

**Назначение**: Загрузка настроек поставщика, конфигурационных файлов и инициализация веб-драйвера.

**Параметры**:

- `webdriver` (str | Driver | bool): Используемый веб-драйвер. Может быть строкой ('default', 'chrome', 'firefox'), экземпляром класса `Driver` или булевым значением.
- `*attrs`: Дополнительные атрибуты.
- `**kwargs`: Дополнительные именованные аргументы.

**Возвращает**:

- `bool`: `True`, если загрузка и инициализация прошли успешно, иначе `False`.

**Как работает функция**:

1. **Определение пути к файлу настроек**: Формирует путь к файлу настроек поставщика на основе префикса поставщика.
2. **Загрузка настроек**: Загружает настройки поставщика из JSON-файла с использованием `j_loads`.
3. **Инициализация локаторов и сценариев**: Загружает локаторы и сценарии из файлов, указанных в настройках поставщика.
4. **Инициализация веб-драйвера**: Инициализирует веб-драйвер на основе переданного аргумента `webdriver`.
5. **Обработка исключений**: Ловит исключения при загрузке настроек, инициализации локаторов, сценариев или веб-драйвера и логирует ошибки.

```
Определение пути к файлу настроек -> Загрузка настроек -> Инициализация локаторов и сценариев -> Инициализация веб-драйвера -> Обработка исключений
```

**Примеры**:

```python
# Загрузка настроек с использованием драйвера Chrome
result = supplier._payload(webdriver='chrome')

# Загрузка настроек с использованием экземпляра драйвера
driver = Driver(Chrome)
result = supplier._payload(webdriver=driver)
```

### `login`

```python
def login(self) -> bool
```

**Назначение**: Выполнение входа на сайт поставщика (если требуется).

**Возвращает**:

- `bool`: `True`, если вход выполнен успешно, иначе `False`.

**Как работает функция**:

1. **Проверка наличия данных для входа**: Проверяет, есть ли данные для входа в атрибуте `login_data`.
2. **Логирование**: Выводит информационное сообщение о попытке входа на сайт поставщика.
3. **Выполнение сценария входа**: Выполняет сценарий входа, если данные для входа предоставлены.
4. **Обработка исключений**: Ловит исключения при выполнении сценария входа и логирует ошибки.

```
Проверка наличия данных для входа -> Логирование -> Выполнение сценария входа -> Обработка исключений
```

**Примеры**:

```python
# Выполнение входа на сайт поставщика
result = supplier.login()
```

### `run_scenario_files`

```python
def run_scenario_files(self, scenario_files: str | List[str] = None) -> bool
```

**Назначение**: Запуск выполнения файлов сценариев.

**Параметры**:

- `scenario_files` (str | List[str]): Список файлов сценариев для выполнения. Если `None`, используются файлы сценариев, указанные в настройках поставщика. По умолчанию `None`.

**Возвращает**:

- `bool`: `True`, если выполнение сценариев завершено успешно, иначе `False`.

**Как работает функция**:

1. **Определение списка файлов сценариев**: Определяет список файлов сценариев для выполнения. Если `scenario_files` не указан, используются файлы, указанные в настройках поставщика.
2. **Выполнение сценариев**: Выполняет каждый файл сценария из списка.
3. **Логирование**: Логирует информацию о начале и завершении выполнения каждого сценария.
4. **Обработка исключений**: Ловит исключения при выполнении сценариев и логирует ошибки.

```
Определение списка файлов сценариев -> Выполнение сценариев -> Логирование -> Обработка исключений
```

**Примеры**:

```python
# Запуск сценариев из указанных файлов
result = supplier.run_scenario_files(['scenario1.json', 'scenario2.json'])

# Запуск сценариев, указанных в настройках поставщика
result = supplier.run_scenario_files()
```

### `run_scenarios`

```python
def run_scenarios(self, scenarios: dict | list[dict]) -> bool
```

**Назначение**: Запуск одного или нескольких сценариев.

**Параметры**:

- `scenarios` (dict | list[dict]): Список сценариев для выполнения.

**Возвращает**:

- `bool`: `True`, если выполнение сценариев завершено успешно, иначе `False`.

**Как работает функция**:

1. **Проверка типа сценариев**: Проверяет, является ли аргумент `scenarios` словарем или списком словарей.
2. **Выполнение сценариев**: Выполняет каждый сценарий из списка.
3. **Логирование**: Логирует информацию о начале и завершении выполнения каждого сценария.
4. **Обработка исключений**: Ловит исключения при выполнении сценариев и логирует ошибки.

```
Проверка типа сценариев -> Выполнение сценариев -> Логирование -> Обработка исключений
```

**Примеры**:

```python
# Запуск одного сценария
result = supplier.run_scenarios({'action': 'scrape', 'target': 'product_list'})

# Запуск нескольких сценариев
result = supplier.run_scenarios([
    {'action': 'scrape', 'target': 'product_list'},
    {'action': 'check_price', 'target': 'product_price'}
])
```

## Пример использования

```python
# Создаем объект для поставщика 'aliexpress'
supplier = Supplier(supplier_prefix='aliexpress', locale='en', webdriver='chrome')

# Выполняем вход на сайт поставщика
supplier.login()

# Запускаем сценарии из файлов
supplier.run_scenario_files(['example_scenario.json'])

# Или запускаем сценарии по определенным условиям
supplier.run_scenarios([{'action': 'scrape', 'target': 'product_list'}])
```