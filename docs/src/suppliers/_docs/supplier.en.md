# Модуль `Supplier`

## Обзор

Модуль `Supplier` предоставляет базовый класс для управления поставщиками данных в приложении `hypotez`. Он обеспечивает основу для взаимодействия с различными источниками данных, такими как Amazon, AliExpress, Walmart и другие. Этот класс отвечает за инициализацию настроек, специфичных для поставщика, управление сценариями сбора данных, а также предоставляет методы для входа в систему и выполнения сценариев.

## Подробней

Класс `Supplier` является основой для создания классов, специфичных для каждого поставщика данных. Он содержит общую логику и атрибуты, необходимые для взаимодействия с поставщиками, и может быть расширен для реализации уникальных функций и настроек каждого поставщика.

## Классы

### `Supplier`

**Описание**: Базовый класс для управления поставщиками данных.

**Принцип работы**:
Класс `Supplier` предоставляет структуру для управления поставщиками данных, включая загрузку конфигураций, аутентификацию и выполнение сценариев сбора данных. Класс предназначен для наследования другими классами, специфичными для конкретных поставщиков.

**Атрибуты**:

- `supplier_id` (str): Уникальный идентификатор поставщика.
- `supplier_prefix` (str): Префикс поставщика, например, `aliexpress` или `amazon`.
- `supplier_settings` (dict): Настройки поставщика, загруженные из конфигурационного файла.
- `locale` (str): Код локализации (например, `en` для английского, `ru` для русского).
- `price_rule` (str): Правило для расчета цен (например, добавление НДС или применение скидок).
- `related_modules` (module): Модуль, содержащий специфичные для поставщика функции.
- `scenario_files` (List[str]): Список файлов сценариев для выполнения.
- `current_scenario` (dict): Текущий выполняемый сценарий.
- `login_data` (dict): Учетные данные для входа на сайт поставщика (если требуется).
- `locators` (dict): Локаторы для веб-элементов на сайте поставщика.
- `driver` (Driver): Веб-драйвер для взаимодействия с сайтом поставщика.
- `parsing_method` (str): Метод для парсинга данных (например, `webdriver`, `api`, `xls`, `csv`).

**Методы**:

- `__init__`: Конструктор класса `Supplier`.
- `_payload`: Загружает специфичные для поставщика конфигурации, локаторы и инициализирует веб-драйвер.
- `login`: Обрабатывает процесс входа в систему для сайта поставщика, если требуется аутентификация.
- `run_scenario_files`: Выполняет один или несколько файлов сценариев.
- `run_scenarios`: Выполняет один или несколько сценариев.

## Функции

### `__init__`

```python
def __init__(self, supplier_prefix: str, locale: str = 'en', webdriver: str | Driver | bool = 'default', *attrs, **kwargs) -> None:
    """
    Инициализирует атрибуты класса `Supplier` на основе префикса поставщика и других параметров.

    Args:
        supplier_prefix (str): Префикс поставщика, например, 'aliexpress' или 'amazon'.
        locale (str): Код локализации (например, 'en' для английского, 'ru' для русского). По умолчанию 'en'.
        webdriver (str | Driver | bool): Веб-драйвер для взаимодействия с сайтом поставщика. Может быть строкой, экземпляром класса `Driver` или булевым значением. По умолчанию 'default'.
        *attrs: Дополнительные атрибуты.
        **kwargs: Дополнительные именованные аргументы.

    Returns:
        None

    Raises:
        Отсутствуют.

    Пример:
        supplier = Supplier(supplier_prefix='aliexpress', locale='ru', webdriver='chrome')
    """
```

**Назначение**: Инициализация экземпляра класса `Supplier`.

**Параметры**:
- `supplier_prefix` (str): Префикс поставщика, указывающий на конкретного поставщика данных (например, 'aliexpress', 'amazon').
- `locale` (str): Языковой стандарт, используемый для локализации (например, 'en' для английского, 'ru' для русского). По умолчанию 'en'.
- `webdriver` (str | Driver | bool): Определяет, какой веб-драйвер использовать для взаимодействия с веб-сайтом поставщика. Может быть строкой ('default', 'chrome', 'firefox'), экземпляром класса `Driver` или булевым значением. По умолчанию 'default'.
- `*attrs`: Дополнительные позиционные аргументы, передаваемые в конструктор.
- `**kwargs`: Дополнительные именованные аргументы, передаваемые в конструктор.

**Возвращает**:
- `None`

**Вызывает исключения**:
- Отсутствуют.

**Как работает функция**:
1. Инициализирует основные атрибуты класса, такие как `supplier_prefix`, `locale` и `driver`.
2. Загружает конфигурационные файлы, специфичные для поставщика, включая настройки, локаторы и другие параметры.
3. Инициализирует веб-драйвер для взаимодействия с сайтом поставщика.

```
Инициализация Supplier
│
├── Получение префикса поставщика и локали
│
├── Загрузка конфигурационных файлов
│
└── Инициализация веб-драйвера
```

**Примеры**:

```python
supplier = Supplier(supplier_prefix='aliexpress', locale='ru', webdriver='chrome')
```

### `_payload`

```python
def _payload(self, webdriver: str | Driver | bool, *attrs, **kwargs) -> bool:
    """
    Загружает специфичные для поставщика конфигурации, локаторы и инициализирует веб-драйвер.

    Args:
        webdriver (str | Driver | bool): Веб-драйвер для взаимодействия с сайтом поставщика.
        *attrs: Дополнительные атрибуты.
        **kwargs: Дополнительные именованные аргументы.

    Returns:
        bool: Возвращает `True`, если все конфигурации успешно загружены и веб-драйвер инициализирован, в противном случае - `False`.

    Raises:
        Exception: Если возникает ошибка при загрузке конфигурационных файлов или инициализации веб-драйвера.

    Пример:
        result = supplier._payload(webdriver='chrome')
    """
```

**Назначение**: Загрузка конфигураций и инициализация веб-драйвера.

**Параметры**:
- `webdriver` (str | Driver | bool): Определяет, какой веб-драйвер использовать для взаимодействия с веб-сайтом поставщика. Может быть строкой ('default', 'chrome', 'firefox'), экземпляром класса `Driver` или булевым значением.
- `*attrs`: Дополнительные позиционные аргументы, передаваемые в функцию.
- `**kwargs`: Дополнительные именованные аргументы, передаваемые в функцию.

**Возвращает**:
- `bool`: `True`, если все конфигурации успешно загружены и веб-драйвер инициализирован, иначе `False`.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при загрузке конфигурационных файлов или инициализации веб-драйвера.

**Как работает функция**:
1. Загружает конфигурационные файлы, специфичные для поставщика, включая настройки, локаторы и другие параметры.
2. Инициализирует веб-драйвер для взаимодействия с сайтом поставщика.
3. Возвращает `True`, если все операции выполнены успешно, иначе `False`.

```
Загрузка конфигурации
│
├── Загрузка настроек поставщика
│
├── Загрузка локаторов веб-элементов
│
└── Инициализация веб-драйвера
```

**Примеры**:

```python
result = supplier._payload(webdriver='chrome')
```

### `login`

```python
def login(self) -> bool:
    """
    Обрабатывает процесс входа в систему для сайта поставщика, если требуется аутентификация.

    Returns:
        bool: Возвращает `True`, если вход в систему выполнен успешно, в противном случае - `False`.

    Raises:
        Exception: Если возникает ошибка во время входа в систему.

    Пример:
        result = supplier.login()
    """
```

**Назначение**: Аутентификация на сайте поставщика.

**Параметры**:
- Отсутствуют.

**Возвращает**:
- `bool`: `True`, если вход в систему выполнен успешно, иначе `False`.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка во время входа в систему.

**Как работает функция**:
1. Проверяет, требуется ли аутентификация для данного поставщика.
2. Если аутентификация требуется, выполняет процесс входа в систему, используя учетные данные, хранящиеся в `login_data`.
3. Возвращает `True`, если вход в систему выполнен успешно, иначе `False`.

```
Процесс входа в систему
│
├── Проверка необходимости аутентификации
│
├── Выполнение входа в систему (если требуется)
│
└── Возврат результата (True/False)
```

**Примеры**:

```python
result = supplier.login()
```

### `run_scenario_files`

```python
def run_scenario_files(self, scenario_files: str | List[str] = None) -> bool:
    """
    Выполняет один или несколько файлов сценариев.

    Args:
        scenario_files (str | List[str], optional): Путь к файлу сценария или список путей к файлам сценариев. По умолчанию `None`.

    Returns:
        bool: Возвращает `True`, если все сценарии успешно выполнены, в противном случае - `False`.

    Raises:
        Exception: Если возникает ошибка при выполнении сценариев.

    Пример:
        result = supplier.run_scenario_files(['example_scenario.json'])
    """
```

**Назначение**: Выполнение сценариев из файлов.

**Параметры**:
- `scenario_files` (str | List[str], optional): Путь к файлу сценария или список путей к файлам сценариев. По умолчанию `None`.

**Возвращает**:
- `bool`: `True`, если все сценарии успешно выполнены, иначе `False`.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при выполнении сценариев.

**Как работает функция**:
1. Проверяет, указаны ли файлы сценариев для выполнения.
2. Выполняет каждый сценарий из указанных файлов.
3. Возвращает `True`, если все сценарии выполнены успешно, иначе `False`.

```
Выполнение сценариев из файлов
│
├── Проверка наличия файлов сценариев
│
├── Выполнение каждого сценария
│
└── Возврат результата (True/False)
```

**Примеры**:

```python
result = supplier.run_scenario_files(['example_scenario.json'])
```

### `run_scenarios`

```python
def run_scenarios(self, scenarios: dict | list[dict]) -> bool:
    """
    Выполняет один или несколько сценариев.

    Args:
        scenarios (dict | list[dict]): Словарь или список словарей, представляющих сценарии для выполнения.

    Returns:
        bool: Возвращает `True`, если все сценарии успешно выполнены, в противном случае - `False`.

    Raises:
        Exception: Если возникает ошибка при выполнении сценариев.

    Пример:
        result = supplier.run_scenarios([{'action': 'scrape', 'target': 'product_list'}])
    """
```

**Назначение**: Выполнение сценариев.

**Параметры**:
- `scenarios` (dict | list[dict]): Словарь или список словарей, представляющих сценарии для выполнения.

**Возвращает**:
- `bool`: `True`, если все сценарии успешно выполнены, иначе `False`.

**Вызывает исключения**:
- `Exception`: Если возникает ошибка при выполнении сценариев.

**Как работает функция**:
1. Проверяет, указаны ли сценарии для выполнения.
2. Выполняет каждый сценарий из указанного списка.
3. Возвращает `True`, если все сценарии выполнены успешно, иначе `False`.

```
Выполнение сценариев
│
├── Проверка наличия сценариев
│
├── Выполнение каждого сценария
│
└── Возврат результата (True/False)
```

**Примеры**:

```python
result = supplier.run_scenarios([{'action': 'scrape', 'target': 'product_list'}])
```

## Примеры

Пример использования класса `Supplier`:

```python
# Создание объекта Supplier для 'aliexpress'
supplier = Supplier(supplier_prefix='aliexpress', locale='en', webdriver='chrome')

# Выполнение входа на сайт поставщика
supplier.login()

# Выполнение файлов сценариев
supplier.run_scenario_files(['example_scenario.json'])

# Или выполнение конкретных сценариев
supplier.run_scenarios([{'action': 'scrape', 'target': 'product_list'}])
```

## Заключение

Класс `Supplier` предоставляет структурированный способ взаимодействия с поставщиками данных, управляя конфигурациями, выполняя вход в систему и выполняя сценарии сбора данных. Он служит базовым компонентом, который можно расширить для конкретных поставщиков, унаследовав от этого базового класса и добавляя или переопределяя функциональность по мере необходимости.