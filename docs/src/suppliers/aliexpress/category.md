# Модуль управления категориями Aliexpress

Этот модуль предоставляет функциональные возможности для управления категориями на AliExpress. Он позволяет извлекать URL-адреса продуктов, обновлять списки категорий и взаимодействовать с платформой AliExpress для синхронизации категорий.

## Обзор

Модуль содержит различные функции и методы для взаимодействия с категориями продуктов на AliExpress, включая извлечение URL-адресов продуктов, обновление категорий в файлах сценариев и управление данными категорий в базе данных.

### Основные характеристики:
- **Извлечение URL-адресов продуктов**: Собирает URL-адреса продуктов со страниц категорий.
- **Синхронизация категорий**: Сравнивает и обновляет категории на сайте с категориями в локальных файлах сценариев.
- **Взаимодействие с базой данных**: Предлагает операции с базой данных для управления категориями.

## Функции

### `get_list_products_in_category(s: Supplier) -> list[str, str]`

Извлекает список URL-адресов продуктов со страницы категории, включая пагинацию.

#### Параметры:
- `s` (`Supplier`): Экземпляр поставщика с драйвером браузера и локаторами.

#### Возвращает:
- Список URL-адресов продуктов со страницы категории.

#### Как работает функция:

1. Функция принимает экземпляр класса `Supplier`, содержащий информацию о поставщике, включая драйвер браузера и локаторы элементов на странице.
2.  Функция использует драйвер браузера для навигации по страницам категорий на сайте AliExpress.
3.  Извлекает URL-адреса продуктов с каждой страницы категории. При этом обрабатывается пагинация, то есть переход на следующие страницы категории для сбора всех доступных URL-адресов.
4.  Возвращает список собранных URL-адресов продуктов.

```
    Начало
    │
    ├── Получение URL-адресов продуктов с текущей страницы
    │   │
    │   └── Проверка наличия пагинации (других страниц категории)
    │       │
    │       ├── Если есть пагинация:
    │       │   │
    │       │   └── Переход на следующую страницу
    │       │       │
    │       │       └── Получение URL-адресов продуктов со следующей страницы
    │       │
    │       └── Если нет пагинации:
    │           │
    │           └── Завершение сбора URL-адресов
    │
    └── Возврат списка URL-адресов
```

#### Примеры:
```python
from src.suppliers.aliexpress.category import get_list_products_in_category
from src.suppliers.aliexpress.supplier import Supplier

# Создание экземпляра поставщика (требуется настроенный драйвер и локаторы)
supplier_instance = Supplier()  
# Получение списка URL-адресов продуктов из категории
category_urls = get_list_products_in_category(supplier_instance)

if category_urls:
    print(f"Найдено {len(category_urls)} URL-адресов продуктов в категории.")
    # Вывод первых нескольких URL-адресов для примера
    for url in category_urls[:5]:
        print(url)
else:
    print("Не удалось получить URL-адреса продуктов из категории.")
```

---

### `get_prod_urls_from_pagination(s: Supplier) -> list[str]`

Извлекает URL-адреса продуктов со страниц категорий, обрабатывая пагинацию.

#### Параметры:
- `s` (`Supplier`): Экземпляр поставщика с драйвером браузера и локаторами.

#### Возвращает:
- Список URL-адресов продуктов.

#### Как работает функция:

1.  Функция принимает экземпляр класса `Supplier`, содержащий информацию о поставщике, включая драйвер браузера и локаторы элементов на странице.
2.  Осуществляет навигацию по страницам категорий, учитывая пагинацию (переходы между страницами).
3.  Извлекает URL-адреса продуктов с каждой посещенной страницы.
4.  Возвращает список всех собранных URL-адресов.

```
    Начало
    │
    ├── Переход к первой странице категории
    │
    ├── Цикл по страницам пагинации:
    │   │
    │   ├── Извлечение URL-адресов продуктов с текущей страницы
    │   │
    │   └── Переход к следующей странице (если есть)
    │
    └── Возврат списка URL-адресов
```

#### Примеры:
```python
from src.suppliers.aliexpress.category import get_prod_urls_from_pagination
from src.suppliers.aliexpress.supplier import Supplier

# Создание экземпляра поставщика (требуется настроенный драйвер и локаторы)
supplier_instance = Supplier()  
# Получение списка URL-адресов продуктов из категории с учетом пагинации
product_urls = get_prod_urls_from_pagination(supplier_instance)

if product_urls:
    print(f"Найдено {len(product_urls)} URL-адресов продуктов с учетом пагинации.")
    # Вывод первых нескольких URL-адресов для примера
    for url in product_urls[:5]:
        print(url)
else:
    print("Не удалось получить URL-адреса продуктов с учетом пагинации.")
```

---

### `update_categories_in_scenario_file(s: Supplier, scenario_filename: str) -> bool`

Сравнивает категории на сайте с категориями в предоставленном файле сценария и обновляет файл любыми изменениями.

#### Параметры:
- `s` (`Supplier`): Экземпляр поставщика с драйвером браузера и локаторами.
- `scenario_filename` (`str`): Имя файла сценария, который необходимо обновить.

#### Возвращает:
- `True`, если категории были успешно обновлены, `False` в противном случае.

#### Как работает функция:

1.  Функция принимает экземпляр класса `Supplier`, содержащий информацию о поставщике, включая драйвер браузера и локаторы элементов на странице, а также имя файла сценария, который нужно обновить.
2.  Извлекает список категорий с сайта AliExpress, используя драйвер браузера и локаторы.
3.  Считывает категории из файла сценария.
4.  Сравнивает категории, полученные с сайта, с категориями из файла сценария.
5.  Обновляет файл сценария, добавляя новые категории или изменяя существующие.
6.  Возвращает `True`, если обновление прошло успешно, и `False` в случае ошибки.

```
    Начало
    │
    ├── Получение списка категорий с сайта AliExpress
    │
    ├── Чтение списка категорий из файла сценария
    │
    ├── Сравнение списков категорий
    │
    ├── Обновление файла сценария (добавление/изменение категорий)
    │
    └── Возврат результата (True/False)
```

#### Примеры:
```python
from src.suppliers.aliexpress.category import update_categories_in_scenario_file
from src.suppliers.aliexpress.supplier import Supplier

# Создание экземпляра поставщика (требуется настроенный драйвер и локаторы)
supplier_instance = Supplier()  
# Имя файла сценария для обновления
scenario_file = 'aliexpress_categories.json'

# Обновление категорий в файле сценария
update_result = update_categories_in_scenario_file(supplier_instance, scenario_file)

if update_result:
    print(f"Категории в файле сценария '{scenario_file}' успешно обновлены.")
else:
    print(f"Не удалось обновить категории в файле сценария '{scenario_file}'.")
```

---

### `get_list_categories_from_site(s: Supplier, scenario_file: str, brand: str = '') -> list`

Извлекает список категорий с сайта AliExpress на основе предоставленного файла сценария.

#### Параметры:
- `s` (`Supplier`): Экземпляр поставщика с драйвером браузера и локаторами.
- `scenario_file` (`str`): Файл сценария, содержащий информацию о категориях.
- `brand` (`str`, optional): Фильтр по бренду для категорий.

#### Возвращает:
- Список категорий с сайта.

#### Как работает функция:

1.  Функция принимает экземпляр класса `Supplier`, содержащий информацию о поставщике, включая драйвер браузера и локаторы элементов на странице, имя файла сценария с категориями и, опционально, бренд для фильтрации.
2.  Читает файл сценария и получает список категорий, которые необходимо проверить на сайте.
3.  Использует драйвер браузера для навигации по сайту AliExpress и поиска указанных категорий.
4.  Если указан бренд, фильтрует категории по бренду.
5.  Возвращает список найденных категорий.

```
    Начало
    │
    ├── Чтение файла сценария
    │
    ├── Навигация по сайту AliExpress
    │
    ├── Поиск категорий на сайте
    │
    ├── Фильтрация по бренду (если указан)
    │
    └── Возврат списка категорий
```

#### Примеры:
```python
from src.suppliers.aliexpress.category import get_list_categories_from_site
from src.suppliers.aliexpress.supplier import Supplier

# Создание экземпляра поставщика (требуется настроенный драйвер и локаторы)
supplier_instance = Supplier()  
# Имя файла сценария с категориями
scenario_file = 'aliexpress_categories.json'
# Бренд для фильтрации категорий (опционально)
brand_name = 'ExampleBrand'

# Получение списка категорий с сайта
categories_list = get_list_categories_from_site(supplier_instance, scenario_file, brand_name)

if categories_list:
    print(f"Найдено {len(categories_list)} категорий на сайте.")
    # Вывод первых нескольких категорий для примера
    for category in categories_list[:5]:
        print(category)
else:
    print("Не удалось получить список категорий с сайта.")
```

---

## Классы

### `DBAdaptor`

Предоставляет методы для взаимодействия с базой данных, позволяя выполнять стандартные операции, такие как `SELECT`, `INSERT`, `UPDATE` и `DELETE` для записей `AliexpressCategory`.

**Методы**:
- `select`: Извлекает записи из таблицы `AliexpressCategory`.
- `insert`: Вставляет новую запись в таблицу `AliexpressCategory`.
- `update`: Обновляет существующую запись в таблице `AliexpressCategory`.
- `delete`: Удаляет запись из таблицы `AliexpressCategory`.

**Принцип работы**:
Класс `DBAdaptor` предназначен для унификации и упрощения работы с базой данных, содержащей информацию о категориях Aliexpress. Он предоставляет набор методов для выполнения основных операций CRUD (Create, Read, Update, Delete) над таблицей `AliexpressCategory`.

- **`select`**: Позволяет извлекать данные из таблицы `AliexpressCategory` на основе заданных критериев.
- **`insert`**: Добавляет новую запись в таблицу, представляющую новую категорию Aliexpress.
- **`update`**: Изменяет существующую запись в таблице, позволяя обновлять информацию о категории.
- **`delete`**: Удаляет запись из таблицы, когда категория больше не актуальна или не требуется.

Эти методы абстрагируют детали работы с базой данных, предоставляя простой и понятный интерфейс для взаимодействия с данными категорий Aliexpress.

---

## Зависимости

Этот модуль зависит от нескольких других модулей для различных функций:

- `src.db.manager_categories.suppliers_categories`: Для управления категориями в базе данных.
- `src.utils.jjson`: Для работы с данными JSON.
- `src.logger`: Для ведения журнала ошибок и сообщений.
- `requests`: Для выполнения HTTP-запросов для извлечения данных категорий с сайта AliExpress.

---

## Пример использования

```python
from src.suppliers.aliexpress.category import get_list_products_in_category, update_categories_in_scenario_file
from src.suppliers.aliexpress.supplier import Supplier

# Создание экземпляра поставщика (требуется настроенный драйвер и локаторы)
supplier_instance = Supplier()
# Пример использования
category_urls = get_list_products_in_category(supplier_instance)
update_categories_in_scenario_file(supplier_instance, 'example_scenario.json')
```

---

## Лицензия

Этот модуль лицензируется в соответствии с лицензией MIT.