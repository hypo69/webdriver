# Модуль: Сокращение партнерских ссылок AliExpress через веб-браузер

## Обзор

Этот модуль предназначен для сокращения партнерских ссылок AliExpress с использованием веб-браузера. Он предоставляет функцию для автоматического получения короткой партнерской ссылки из полной ссылки через веб-интерфейс AliExpress.

## Подробней

Модуль автоматизирует процесс получения коротких партнерских ссылок AliExpress. Он использует веб-драйвер для взаимодействия с сайтом AliExpress, вводит полную ссылку в соответствующее поле, нажимает на кнопку получения короткой ссылки и извлекает полученную короткую ссылку. Кроме того, модуль проверяет корректность полученной короткой ссылки, открывая ее в новой вкладке и проверяя, не ведет ли она на страницу ошибок.

## Функции

### `get_short_affiliate_link`

```python
def get_short_affiliate_link(d: Driver, url: str) -> str:
    """
    Получает сокращенную партнерскую ссылку.

    Args:
        d (Driver): Инстанс веб-драйвера.
        url (str): Полная URL, которую нужно сократить.

    Returns:
        str: Сокращенная URL.

    Raises:
        ValueError: Если не удалось получить короткую ссылку или если короткая ссылка ведет на страницу ошибок.

    """
```

**Назначение**: Получение сокращенной партнерской ссылки из полной ссылки через веб-интерфейс AliExpress.

**Параметры**:

-   `d` (Driver): Инстанс веб-драйвера, используемый для взаимодействия с веб-страницей.
-   `url` (str): Полная URL, которую необходимо сократить.

**Возвращает**:

-   `str`: Сокращенная партнерская URL.

**Вызывает исключения**:

-   `ValueError`: Генерируется, если не удалось получить короткую ссылку или если полученная короткая ссылка ведет на страницу ошибок.

**Как работает функция**:

1.  **Ввод URL в поле для ввода** (Ввод URL): Функция вводит полную URL в текстовое поле на странице AliExpress, предназначенное для ввода целевой URL.

2.  **Нажатие кнопки для получения короткой ссылки** (Нажатие кнопки): Функция нажимает кнопку, которая запускает процесс генерации короткой ссылки на сайте AliExpress.

3.  **Ожидание обновления страницы** (Ожидание): Функция ждет 1 секунду, чтобы убедиться, что страница обновилась и короткая ссылка была сгенерирована.

4.  **Получение короткой ссылки** (Получение ссылки): Функция извлекает короткую ссылку из соответствующего элемента на странице.

5.  **Сохранение идентификатора основной вкладки** (Сохранение вкладки): Функция сохраняет идентификатор основной вкладки браузера.

6.  **Проверка наличия короткой ссылки** (Проверка): Если длина полученной короткой ссылки меньше 1, это означает, что не удалось получить короткую ссылку, и функция регистрирует ошибку.

7.  **Открытие нового таба с короткой URL** (Открытие URL): Функция открывает новую вкладку в браузере с полученной короткой URL.

8.  **Переключение на новый таб** (Переключение): Функция переключается на новую открытую вкладку.

9.  **Проверка короткой URL** (Проверка URL): Функция проверяет, начинается ли текущая URL с `https://error.taobao.com`, что указывает на неправильную короткую ссылку. Если URL ведет на страницу ошибок, функция регистрирует ошибку, закрывает текущую вкладку и переключается обратно на основную вкладку.

10. **Закрытие нового таба и возврат к основной вкладке** (Закрытие вкладки): Функция закрывает текущую вкладку и переключается обратно на основную вкладку.

11. **Возврат короткой URL** (Возврат): Функция возвращает полученную короткую URL.

```
      Ввод URL --> Нажатие кнопки --> Ожидание --> Получение ссылки --> Сохранение вкладки --> Проверка
          |
          V
     +---------------------+
     | Длина ссылки < 1?   |
     +---------------------+
          | Да
          V
        Лог ошибки
          |
          V
      Открытие URL --> Переключение --> Проверка URL
          |
          V
     +----------------------------------------+
     | URL начинается с error.taobao.com?  |
     +----------------------------------------+
          | Да
          V
        Лог ошибки --> Закрытие вкладки --> Переключение
          |
          V
      Закрытие вкладки --> Переключение
          |
          V
          Возврат
```

**Примеры**:

```python
from src.webdriver.driver import Driver, Chrome

# Предположим, что у вас уже есть инстанс драйвера
driver = Driver(Chrome)
url = "https://www.aliexpress.com/item/10050000000000.html"
short_url = get_short_affiliate_link(driver, url)
print(f"Сокращенная ссылка: {short_url}")
```

```python
from src.webdriver.driver import Driver, Firefox

# Создание инстанса драйвера (пример с Firefox)
driver = Driver(Firefox)
url = "https://www.aliexpress.com/item/10050000000001.html"
short_url = get_short_affiliate_link(driver, url)
print(f"Сокращенная ссылка: {short_url}")