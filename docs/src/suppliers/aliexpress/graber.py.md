# Модуль для сбора данных о товарах с AliExpress

## Обзор

Модуль предназначен для сбора информации о товарах с веб-сайта AliExpress. Он содержит класс `Graber`, который наследуется от базового класса `src.suppliers.graber.Graber` и предоставляет методы для обработки различных полей товара на странице.

## Подробней

Этот модуль является частью системы сбора данных о товарах с различных платформ. Класс `Graber` специализируется на работе с AliExpress, предоставляя механизмы для извлечения информации о товарах, адаптированные под структуру и особенности этого веб-сайта. Модуль использует веб-драйвер для взаимодействия с сайтом, позволяя автоматизировать процесс сбора данных.
Перед отправкой запроса к веб-драйверу могут быть выполнены предварительные действия с использованием декоратора. Декоратор по умолчанию находится в родительском классе. Для активации декоратора необходимо передать значение в `Context.locator`.
Также возможно реализовать свой собственный декоратор, раскомментировав соответствующие строки кода и переопределив его поведение.

## Классы

### `Graber`

**Описание**: Класс для сбора данных о товарах с AliExpress.

**Наследует**:
- `src.suppliers.graber.Graber`: Предоставляет базовую функциональность для работы с веб-драйвером и обработки данных.

**Принцип работы**:
Класс инициализируется с экземпляром веб-драйвера и префиксом поставщика (`aliexpress`). Он использует методы родительского класса для навигации по страницам товаров и извлечения необходимой информации. При необходимости, методы обработки отдельных полей могут быть переопределены для адаптации к особенностям AliExpress. Также класс использует декоратор `@close_pop_up`, чтобы закрывать всплывающие окна перед выполнением основных действий.

**Аттрибуты**:
- `supplier_prefix` (str): Префикс поставщика, который указывает, что это класс для работы с AliExpress.

**Методы**:
- `__init__`: Инициализирует класс `Graber`, устанавливает префикс поставщика и вызывает конструктор родительского класса.

### `close_pop_up`
```python
def close_pop_up(value: Any = None) -> Callable:
    """
    Создает декоратор для закрытия всплывающих окон перед выполнением основной логики функции.

    Args:
        value (Any, optional): Дополнительное значение для декоратора. По умолчанию None.

    Returns:
        Callable: Декоратор, оборачивающий функцию.
    """
```
**Назначение**:
Декоратор `close_pop_up` предназначен для закрытия всплывающих окон, которые могут появляться на странице AliExpress, перед выполнением основной логики функции, к которой он применяется. Это необходимо для обеспечения стабильной работы с веб-драйвером и предотвращения блокировки элементов страницы всплывающими окнами.

**Параметры**:

- `value` (Any, optional): Дополнительное значение, которое можно передать декоратору. По умолчанию `None`.

**Возвращает**:

- `Callable`: Декоратор, который оборачивает функцию.

**Как работает декоратор**:

1. **Определение декоратора**: Функция `close_pop_up` принимает значение `value` и возвращает функцию `decorator`, которая, в свою очередь, принимает функцию `func` и возвращает функцию `wrapper`.

2. **Оборачивание функции**: Функция `wrapper` оборачивает функцию `func`, к которой применяется декоратор. Внутри `wrapper` происходит попытка закрытия всплывающего окна.

3. **Проверка наличия локатора**: Проверяется наличие локатора для закрытия всплывающего окна в `Context.locator_for_decorator` и `Context.locator_for_decorator.close_pop_up`.

4. **Выполнение локатора**: Если локатор найден, выполняется команда `await Context.driver.execute_locator(Context.locator_for_decorator.close_pop_up)` для закрытия всплывающего окна.

5. **Обработка исключений**: Если при выполнении локатора возникает исключение `ExecuteLocatorException`, оно логируется с помощью `logger.debug`.

6. **Выполнение основной функции**: После попытки закрытия всплывающего окна выполняется основная функция `func` с помощью `return await func(*args, **kwargs)`.

**ASCII flowchart**:

```
A: Определение декоратора close_pop_up
│
B: Определение wrapper
│
C: Проверка наличия локатора для закрытия всплывающего окна
│
D: Выполнение локатора для закрытия всплывающего окна
│
E: Обработка исключений при выполнении локатора
│
F: Выполнение основной функции func
```

## Функции

### `__init__`

```python
def __init__(self, driver: Driver, lang_index:int):
    """
    Инициализация класса сбора полей товара.

    Args:
        driver (Driver): Экземпляр веб-драйвера для взаимодействия с браузером.
        lang_index (int): Индекс языка.
    """
```

**Назначение**: Инициализация экземпляра класса `Graber`.

**Параметры**:
- `driver` (Driver): Экземпляр веб-драйвера, который будет использоваться для взаимодействия с веб-сайтом AliExpress.
- `lang_index` (int): Индекс языка.

**Как работает функция**:

1. **Инициализация префикса поставщика**: Устанавливает атрибут `supplier_prefix` в значение `'aliexpress'`.
2. **Вызов конструктора родительского класса**: Вызывает метод `__init__` родительского класса `Graber` (который, вероятно, является `src.suppliers.graber.Graber`) с передачей префикса поставщика и экземпляра веб-драйвера.
3. **Установка локатора для декоратора**: Устанавливает атрибут `Context.locator_for_decorator` в значение `None`. Это необходимо для того, чтобы декоратор `@close_pop_up` не выполнялся, если не задан соответствующий локатор.

**ASCII flowchart**:

```
A: Инициализация префикса поставщика (supplier_prefix = 'aliexpress')
│
B: Вызов конструктора родительского класса
│
C: Установка локатора для декоратора (Context.locator_for_decorator = None)
```

**Примеры**:

```python
from src.webdriver.driver import Driver, Chrome

# Создание инстанса драйвера (пример с Chrome)
driver = Driver(Chrome)

# Инициализация класса Graber
graber = Graber(driver=driver)