# Модуль для управления веб-сайтом

## Обзор

Модуль `website.py` отвечает за настройку и управление веб-сайтом с использованием фреймворка Flask. Он определяет маршруты для доступа к чату, обработки статических ресурсов (assets) и перенаправления на главную страницу чата.

## Подробней

Данный модуль является частью веб-интерфейса проекта `hypotez`. Он использует Flask для определения маршрутов и обработки запросов, что позволяет пользователям взаимодействовать с чат-ботом через веб-браузер. Маршруты определены в словаре `self.routes` и связывают URL-адреса с соответствующими функциями обработчиками.

## Классы

### `Website`

**Описание**:
Класс `Website` управляет маршрутизацией и отображением веб-страниц.

**Принцип работы**:
Класс инициализируется с приложением Flask, затем определяет маршруты веб-сайта в словаре `self.routes`. Каждый маршрут связывается с соответствующей функцией обработчиком и списком разрешенных HTTP-методов.

**Аттрибуты**:
- `app`: Экземпляр приложения Flask.
- `routes`: Словарь, содержащий маршруты веб-сайта и соответствующие обработчики.

**Методы**:
- `__init__(self, app)`: Инициализирует класс `Website` с приложением Flask.
- `_chat(self, conversation_id)`: Отображает страницу чата для указанного идентификатора беседы.
- `_index(self)`: Отображает главную страницу чата, генерируя уникальный идентификатор беседы.
- `_assets(self, folder: str, file: str)`: Отдает статические ресурсы (assets), такие как файлы JavaScript и CSS.

## Функции

### `__init__`

```python
def __init__(self, app) -> None:
    """
    Инициализирует класс Website.

    Args:
        app: Экземпляр приложения Flask.

    Returns:
        None: Ничего не возвращает.

    Raises:
        None: Не вызывает исключений.
    """
```

**Назначение**:
Инициализирует класс `Website`, сохраняя переданное приложение Flask и определяя маршруты веб-сайта.

**Параметры**:
- `app`: Экземпляр приложения Flask, который будет использоваться для маршрутизации.

**Возвращает**:
- `None`: Функция ничего не возвращает.

**Как работает функция**:
1. Функция сохраняет ссылку на приложение Flask в атрибуте `self.app`.
2. Функция определяет словарь `self.routes`, который связывает URL-адреса с соответствующими функциями обработчиками и HTTP-методами.

```
A: Инициализация Website
|
B: Сохранение app
|
C: Определение routes
```

**Примеры**:

```python
from flask import Flask
app = Flask(__name__)
website = Website(app)
```

### `_chat`

```python
def _chat(self, conversation_id):
    """
    Отображает страницу чата для указанного идентификатора беседы.

    Args:
        conversation_id: Идентификатор беседы.

    Returns:
        render_template('index.html', chat_id=conversation_id): Отображает шаблон index.html с указанным chat_id.
        redirect('/chat'): Перенаправляет на главную страницу чата, если conversation_id не содержит '-'.

    Raises:
        None: Не вызывает исключений.
    """
```

**Назначение**:
Отображает страницу чата для указанного идентификатора беседы.

**Параметры**:
- `conversation_id`: Идентификатор беседы, который используется для отображения соответствующей страницы чата.

**Возвращает**:
- `render_template('index.html', chat_id=conversation_id)`: Отображает шаблон `index.html` с указанным `chat_id`.
- `redirect('/chat')`: Перенаправляет на главную страницу чата, если `conversation_id` не содержит символ `-`.

**Как работает функция**:
1. Проверяет, содержит ли `conversation_id` символ `-`.
2. Если символ отсутствует, выполняет перенаправление на главную страницу чата (`/chat`).
3. Если символ присутствует, отображает шаблон `index.html`, передавая `conversation_id` в качестве параметра `chat_id`.

```
A: Получен conversation_id
|
B: Проверка наличия '-' в conversation_id
|
C: Если '-' отсутствует -> Перенаправление на '/chat'
|
D: Если '-' присутствует -> Отображение index.html с chat_id=conversation_id
```

**Примеры**:

```python
from flask import Flask
app = Flask(__name__)
website = Website(app)
with app.test_request_context('/chat/1234-5678-9012-3456'):
    result = website._chat('1234-5678-9012-3456')
    # Здесь result будет содержать отрендеренный шаблон index.html с chat_id='1234-5678-9012-3456'

with app.test_request_context('/chat/1234567890123456'):
    result = website._chat('1234567890123456')
    # Здесь result будет перенаправлением на '/chat'
```

### `_index`

```python
def _index(self):
    """
    Отображает главную страницу чата, генерируя уникальный идентификатор беседы.

    Args:
        None: Функция не принимает аргументов.

    Returns:
        render_template('index.html', chat_id=f'{urandom(4).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{hex(int(time() * 1000))[2:]}'):
        Отображает шаблон index.html с уникальным chat_id.

    Raises:
        None: Функция не вызывает исключений.
    """
```

**Назначение**:
Отображает главную страницу чата, генерируя уникальный идентификатор беседы.

**Параметры**:
- `None`: Функция не принимает аргументов.

**Возвращает**:
- `render_template('index.html', chat_id=f'{urandom(4).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{urandom(2).hex()}-{hex(int(time() * 1000))[2:]}')`:
Отображает шаблон `index.html` с уникальным `chat_id`, который генерируется случайным образом.

**Как работает функция**:
1. Генерирует уникальный идентификатор беседы, используя комбинацию случайных шестнадцатеричных чисел и текущего времени в миллисекундах.
2. Отображает шаблон `index.html`, передавая сгенерированный `chat_id` в качестве параметра.

```
A: Запрос на главную страницу чата
|
B: Генерация уникального chat_id
|
C: Отображение index.html с chat_id
```

**Примеры**:

```python
from flask import Flask
app = Flask(__name__)
website = Website(app)
with app.test_request_context('/chat'):
    result = website._index()
    # Здесь result будет содержать отрендеренный шаблон index.html с уникальным chat_id
```

### `_assets`

```python
def _assets(self, folder: str, file: str):
    """
    Отдает статические ресурсы (assets), такие как файлы JavaScript и CSS.

    Args:
        folder (str): Имя папки, в которой находится файл.
        file (str): Имя файла, который нужно отдать.

    Returns:
        send_file(f"./../client/{folder}/{file}", as_attachment=False): Отдает запрошенный файл.
        "File not found", 404: Возвращает сообщение об ошибке "File not found" и код 404, если файл не найден.

    Raises:
        None: Функция не вызывает исключений напрямую, но может возникнуть исключение OSError,
              если файл не найден или нет прав доступа.
    """
```

**Назначение**:
Отдает статические ресурсы (assets), такие как файлы JavaScript и CSS.

**Параметры**:
- `folder` (str): Имя папки, в которой находится файл.
- `file` (str): Имя файла, который нужно отдать.

**Возвращает**:
- `send_file(f"./../client/{folder}/{file}", as_attachment=False)`: Отдает запрошенный файл.
- `"File not found", 404`: Возвращает сообщение об ошибке "File not found" и код 404, если файл не найден.

**Как работает функция**:
1. Пытается отдать запрошенный файл с использованием функции `send_file`.
2. Если файл не найден, перехватывает исключение и возвращает сообщение об ошибке "File not found" с кодом 404.

```
A: Запрос на asset
|
B: Попытка отдать файл send_file
|
C: Если файл найден -> Отдача файла
|
D: Если файл не найден -> Возврат "File not found", 404
```

**Примеры**:

```python
from flask import Flask
app = Flask(__name__)
website = Website(app)
with app.test_request_context('/assets/js/app.js'):
    result = website._assets('js', 'app.js')
    # Здесь result будет содержать файл app.js, если он существует