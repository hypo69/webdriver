# Документация модуля GetGpt.py

## Обзор

Модуль `GetGpt.py` предоставляет функциональность для взаимодействия с веб-сайтом chat.getgpt.world и получения ответов от модели gpt-3.5-turbo. Он включает в себя функции шифрования данных и отправки запросов для получения ответов в потоковом режиме.

## Подробнее

Этот модуль предназначен для использования в проекте `hypotez` для обеспечения доступа к модели gpt-3.5-turbo через веб-интерфейс chat.getgpt.world. Он включает в себя функции для шифрования запросов, отправки их на сервер и обработки потоковых ответов. Модуль использует библиотеки `requests`, `Crypto`, `json` и `uuid`.

## Функции

### `_create_completion`

```python
def _create_completion(model: str, messages: list, stream: bool, **kwargs):
    """Создает запрос к chat.getgpt.world и возвращает ответ в потоковом режиме.

    Args:
        model (str): Имя модели для использования (в данном случае всегда 'gpt-3.5-turbo').
        messages (list): Список сообщений для отправки модели.
        stream (bool): Флаг, указывающий на необходимость потоковой передачи ответа.
        **kwargs: Дополнительные параметры, такие как `frequency_penalty`, `max_tokens`, `presence_penalty`, `temperature`, `top_p`.

    Returns:
        Generator[str, None, None]: Генератор, выдающий части ответа от модели.

    Raises:
        requests.exceptions.RequestException: Если возникает ошибка при отправке запроса.

    **Внутренние функции**:
    - `encrypt(e)`: Шифрует переданные данные с использованием AES.
    - `pad_data(data: bytes) -> bytes`: Дополняет данные до размера блока AES.
    """
```

**Назначение**: Функция `_create_completion` отвечает за отправку запроса к API `chat.getgpt.world` и получение ответа в потоковом режиме. Она шифрует данные запроса, отправляет их на сервер и обрабатывает потоковые ответы, генерируя части ответа.

**Параметры**:

*   `model` (str): Имя используемой модели (всегда `'gpt-3.5-turbo'`).
*   `messages` (list): Список сообщений для отправки модели.
*   `stream` (bool): Флаг, указывающий, следует ли использовать потоковый режим.
*   `**kwargs`: Дополнительные параметры, передаваемые модели, такие как:

    *   `frequency_penalty` (float): Штраф за частоту.
    *   `max_tokens` (int): Максимальное количество токенов в ответе.
    *   `presence_penalty` (float): Штраф за присутствие.
    *   `temperature` (float): Температура генерации.
    *   `top_p` (float): Top-p выборка.

**Возвращает**:

*   `Generator[str, None, None]`: Генератор, который выдает части ответа от модели в виде строк.

**Вызывает исключения**:

*   `requests.exceptions.RequestException`: В случае ошибки при отправке запроса.

**Внутренние функции**:

*   `encrypt(e)`:
    ```python
    def encrypt(e):
        """Шифрует входные данные с использованием AES.

        Args:
            e (str): Строка для шифрования.

        Returns:
            str: Зашифрованная строка.
        """
    ```

    **Назначение**: Шифрует входную строку `e` с использованием алгоритма AES. Генерирует случайные векторы инициализации (IV) и ключи, шифрует данные и возвращает зашифрованную строку вместе с IV и ключом.

    **Параметры**:

    *   `e` (str): Строка, которую необходимо зашифровать.

    **Возвращает**:

    *   `str`: Зашифрованная строка, содержащая зашифрованные данные, IV и ключ.

*   `pad_data(data: bytes) -> bytes`:
    ```python
    def pad_data(data: bytes) -> bytes:
        """Дополняет данные до размера блока AES.

        Args:
            data (bytes): Данные для дополнения.

        Returns:
            bytes: Дополненные данные.
        """
    ```

    **Назначение**: Дополняет входные данные (`data`) до размера блока, необходимого для алгоритма AES. Это необходимо, поскольку AES работает с блоками фиксированного размера.

    **Параметры**:

    *   `data` (bytes): Данные для дополнения.

    **Возвращает**:

    *   `bytes`: Дополненные данные.

**Как работает функция**:

1.  **Шифрование данных**: Функция принимает входные параметры, включая сообщения, и упаковывает их в JSON. Затем она шифрует JSON-данные с использованием функции `encrypt`.
2.  **Подготовка заголовков**: Функция подготавливает заголовки HTTP-запроса, включая `Content-Type`, `Referer` и `user-agent`.
3.  **Отправка запроса**: Функция отправляет POST-запрос на `https://chat.getgpt.world/api/chat/stream` с зашифрованными данными в теле запроса и подготовленными заголовками.
4.  **Обработка потокового ответа**: Функция итерируется по строкам потокового ответа, декодирует каждую строку, извлекает содержимое ответа и выдает его через генератор.

**ASCII flowchart**:

```
    Начало
    │
    ├──> Шифрование данных (encrypt)
    │
    ├──> Подготовка заголовков
    │
    ├──> Отправка POST-запроса
    │
    ├──> Итерация по строкам ответа
    │
    ├──> Извлечение содержимого
    │
    └──> Выдача содержимого через генератор
    │
    Конец
```

**Примеры**:

```python
# Пример вызова функции _create_completion
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
kwargs = {"max_tokens": 100}
response_generator = _create_completion(model="gpt-3.5-turbo", messages=messages, stream=stream, **kwargs)
for chunk in response_generator:
    print(chunk, end="")

# Пример вызова с другими параметрами
messages = [{"role": "user", "content": "Tell me a joke."}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}
response_generator = _create_completion(model="gpt-3.5-turbo", messages=messages, stream=stream, **kwargs)
for chunk in response_generator:
    print(chunk, end="")
```

## Переменные

### `url`

```python
url = 'https://chat.getgpt.world/'
```

URL веб-сайта, с которым происходит взаимодействие.

### `model`

```python
model = ['gpt-3.5-turbo']
```

Список поддерживаемых моделей. В данном случае, только `gpt-3.5-turbo`.

### `supports_stream`

```python
supports_stream = True
```

Флаг, указывающий, что провайдер поддерживает потоковый режим.

### `needs_auth`

```python
needs_auth = False
```

Флаг, указывающий, требуется ли аутентификация для использования провайдера.

### `params`

```python
params = f'g4f.Providers.{os.path.basename(__file__)[:-3]} supports: ' + \
    '(%s)' % ', '.join(
        [f'{name}: {get_type_hints(_create_completion)[name].__name__}' for name in _create_completion.__code__.co_varnames[:_create_completion.__code__.co_argcount]])
```

Строка, содержащая информацию о поддерживаемых типах параметров функции `_create_completion`.