# Модуль для взаимодействия с chatbot.theb.ai
=================================================

Модуль предназначен для отправки запросов к API chatbot.theb.ai и обработки полученных ответов. Он использует библиотеку `curl-cffi` для выполнения HTTP-запросов и регулярные выражения для извлечения контента из ответов.

## Обзор

Этот модуль отправляет запросы к API `chatbot.theb.ai` для получения ответов на заданные вопросы. Он использует библиотеку `curl-cffi` для выполнения HTTP-запросов и регулярные выражения для извлечения контента из ответов. Модуль обрабатывает возможные ошибки и повторяет запросы в случае неудачи.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для взаимодействия с API `chatbot.theb.ai`. Он принимает конфигурацию через аргументы командной строки, формирует HTTP-запрос с необходимыми заголовками и данными, отправляет запрос к API и обрабатывает полученные ответы. В случае возникновения ошибок, модуль повторяет запросы до тех пор, пока не получит успешный ответ.

## Функции

### `format`

```python
def format(chunk: bytes) -> None:
    """Форматирует и выводит полученный чанк данных.

    Args:
        chunk (bytes): Чанк данных, полученный от сервера.

    Returns:
        None

    Raises:
        Exception: Возникает, если не удается извлечь контент из чанка.

    """
```

**Назначение**: Форматирует и выводит полученный чанк данных.

**Параметры**:
- `chunk` (bytes): Чанк данных, полученный от сервера.

**Возвращает**:
- `None`

**Вызывает исключения**:
- `Exception`: Возникает, если не удается извлечь контент из чанка.

**Как работает функция**:

1.  **Извлечение контента**: Функция пытается извлечь контент из переданного чанка данных, используя регулярное выражение `r'content":"(.*)"},"fin'`.

2.  **Вывод контента**: Если контент успешно извлечен, он выводится в стандартный поток вывода с помощью `print(completion_chunk, flush=True, end='')`. Параметр `flush=True` обеспечивает немедленный вывод данных, а `end=''` предотвращает добавление символа новой строки после каждого вывода.

3.  **Обработка ошибок**: Если в процессе извлечения контента возникает исключение, функция перехватывает его и выводит сообщение об ошибке, содержащее информацию о чанке данных. После этого функция завершает свою работу и возвращает `None`.

**Внутренние функции**: Нет

**Примеры**:

```python
chunk1 = b'{"content":"Example content 1","fin'
format(chunk1) # выведет "Example content 1"

chunk2 = b'{"content":"Example content 2","fin'
format(chunk2) # выведет "Example content 2"
```

**ASCII flowchart**:

```
A[Получение чанка данных]
|
B[Попытка извлечения контента с использованием регулярного выражения]
|
C[Успешно извлечен контент?]
|
Yes
|
D[Вывод контента в стандартный поток вывода]
|
End
|
No
|
E[Вывод сообщения об ошибке]
|
End