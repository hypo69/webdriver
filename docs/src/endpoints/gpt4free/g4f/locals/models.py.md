# Модуль для работы с моделями gpt4free
========================================

Модуль содержит функции для загрузки, форматирования, чтения и сохранения моделей, используемых в gpt4free. Он обеспечивает получение информации о моделях из внешнего источника (gpt4all.io) или локального файла, а также предоставляет инструменты для управления этими моделями.

## Обзор

Этот модуль предоставляет набор функций для работы с моделями машинного обучения, используемыми в проекте `hypotez`. Он включает в себя функции для загрузки информации о моделях из внешнего источника, форматирования этой информации, чтения и сохранения моделей в локальном файле, а также для получения директории, в которой хранятся модели.

## Подробнее

Модуль `models.py` играет важную роль в управлении моделями машинного обучения, используемыми в проекте `hypotez`. Он предоставляет функции для загрузки, форматирования, чтения и сохранения информации о моделях. Это позволяет проекту гибко управлять используемыми моделями, получая информацию о них как из внешних источников, так и из локальных файлов.

## Функции

### `load_models`

```python
def load_models() -> dict:
    """
    Загружает информацию о моделях с сайта gpt4all.io.

    Returns:
        dict: Словарь, содержащий информацию о моделях.

    Raises:
        requests.exceptions.HTTPError: Если возникает ошибка при загрузке данных с сайта.
    """
```

**Назначение**: Загружает JSON файл со списком моделей с сайта gpt4all.io.

**Возвращает**:
   - `dict`: Возвращает словарь, содержащий информацию о моделях.

**Вызывает исключения**:
   - `requests.exceptions.HTTPError`: Если возникает ошибка при загрузке данных с сайта, вызывается исключение.

**Как работает функция**:

1. Выполняется HTTP GET запрос к "https://gpt4all.io/models/models3.json"
2. Если запрос завершается с кодом ошибки, то вызывается исключение `requests.exceptions.HTTPError`
3. В случае успешного ответа, полученные данные в формате JSON передаются в функцию `format_models`
4. Функция `format_models` форматирует полученные данные и возвращает результат.

**Примеры**:

```python
models = load_models()
print(models)
```

### `get_model_name`

```python
def get_model_name(filename: str) -> str:
    """
    Извлекает имя модели из имени файла.

    Args:
        filename (str): Имя файла модели.

    Returns:
        str: Имя модели.
    """
```

**Назначение**: Извлекает имя модели из имени файла, удаляя из него различные суффиксы и расширения.

**Параметры**:
   - `filename` (str): Имя файла модели.

**Возвращает**:
   - `str`: Имя модели.

**Как работает функция**:

1.  Функция принимает имя файла в качестве входных данных.
2.  Имя файла разделяется по первому вхождению символа ".", чтобы отделить имя файла от расширения.
3.  Производится последовательная замена определенных подстрок (суффиксов), таких как "-v1_5", "-v1", "-q4_0", "_v01", "-v0", "-f16", "-gguf2", "-newbpe", на пустую строку, чтобы очистить имя модели от лишних символов.
4.  Возвращается очищенное имя модели.

**Примеры**:

```python
filename = "ggml-mpt-7b-chat-newbpe-q4_0.bin"
model_name = get_model_name(filename)
print(model_name)  # Вывод: ggml-mpt-7b-chat
```

### `format_models`

```python
def format_models(models: list) -> dict:
    """
    Форматирует список моделей в словарь.

    Args:
        models (list): Список моделей.

    Returns:
        dict: Словарь, где ключи - имена моделей, а значения - информация о них.
    """
```

**Назначение**: Функция преобразует список моделей в словарь, где ключами являются имена моделей, а значениями - информация о каждой модели, такая как путь к файлу, требуемый объем оперативной памяти, шаблон подсказки и системное сообщение.

**Параметры**:
   - `models` (list): Список моделей, представленных в виде словарей.

**Возвращает**:
   - `dict`: Словарь, где ключи - имена моделей, а значения - информация о них.

**Как работает функция**:

1.  Функция принимает список моделей в качестве входных данных.
2.  Для каждой модели в списке извлекается имя файла, путь к файлу, требуемый объем оперативной памяти, шаблон подсказки и системное сообщение.
3.  Имя модели извлекается из имени файла с помощью функции `get_model_name`.
4.  Информация о каждой модели сохраняется в словаре, где ключом является имя модели, а значением - словарь с информацией о модели.

**Примеры**:

```python
models = [
    {"filename": "ggml-mpt-7b-chat-newbpe-q4_0.bin", "ramrequired": "8 GB", "promptTemplate": "<prompt>", "systemPrompt": "<system>"},
    {"filename": "ggml-vicuna-13b-v1.3-q4_0.bin", "ramrequired": "16 GB"}
]
formatted_models = format_models(models)
print(formatted_models)
```

### `read_models`

```python
def read_models(file_path: str) -> dict:
    """
    Читает информацию о моделях из файла.

    Args:
        file_path (str): Путь к файлу с информацией о моделях.

    Returns:
        dict: Словарь, содержащий информацию о моделях.
    """
```

**Назначение**: Читает данные о моделях из JSON файла.

**Параметры**:
   - `file_path` (str): Путь к файлу с информацией о моделях.

**Возвращает**:
   - `dict`: Словарь, содержащий информацию о моделях.

**Как работает функция**:

1.  Функция принимает путь к файлу в качестве входных данных.
2.  Открывает файл в режиме чтения ("rb") с помощью конструкции `with open(file_path, "rb") as f:`. Это гарантирует, что файл будет автоматически закрыт после завершения работы с ним.
3.  Загружает данные из файла в формате JSON с помощью функции `json.load(f)` и возвращает их.

**Примеры**:

```python
file_path = "models.json"
models = read_models(file_path)
print(models)
```

### `save_models`

```python
def save_models(file_path: str, data: dict) -> None:
    """
    Сохраняет информацию о моделях в файл.

    Args:
        file_path (str): Путь к файлу для сохранения информации о моделях.
        data (dict): Данные для сохранения.
    """
```

**Назначение**: Сохраняет информацию о моделях в JSON файл.

**Параметры**:
   - `file_path` (str): Путь к файлу для сохранения информации о моделях.
   - `data` (dict): Данные для сохранения.

**Как работает функция**:

1.  Функция принимает путь к файлу и данные для сохранения в качестве входных данных.
2.  Открывает файл в режиме записи ("w") с помощью конструкции `with open(file_path, 'w') as f:`. Это гарантирует, что файл будет автоматически закрыт после завершения работы с ним.
3.  Записывает данные в файл в формате JSON с помощью функции `json.dump(data, f, indent=4)`. Параметр `indent=4` обеспечивает красивое форматирование JSON файла с отступами в 4 пробела.

**Примеры**:

```python
file_path = "models.json"
data = {"model1": {"path": "path1"}, "model2": {"path": "path2"}}
save_models(file_path, data)
```

### `get_model_dir`

```python
def get_model_dir() -> str:
    """
    Возвращает путь к директории с моделями.

    Returns:
        str: Путь к директории с моделями.
    """
```

**Назначение**: Определяет и возвращает путь к директории, в которой хранятся модели.

**Возвращает**:
   - `str`: Путь к директории с моделями.

**Как работает функция**:

1.  Функция определяет путь к текущему файлу (`models.py`) с помощью `os.path.abspath(__file__)` и получает директорию, в которой он находится, с помощью `os.path.dirname()`.
2.  Затем функция поднимается на один уровень выше, чтобы получить директорию проекта, снова используя `os.path.dirname()`.
3.  Формируется путь к директории "models" внутри директории проекта с помощью `os.path.join(project_dir, "models")`.
4.  Если директория "models" не существует, она создается с помощью `os.mkdir(model_dir)`.
5.  Возвращается путь к директории "models".

**Примеры**:

```python
model_dir = get_model_dir()
print(model_dir)
```

### `get_models`

```python
def get_models() -> dict[str, dict]:
    """
    Получает информацию о моделях из файла или загружает с сайта, если файла нет.

    Returns:
        dict[str, dict]: Словарь, где ключи - имена моделей, а значения - информация о них.
    """
```

**Назначение**: Возвращает словарь с информацией о моделях. Если файл с моделями существует, информация считывается из файла. Если файл не существует, информация загружается с сайта gpt4all.io, сохраняется в файл и возвращается.

**Возвращает**:
   - `dict[str, dict]`: Словарь, где ключи - имена моделей, а значения - информация о них.

**Как работает функция**:

1.  Функция получает путь к директории с моделями с помощью `get_model_dir()`.
2.  Формируется путь к файлу "models.json" внутри директории с моделями с помощью `os.path.join(model_dir, "models.json")`.
3.  Если файл "models.json" существует, функция считывает информацию о моделях из файла с помощью `read_models(file_path)` и возвращает ее.
4.  Если файл "models.json" не существует, функция загружает информацию о моделях с сайта gpt4all.io с помощью `load_models()`, сохраняет ее в файл с помощью `save_models(file_path, models)` и возвращает ее.

**Примеры**:

```python
models = get_models()
print(models)
```