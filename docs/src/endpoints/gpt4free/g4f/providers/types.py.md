# Модуль `types.py`

## Обзор

Модуль содержит базовые классы для реализации провайдеров, используемых для взаимодействия с различными сервисами, предоставляющими функциональность, например, для работы с большими языковыми моделями (LLM). Он определяет абстрактные классы `BaseProvider` и `BaseRetryProvider`, которые служат основой для создания конкретных реализаций провайдеров, а также вспомогательный класс `Streaming` для работы с потоковыми данными.

## Подробнее

Этот модуль играет важную роль в архитектуре проекта, определяя интерфейсы и базовую функциональность для работы с различными провайдерами. Он обеспечивает гибкость и расширяемость, позволяя легко добавлять и использовать новые сервисы, а также предоставляет механизмы для обработки ошибок и повторных попыток при взаимодействии с ними. Расположение файла в структуре проекта указывает на его центральную роль в управлении провайдерами gpt4free.

## Классы

### `BaseProvider`

**Описание**: Абстрактный базовый класс для провайдеров. Определяет общие атрибуты и абстрактные методы, которые должны быть реализованы в дочерних классах.

**Принцип работы**:
Класс `BaseProvider` служит интерфейсом для всех провайдеров. Он определяет атрибуты, такие как `url`, `working`, `needs_auth`, `supports_stream`, `supports_message_history` и `supports_system_message`, которые описывают возможности и состояние провайдера. Кроме того, он содержит абстрактные методы `get_create_function` и `get_async_create_function`, которые должны быть реализованы в дочерних классах для предоставления синхронной и асинхронной функций создания запросов к провайдеру.

**Атрибуты**:

-   `url` (str): URL провайдера.
-   `working` (bool): Указывает, работает ли провайдер в данный момент.
-   `needs_auth` (bool): Указывает, требуется ли аутентификация для использования провайдера.
-   `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных.
-   `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
-   `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения.
-   `params` (str): Параметры провайдера.

**Методы**:

-   `get_create_function()`:

    ```python
    def get_create_function() -> callable:
        """
        Возвращает функцию создания для провайдера.

        Returns:
            callable: Функция создания.

        Raises:
            NotImplementedError: Если метод не реализован в дочернем классе.
        """
        raise NotImplementedError()
    ```

    **Назначение**: Возвращает функцию, которая используется для создания запросов к провайдеру. Этот метод должен быть реализован в каждом дочернем классе.

    **Как работает функция**:
    1.  Вызывает исключение `NotImplementedError`, если метод не реализован в дочернем классе.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        def get_create_function(self):
            return self._create

        def _create(self, *args, **kwargs):
            # Логика создания запроса
            pass
    ```

    ```
    Начало
    │
    └───> Выброс исключения NotImplementedError
    │
    Конец
    ```

-   `get_async_create_function()`:

    ```python
    def get_async_create_function() -> callable:
        """
        Возвращает асинхронную функцию создания для провайдера.

        Returns:
            callable: Асинхронная функция создания.

        Raises:
            NotImplementedError: Если метод не реализован в дочернем классе.
        """
        raise NotImplementedError()
    ```

    **Назначение**: Возвращает асинхронную функцию, которая используется для создания запросов к провайдеру. Этот метод должен быть реализован в каждом дочернем классе, если провайдер поддерживает асинхронные запросы.

    **Как работает функция**:
    1.  Вызывает исключение `NotImplementedError`, если метод не реализован в дочернем классе.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        def get_async_create_function(self):
            return self._create_async

        async def _create_async(self, *args, **kwargs):
            # Асинхронная логика создания запроса
            pass
    ```

    ```
    Начало
    │
    └───> Выброс исключения NotImplementedError
    │
    Конец
    ```

-   `get_dict()`:

    ```python
    @classmethod
    def get_dict(cls) -> Dict[str, str]:
        """
        Возвращает словарь с информацией о провайдере.

        Returns:
            Dict[str, str]: Словарь с деталями провайдера.
        """
        return {'name': cls.__name__, 'url': cls.url, 'label': getattr(cls, 'label', None)}
    ```

    **Назначение**: Возвращает словарь, содержащий информацию о провайдере, такую как его имя, URL и метку.

    **Как работает функция**:
    1.  Создает словарь, содержащий имя класса (`__name__`), URL и метку (если она определена).
    2.  Возвращает созданный словарь.

    **Примеры**:
    ```python
    class MyProvider(BaseProvider):
        url = "https://example.com"
        label = "Example Provider"

    provider_info = MyProvider.get_dict()
    print(provider_info)  # {'name': 'MyProvider', 'url': 'https://example.com', 'label': 'Example Provider'}
    ```

    ```
    Начало
    │
    └───> Создание словаря с информацией о провайдере
    │
    └───> Возврат словаря
    │
    Конец
    ```

### `BaseRetryProvider`

**Описание**: Базовый класс для провайдеров, реализующих логику повторных попыток.

**Наследует**: `BaseProvider`

**Принцип работы**:
Класс `BaseRetryProvider` расширяет `BaseProvider` и добавляет функциональность для автоматического повтора запросов при возникновении ошибок. Он использует список провайдеров (`providers`) для переключения между ними при неудачных попытках. Атрибут `shuffle` определяет, следует ли перемешивать список провайдеров перед каждой попыткой. `exceptions` хранит информацию об ошибках, возникших при использовании каждого провайдера. `last_provider` указывает на последнего использованного провайдера.

**Атрибуты**:

-   `__name__` (str): Имя провайдера, по умолчанию "RetryProvider".
-   `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (всегда `True`).
-   `last_provider` (Type[BaseProvider]): Последний использованный провайдер.

### `Streaming`

**Описание**: Класс для представления потоковых данных.

**Принцип работы**:
Класс `Streaming` используется для обертки потоковых данных, получаемых от провайдеров. Он содержит атрибут `data`, который хранит строку с данными. Метод `__str__` позволяет преобразовывать объект класса в строку.

**Атрибуты**:

-   `data` (str): Строка с потоковыми данными.

**Методы**:

-   `__init__(self, data: str) -> None`:

    ```python
    def __init__(self, data: str) -> None:
        """
        Инициализирует объект Streaming.

        Args:
            data (str): Строка с потоковыми данными.
        """
        self.data = data
    ```

    **Назначение**: Инициализирует объект класса `Streaming` строкой с данными.

    **Параметры**:

    -   `data` (str): Строка с потоковыми данными.

    **Как работает функция**:
    1.  Присваивает переданную строку `data` атрибуту `self.data`.

    **Примеры**:
    ```python
    streaming_data = Streaming("Пример потоковых данных")
    print(streaming_data.data)  # "Пример потоковых данных"
    ```

    ```
    Начало
    │
    └───> Присвоение значения атрибуту self.data
    │
    Конец
    ```

-   `__str__(self) -> str`:

    ```python
    def __str__(self) -> str:
        """
        Возвращает строковое представление объекта Streaming.

        Returns:
            str: Строка с данными.
        """
        return self.data
    ```

    **Назначение**: Возвращает строковое представление объекта `Streaming`, которое соответствует значению атрибута `data`.

    **Как работает функция**:
    1.  Возвращает значение атрибута `self.data`.

    **Примеры**:
    ```python
    streaming_data = Streaming("Пример потоковых данных")
    print(str(streaming_data))  # "Пример потоковых данных"
    ```

    ```
    Начало
    │
    └───> Возврат значения атрибута self.data
    │
    Конец
    ```

## Типы

### `ProviderType`

`ProviderType = Union[Type[BaseProvider], BaseRetryProvider]`

Определяет тип, который может быть либо типом `BaseProvider`, либо типом `BaseRetryProvider`.