# Модуль `TeachAnything.py`

## Обзор

Модуль предоставляет асинхронный генератор для взаимодействия с API `teach-anything.com`. Он позволяет генерировать ответы от AI моделей Gemini через асинхронные запросы. Модуль включает в себя классы для асинхронной работы с провайдером, миксин для моделей провайдеров и вспомогательные функции для форматирования запросов.

## Подробнее

Этот модуль предназначен для интеграции с веб-сайтом `teach-anything.com` и использования его API для генерации текста с использованием моделей Gemini. Он поддерживает выбор модели, передачу сообщений и обработку ответов в асинхронном режиме.

## Классы

### `TeachAnything`

**Описание**: Класс `TeachAnything` представляет собой асинхронный генератор провайдера, который также использует `ProviderModelMixin` для работы с моделями.

**Принцип работы**:
Класс наследует функциональность асинхронного генератора и предоставляет методы для настройки и отправки запросов к API `teach-anything.com`. Он также определяет заголовки запросов и обрабатывает ответы, возвращая их в виде асинхронного генератора.

**Атрибуты**:
- `url` (str): Базовый URL веб-сайта `teach-anything.com`.
- `api_endpoint` (str): URL endpoint для генерации ответов.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `default_model` (str): Модель, используемая по умолчанию (`gemini-1.5-pro`).
- `models` (List[str]): Список поддерживаемых моделей (`gemini-1.5-pro`, `gemini-1.5-flash`).

**Методы**:
- `create_async_generator`: Создает асинхронный генератор для получения ответов от API.
- `_get_headers`: Возвращает словарь с заголовками запроса.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str | None = None,
        **kwargs: Any
    ) -> AsyncResult:
        """
        Создает асинхронный генератор для получения ответов от API teach-anything.com.

        Args:
            model (str): Имя используемой модели.
            messages (Messages): Список сообщений для отправки в API.
            proxy (str | None, optional): URL прокси-сервера. По умолчанию `None`.
            **kwargs (Any): Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, возвращающий ответы от API.

        Как работает функция:
        1. Устанавливает заголовки запроса, используя метод `_get_headers`.
        2. Получает имя модели, используя метод `get_model`.
        3. Открывает асинхронную сессию с помощью `ClientSession`.
        4. Форматирует запрос, используя функцию `format_prompt`.
        5. Отправляет POST-запрос к API `teach-anything.com`.
        6. Читает ответ по частям (chunks) и декодирует его.
        7. Возвращает декодированные части через `yield`.
        8. Обрабатывает оставшиеся данные в буфере после завершения чтения.
        9. В случае ошибки декодирования выводит сообщение об ошибке.

        Внутренние функции:
        - Отсутствуют

        """
```

```text
    Назначение: Создание асинхронного генератора для получения ответов от API teach-anything.com.

    Параметры:
    - model (str): Имя используемой модели.
    - messages (Messages): Список сообщений для отправки в API.
    - proxy (str | None, optional): URL прокси-сервера. По умолчанию `None`.
    - **kwargs (Any): Дополнительные аргументы.

    Возвращает:
    - AsyncResult: Асинхронный генератор, возвращающий ответы от API.
```

```text
flowchart TB
    subgraph create_async_generator
        A[Устанавливает заголовки запроса]
        B[Получает имя модели]
        C[Открывает асинхронную сессию]
        D[Форматирует запрос]
        E[Отправляет POST-запрос к API]
        F[Читает ответ по частям и декодирует]
        G[Возвращает декодированные части через yield]
        H[Обрабатывает оставшиеся данные в буфере]
        I[Обрабатывает ошибки декодирования]

        A --> B
        B --> C
        C --> D
        D --> E
        E --> F
        F --> G
        G --> H
        H --> I
    end
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
model = "gemini-1.5-pro"
messages = [{"role": "user", "content": "Tell me about the capital of France."}]
proxy = None
async_generator = TeachAnything.create_async_generator(model=model, messages=messages, proxy=proxy)
```

### `_get_headers`

```python
    @staticmethod
    def _get_headers() -> Dict[str, str]:
        """
        Возвращает словарь с заголовками запроса.

        Returns:
            Dict[str, str]: Словарь с заголовками запроса.

        Как работает функция:
        1. Определяет словарь с необходимыми HTTP-заголовками.
        2. Возвращает этот словарь.

        Внутренние функции:
        - Отсутствуют
        """
```

```text
Назначение: Возвращает словарь с HTTP-заголовками для запроса.

    Параметры:
    - Отсутствуют

    Возвращает:
    - Dict[str, str]: Словарь с заголовками запроса.
```

```text
flowchart TB
    subgraph _get_headers
        A[Определяет словарь с HTTP-заголовками]
        B[Возвращает словарь]

        A --> B
    end
```

**Примеры**:

```python
# Пример вызова функции _get_headers
headers = TeachAnything._get_headers()
print(headers)