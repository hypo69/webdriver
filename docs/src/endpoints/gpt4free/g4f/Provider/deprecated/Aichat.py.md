# Модуль `Aichat.py`

## Обзор

Модуль предоставляет класс `Aichat`, который является асинхронным провайдером для взаимодействия с моделью чата на платформе chat-gpt.org. Он использует cookies для аутентификации и отправляет запросы к API для получения текстовых ответов. Модуль поддерживает модель `gpt-3.5-turbo`.

## Подробней

Этот модуль предназначен для интеграции с платформой `chat-gpt.org` и использует асинхронные запросы для получения ответов от языковой модели. Он обрабатывает установку cookies, формирование заголовков запроса и обработку ответов API. Этот файл находится в подкаталоге `deprecated`, что может указывать на то, что он больше не рекомендуется для использования.

## Классы

### `Aichat`

**Описание**: Класс `Aichat` является асинхронным провайдером для взаимодействия с моделью чата `chat-gpt.org`.

**Наследует**:

- `AsyncProvider`: класс `Aichat` наследует функциональность асинхронного провайдера от `AsyncProvider`.

**Атрибуты**:

- `url` (str): URL-адрес для взаимодействия с `chat-gpt.org` (`"https://chat-gpt.org/chat"`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (`False`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (`True`).

**Методы**:

- `create_async()`: Асинхронный метод для создания запроса и получения ответа от модели чата.

## Функции

### `create_async`

```python
    @staticmethod
    async def create_async(
        model: str,
        messages: Messages,
        proxy: str = None, **kwargs) -> str:
        """
        Асинхронно создает запрос к chat-gpt.org и возвращает ответ модели.

        Args:
            model (str): Имя используемой модели.
            messages (Messages): Список сообщений для отправки в запросе.
            proxy (str, optional): Прокси-сервер для использования. По умолчанию `None`.
            **kwargs: Дополнительные именованные аргументы, такие как `cookies`, `temperature`, `top_p`.

        Returns:
            str: Ответ модели чата.

        Raises:
            RuntimeError: Если не удалось получить cookies.
            Exception: Если получен некорректный ответ от API.
        """
```

**Назначение**: Метод `create_async` отправляет асинхронный запрос к API `chat-gpt.org` и возвращает ответ модели чата.

**Параметры**:

- `model` (str): Имя используемой модели.
- `messages` (`Messages`): Список сообщений для отправки в запросе.
- `proxy` (str, optional): Прокси-сервер для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные именованные аргументы, такие как `cookies` (cookies для аутентификации), `temperature` (температура модели), `top_p` (вероятность выбора наиболее вероятного токена).

**Возвращает**:

- `str`: Ответ модели чата.

**Вызывает исключения**:

- `RuntimeError`: Если не удалось получить cookies.
- `Exception`: Если получен некорректный ответ от API.

**Как работает функция**:

1.  **Получение cookies**: Проверяет наличие cookies в `kwargs` и пытается получить их с помощью `get_cookies('chat-gpt.org')`, если они не предоставлены. Если cookies получить не удается, выбрасывается исключение `RuntimeError`.
2.  **Формирование заголовков**: Определяет заголовки запроса, включая `authority`, `accept`, `content-type`, `origin` и `user-agent`.
3.  **Создание сессии**: Использует `StreamSession` для создания асинхронной сессии с заданными заголовками, cookies, таймаутом и прокси (если указан).
4.  **Формирование JSON-данных**: Создает JSON-данные для отправки в запросе, включая отформатированное сообщение, температуру, `top_p` и другие параметры.
5.  **Отправка запроса**: Отправляет POST-запрос к API `https://chat-gpt.org/api/text` с JSON-данными.
6.  **Обработка ответа**: Проверяет статус ответа и преобразует его в JSON. Если в ответе отсутствует поле `response` или оно пустое, выбрасывается исключение `Exception`.
7.  **Возврат результата**: Возвращает сообщение из поля `message` полученного JSON-ответа.

```
  Начало
  │
  ├── Проверка наличия cookies
  │   │
  │   └── Получение cookies (если отсутствуют)
  │       │
  │       └── Выброс RuntimeError (если cookies не получены)
  │
  ├── Формирование заголовков запроса
  │   │
  │   └── Создание асинхронной сессии (StreamSession)
  │       │
  │       └── Формирование JSON-данных
  │           │
  │           └── Отправка POST-запроса к API
  │               │
  │               └── Обработка ответа
  │                   │
  │                   └── Выброс Exception (если ответ некорректен)
  │                       │
  │                       └── Извлечение сообщения из JSON-ответа
  │                           │
  │                           └── Возврат сообщения
  │                               │
  Конец
```

**Примеры**:

Пример 1:

```python
    messages = [{"role": "user", "content": "Hello, how are you?"}]
    response = await Aichat.create_async(model="gpt-3.5-turbo", messages=messages)
    print(response)
```

Пример 2 (с использованием прокси и cookies):

```python
    messages = [{"role": "user", "content": "Tell me a joke."}]
    cookies = {"cookie_name": "cookie_value"}
    response = await Aichat.create_async(model="gpt-3.5-turbo", messages=messages, proxy="http://proxy:8080", cookies=cookies)
    print(response)
```