# Модуль Equing

## Обзор

Модуль `Equing` предоставляет класс `Equing`, который является провайдером для взаимодействия с сервисом [next.eqing.tech](https://next.eqing.tech/) для получения ответов от моделей GPT. Модуль поддерживает стриминг ответов и работу с моделью `gpt-3.5-turbo`.

## Подробнее

Этот модуль является частью системы провайдеров, используемых в проекте `hypotez` для получения ответов от различных языковых моделей. Он реализует абстрактный класс `AbstractProvider` и предоставляет конкретную реализацию для взаимодействия с сервисом Equing.

## Классы

### `Equing`

**Описание**: Класс `Equing` предоставляет реализацию для взаимодействия с сервисом Equing.

**Наследует**:
- `AbstractProvider`: Абстрактный класс, определяющий интерфейс для всех провайдеров.

**Атрибуты**:
- `url` (str): URL-адрес сервиса Equing (`https://next.eqing.tech/`).
- `working` (bool): Указывает, работает ли провайдер в данный момент (`False`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер стриминг ответов (`True`).
- `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель `gpt-3.5-turbo` (`True`).
- `supports_gpt_4` (bool): Указывает, поддерживает ли провайдер модель `gpt-4` (`False`).

**Методы**:
- `create_completion`: Метод для создания запроса на получение ответа от модели.

## Функции

### `create_completion`

```python
    @staticmethod
    @abstractmethod
    def create_completion(
        model: str,
        messages: list[dict[str, str]],
        stream: bool, **kwargs: Any) -> CreateResult:
        """ Функция создает запрос на получение ответа от модели.

        Args:
            model (str): Идентификатор модели, используемой для генерации ответа.
            messages (list[dict[str, str]]): Список сообщений для передачи модели.
            stream (bool): Флаг, указывающий, следует ли использовать потоковый режим.
            **kwargs (Any): Дополнительные аргументы для передачи в запрос.

        Returns:
            CreateResult: Результат выполнения запроса.

        Raises:
            Exception: Если возникает ошибка при выполнении запроса.
        """
```

**Назначение**: Метод `create_completion` создает запрос к API Equing для получения ответа от языковой модели. Он поддерживает потоковый и не потоковый режимы работы.

**Параметры**:
- `model` (str): Идентификатор модели, используемой для генерации ответа.
- `messages` (list[dict[str, str]]): Список сообщений для передачи модели.
- `stream` (bool): Флаг, указывающий, следует ли использовать потоковый режим.
- `**kwargs` (Any): Дополнительные аргументы для передачи в запрос (например, `temperature`, `presence_penalty`, `frequency_penalty`, `top_p`).

**Возвращает**:
- `CreateResult`: Результат выполнения запроса.

**Вызывает исключения**:
- Отсутствуют явные исключения, но могут возникать исключения при выполнении запроса к API.

**Как работает функция**:

1.  **Формирование заголовков**: Создаются заголовки запроса, включающие информацию о типе контента, User-Agent и другие необходимые параметры.
2.  **Формирование тела запроса**: Создается JSON-объект с данными для запроса, включающими сообщения, модель, флаг потоковой передачи и другие параметры, переданные через `kwargs`.
3.  **Выполнение POST-запроса**: Отправляется POST-запрос к API Equing с использованием библиотеки `requests`.
4.  **Обработка ответа**:
    *   Если `stream` установлен в `False`, извлекается и возвращается содержимое ответа.
    *   Если `stream` установлен в `True`, ответ обрабатывается построчно, извлекаются токены содержимого, и каждый токен возвращается как часть генератора.

**ASCII flowchart**:

```
    Начало
     ↓
    Создание заголовков
     ↓
    Формирование тела запроса (JSON)
     ↓
    POST-запрос к API Equing
     ↓
    Обработка ответа: stream == False?
     ├── Нет (stream == True)
     │   ↓
     │   Чтение ответа построчно
     │   ↓
     │   Извлечение токенов содержимого
     │   ↓
     │   Возврат токена (генератор)
     │   ↓
     └── Да (stream == False)
         ↓
         Извлечение содержимого ответа
         ↓
         Возврат содержимого
         ↓
    Конец
```

**Примеры**:

1.  **Не потоковый режим**:

```python
messages = [{"role": "user", "content": "Hello, how are you?"}]
result = Equing.create_completion(model="gpt-3.5-turbo", messages=messages, stream=False)
for item in result:
    print(item)
```

2.  **Потоковый режим**:

```python
messages = [{"role": "user", "content": "Tell me a story."}]
result = Equing.create_completion(model="gpt-3.5-turbo", messages=messages, stream=True, temperature=0.7)
for item in result:
    print(item)