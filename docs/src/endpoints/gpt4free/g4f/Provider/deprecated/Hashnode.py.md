# Модуль для работы с провайдером Hashnode (устаревший)

## Обзор

Модуль содержит класс `Hashnode`, который является устаревшим провайдером для взаимодействия с сервисом Hashnode. Он поддерживает асинхронную генерацию ответов на основе предоставленных сообщений, а также имеет функциональность для поиска информации в интернете.

## Подробней

Модуль `Hashnode.py` предназначен для интеграции с платформой Hashnode и использования ее возможностей для генерации текста на основе запросов. Он использует асинхронные запросы для взаимодействия с API Hashnode и предоставляет методы для настройки параметров запроса, таких как тип поиска и прокси. Этот модуль является частью набора провайдеров, предназначенных для работы с различными сервисами генерации текста.

## Классы

### `SearchTypes`

**Описание**: Класс, содержащий статические атрибуты, определяющие типы поиска, которые можно использовать с Hashnode.

**Атрибуты**:
- `quick` (str): Строка "quick", представляющая быстрый поиск.
- `code` (str): Строка "code", представляющая поиск кода.
- `websearch` (str): Строка "websearch", представляющая поиск в интернете.

### `Hashnode`

**Описание**: Класс, представляющий провайдера Hashnode для генерации текста.

**Наследует**:
- `AsyncGeneratorProvider`: Наследует от базового класса асинхронных провайдеров, обеспечивая поддержку асинхронной генерации.

**Атрибуты**:
- `url` (str): URL адрес сервиса Hashnode ("https://hashnode.com").
- `working` (bool): Логическое значение, указывающее, работает ли провайдер (в данном случае `False`).
- `supports_message_history` (bool): Логическое значение, указывающее, поддерживает ли провайдер историю сообщений (`True`).
- `supports_gpt_35_turbo` (bool): Логическое значение, указывающее, поддерживает ли провайдер модель GPT-3.5 Turbo (`True`).
- `_sources` (list): Список источников, полученных в результате поиска.

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для получения ответов от Hashnode.
- `get_sources()`: Возвращает список источников в формате, пригодном для использования.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    search_type: str = SearchTypes.websearch,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для получения ответов от Hashnode.

    Args:
        model (str): Модель, используемая для генерации ответа.
        messages (Messages): Список сообщений, представляющих историю разговора.
        search_type (str, optional): Тип поиска, который необходимо выполнить. По умолчанию `SearchTypes.websearch`.
        proxy (str, optional): Адрес прокси-сервера для использования. По умолчанию `None`.
        **kwargs: Дополнительные аргументы.

    Returns:
        AsyncResult: Асинхронный генератор, выдающий части ответа от Hashnode.

    Raises:
        aiohttp.ClientResponseError: Если возникает ошибка при выполнении HTTP-запроса.

    """
```

**Назначение**: Создает асинхронный генератор для получения ответов от Hashnode.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.
- `model` (str): Модель, используемая для генерации ответа.
- `messages` (Messages): Список сообщений, представляющих историю разговора.
- `search_type` (str, optional): Тип поиска, который необходимо выполнить. По умолчанию `SearchTypes.websearch`.
- `proxy` (str, optional): Адрес прокси-сервера для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий части ответа от Hashnode.

**Вызывает исключения**:
- `aiohttp.ClientResponseError`: Если возникает ошибка при выполнении HTTP-запроса.

**Как работает функция**:

1.  **Подготовка заголовков**: Функция `create_async_generator` начинает с подготовки заголовков HTTP-запроса, которые будут отправлены на сервер Hashnode. Эти заголовки включают User-Agent, Accept, Accept-Language, Referer и другие стандартные параметры.

2.  **Создание асинхронной сессии**: Затем создается асинхронная сессия с использованием `aiohttp.ClientSession`, которая позволяет выполнять HTTP-запросы асинхронно.

3.  **Извлечение запроса**: Извлекается последний запрос пользователя из истории сообщений. Этот запрос будет использоваться для поиска и генерации ответа.

4.  **Поиск в интернете (если требуется)**:
    *   Если `search_type` установлен в `websearch`, выполняется поиск в интернете с использованием API Hashnode.
    *   Результаты поиска сохраняются в атрибуте `_sources` класса `Hashnode`.

5.  **Подготовка данных для запроса**: Подготавливаются данные в формате JSON, которые будут отправлены на сервер Hashnode для генерации ответа. Эти данные включают идентификатор чата, историю сообщений, запрос пользователя, тип поиска и результаты поиска (если они есть).

6.  **Отправка запроса и получение ответа**:
    *   Отправляется POST-запрос на API Hashnode с использованием асинхронной сессии.
    *   Полученный ответ обрабатывается асинхронно, и каждый чанк данных декодируется и возвращается через генератор.

```
Заголовки запроса подготовка  -->  Создание сессии aiohttp
    |
    Извлечение последнего сообщения пользователя
    |
    Проверка типа поиска (websearch?)
    |
    Да     -->  Выполнение запроса к API поиска Hashnode  -->  Сохранение результатов поиска в _sources
    |       |
    Нет     |
    |       |
    Подготовка данных для запроса (chatId, history, prompt, searchType, urlToScan, searchResults)
    |
    Отправка POST-запроса к API генерации Hashnode
    |
    Асинхронное получение чанков данных из ответа
    |
    Декодирование и передача каждого чанка через yield
```

**Примеры**:

```python
# Пример вызова функции create_async_generator
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
search_type = SearchTypes.websearch
proxy = "http://proxy.example.com"

async def example():
    async for chunk in Hashnode.create_async_generator(model, messages, search_type, proxy):
        print(chunk, end="")

# Запуск примера (в асинхронном контексте)
# import asyncio
# asyncio.run(example())
```

### `get_sources`

```python
@classmethod
def get_sources(cls) -> list:
    """
    Возвращает список источников в формате, пригодном для использования.

    Returns:
        list: Список словарей, содержащих информацию об источниках.

    """
```

**Назначение**: Возвращает список источников, используемых для генерации ответа.

**Параметры**:
- `cls`: Ссылка на класс `Hashnode`.

**Возвращает**:
- `list`: Список словарей, содержащих информацию об источниках, включая заголовок (`title`) и URL (`url`).

**Как работает функция**:

1.  **Преобразование источников**: Функция `get_sources` преобразует список источников, хранящийся в атрибуте `_sources` класса `Hashnode`, в формат, пригодный для использования.

2.  **Создание списка словарей**: Для каждого источника в списке `_sources` создается словарь, содержащий заголовок (`title`) и URL (`url`) источника.

3.  **Возврат списка**: Функция возвращает список этих словарей.

```
Получение списка источников из _sources
    |
    Преобразование каждого источника в словарь с 'title' и 'url'
    |
    Возврат списка словарей
```

**Примеры**:

```python
# Пример вызова функции get_sources
sources = Hashnode.get_sources()
print(sources)
# Ожидаемый вывод: [{'title': 'Source 1', 'url': 'http://example.com/1'}, {'title': 'Source 2', 'url': 'http://example.com/2'}, ...]