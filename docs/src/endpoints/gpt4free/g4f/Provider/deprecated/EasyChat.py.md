# Модуль EasyChat

## Обзор

Модуль `EasyChat` предоставляет класс `EasyChat`, который является провайдером для взаимодействия с сервисом EasyChat, предоставляющим доступ к моделям, аналогичным GPT. Этот модуль позволяет отправлять запросы к сервису и получать ответы, поддерживая как потоковую передачу данных, так и обычные запросы.

## Подробнее

Модуль `EasyChat` предназначен для интеграции с сервисом EasyChat, который предоставляет API для взаимодействия с моделями, аналогичными GPT. Он использует библиотеку `requests` для отправки HTTP-запросов и `json` для обработки данных в формате JSON. Модуль поддерживает потоковую передачу данных, что позволяет получать ответы от сервиса частями, а также обычные запросы, когда ответ получается целиком.

## Классы

### `EasyChat`

**Описание**: Класс `EasyChat` является провайдером для взаимодействия с сервисом EasyChat. Он наследуется от абстрактного класса `AbstractProvider` и реализует методы для отправки запросов и получения ответов от сервиса.

**Принцип работы**:
Класс `EasyChat` использует библиотеку `requests` для отправки HTTP-запросов к сервису EasyChat. Он поддерживает как потоковую передачу данных, так и обычные запросы. Для работы с сервисом необходимо указать URL сервиса, а также настроить заголовки запроса и данные, которые будут отправлены на сервер.

- `url` (str): URL сервиса EasyChat. По умолчанию `"https://free.easychat.work"`.
- `supports_stream` (bool): Поддержка потоковой передачи данных. По умолчанию `True`.
- `supports_gpt_35_turbo` (bool): Поддержка модели GPT-3.5 Turbo. По умолчанию `True`.
- `working` (bool): Указывает, работает ли провайдер. По умолчанию `False`.

**Методы**:

- `create_completion`: Статический метод, который отправляет запрос к сервису EasyChat и возвращает ответ.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: list[dict[str, str]],
    stream: bool, **kwargs: Any) -> CreateResult:
    """
    Отправляет запрос к сервису EasyChat и возвращает ответ.

    Args:
        model (str): Название модели, которую нужно использовать.
        messages (list[dict[str, str]]): Список сообщений, которые нужно отправить сервису.
        stream (bool): Флаг, указывающий, нужно ли использовать потоковую передачу данных.
        **kwargs (Any): Дополнительные параметры, которые можно передать в запрос.

    Returns:
        CreateResult: Результат выполнения запроса.

    Raises:
        Exception: Если возникает ошибка при отправке запроса или получении ответа от сервиса.

    """
```

**Назначение**: Отправляет запрос к сервису EasyChat и возвращает ответ.

**Параметры**:

- `model` (str): Название модели, которую нужно использовать.
- `messages` (list[dict[str, str]]): Список сообщений, которые нужно отправить сервису.
- `stream` (bool): Флаг, указывающий, нужно ли использовать потоковую передачу данных.
- `**kwargs` (Any): Дополнительные параметры, которые можно передать в запрос.

**Возвращает**:

- `CreateResult`: Результат выполнения запроса.

**Вызывает исключения**:

- `Exception`: Если возникает ошибка при отправке запроса или получении ответа от сервиса.

**Как работает функция**:

1. **Определение активных серверов**: Функция определяет список активных серверов, к которым можно отправлять запросы.
2. **Выбор сервера**: Выбирается случайный сервер из списка активных серверов.
3. **Формирование заголовков**: Формируются заголовки запроса, которые включают информацию о типе контента, источнике запроса, User-Agent и другие параметры.
4. **Формирование данных запроса**: Формируются данные запроса в формате JSON, которые включают список сообщений, флаг потоковой передачи данных, название модели, температуру и другие параметры.
5. **Создание сессии**: Создается сессия `requests.Session()` для выполнения запроса.
6. **Инициализация cookies**: Инициализируются cookies путем отправки GET-запроса к серверу.
7. **Отправка запроса**: Отправляется POST-запрос к сервису EasyChat с заголовками и данными запроса.
8. **Обработка ответа**:
   - Если запрос выполнен успешно (код ответа 200), то происходит обработка ответа.
   - Если используется потоковая передача данных, то ответ обрабатывается частями.
   - Если не используется потоковая передача данных, то ответ обрабатывается целиком.
9. **Обработка ошибок**: Если при отправке запроса или получении ответа от сервиса возникает ошибка, то выбрасывается исключение `Exception`.

**Внутренние функции**: Отсутствуют.

```
Определение активных серверов --> Выбор сервера
     |
     |
     V
Формирование заголовков и данных запроса
     |
     |
     V
Создание сессии --> Инициализация cookies --> Отправка POST-запроса
     |
     |
     V
Обработка ответа (потоковая или обычная)
     |
     |
     V
Возврат результата или выброс исключения
```

**Примеры**:

```python
# Пример вызова функции create_completion с использованием потоковой передачи данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
result = EasyChat.create_completion(model, messages, stream)

# Пример вызова функции create_completion без использования потоковой передачи данных
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
result = EasyChat.create_completion(model, messages, stream)

# Пример вызова функции create_completion с дополнительными параметрами
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
kwargs = {"temperature": 0.7, "top_p": 0.9}
result = EasyChat.create_completion(model, messages, stream, **kwargs)