# Модуль для работы с провайдером Ails (GPT4Free)
=====================================================

Модуль содержит класс `Ails`, который используется для взаимодействия с сервисом ai.ls для получения ответов от модели GPT-3.5 Turbo.
Этот модуль является частью deprecated, так как больше не рекомендуется к использованию.

## Обзор

Модуль предоставляет асинхронный генератор для получения ответов от AI.ls. Он поддерживает работу через прокси и передачу истории сообщений.
Этот модуль предназначен для использования в асинхронных приложениях и использует библиотеку `aiohttp` для выполнения HTTP-запросов.

## Подробнее

Модуль `Ails` предназначен для интеграции с сервисом ai.ls через их API. Он отправляет запросы к API и обрабатывает ответы,
возвращая их в виде асинхронного генератора токенов. Это позволяет получать ответы в режиме реального времени,
что особенно полезно для чат-ботов и других интерактивных приложений.

## Классы

### `Ails(AsyncGeneratorProvider)`

**Описание**:
Класс `Ails` представляет собой асинхронного провайдера, который взаимодействует с API ai.ls для получения ответов от модели GPT-3.5 Turbo.

**Наследует**:
- `AsyncGeneratorProvider`: Этот класс наследуется от `AsyncGeneratorProvider`, который, вероятно, предоставляет базовую функциональность для асинхронных провайдеров, таких как управление сессиями и обработка ошибок.

**Атрибуты**:
- `url` (str): URL-адрес сервиса ai.ls ("https://ai.ls").
- `working` (bool): Флаг, указывающий, работает ли провайдер (False).
- `supports_message_history` (bool): Флаг, указывающий, поддерживает ли провайдер историю сообщений (True).
- `supports_gpt_35_turbo` (bool): Флаг, указывающий, поддерживает ли провайдер модель GPT-3.5 Turbo (True).

**Методы**:
- `create_async_generator()`: Создает и возвращает асинхронный генератор для получения ответов от AI.ls.

## Функции

### `create_async_generator`

```python
@staticmethod
async def create_async_generator(
    model: str,
    messages: Messages,
    stream: bool,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для получения ответов от AI.ls.

    Args:
        model (str): Имя модели, которую необходимо использовать (например, "gpt-3.5-turbo").
        messages (Messages): Список сообщений, отправляемых в API.
        stream (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
        proxy (str, optional): URL-адрес прокси-сервера, если необходимо. По умолчанию `None`.
        **kwargs: Дополнительные аргументы, такие как температура.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий токены ответа.

    Raises:
        Exception: Если происходит ошибка при получении ответа или если ответ содержит запрещенные слова.
    """
```

**Назначение**: Создает и возвращает асинхронный генератор для получения ответов от AI.ls.

**Параметры**:
- `model` (str): Имя модели, которую необходимо использовать. В данном случае всегда "gpt-3.5-turbo".
- `messages` (Messages): Список сообщений, отправляемых в API.
- `stream` (bool): Флаг, указывающий, использовать ли потоковую передачу данных.
- `proxy` (str, optional): URL-адрес прокси-сервера, если необходимо. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, такие как `temperature`.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий токены ответа.

**Вызывает исключения**:
- `Exception`: Если происходит ошибка при получении ответа или если ответ содержит запрещенные слова ("ai.ls" или "ai.ci").

**Как работает функция**:
1. **Подготовка заголовков**: Функция подготавливает заголовки HTTP-запроса, включая авторизацию, идентификатор клиента и User-Agent.
2. **Создание сессии**: Используется `aiohttp.ClientSession` для выполнения асинхронных HTTP-запросов.
3. **Формирование данных запроса**: Создается JSON-объект с данными для отправки в API, включая модель, температуру, сообщения, дату и хеш.
4. **Отправка запроса**: Отправляется POST-запрос к API ai.ls с использованием `session.post`.
5. **Обработка ответа**: Функция итерируется по строкам ответа, декодирует их и извлекает токены контента из JSON.
6. **Проверка токенов**: Проверяется, не содержат ли токены запрещенные слова ("ai.ls" или "ai.ci").
7. **Генерация токенов**: Возвращает каждый токен с помощью `yield`, что делает функцию генератором.

**Внутренние функции**: Нет.

**ASCII flowchart**:
```
    Подготовка заголовков
        │
    Создание сессии (ClientSession)
        │
    Формирование данных запроса (JSON)
        │
    Отправка POST-запроса к API ai.ls
        │
    Начало асинхронной итерации по строкам ответа
        │
    Декодирование строк и извлечение токенов
        │
    Проверка наличия запрещенных слов в токенах
        │
    Выдача токенов (yield token)
        │
    Конец
```

**Примеры**:

```python
# Пример использования (необходимо обернуть в асинхронную функцию)
# async def main():
#     messages = [{"role": "user", "content": "Hello, how are you?"}]
#     async for token in Ails.create_async_generator(model="gpt-3.5-turbo", messages=messages, stream=True):
#         print(token, end="")

# import asyncio
# asyncio.run(main())
```

### `_hash`

```python
def _hash(json_data: dict[str, str]) -> SHA256:
    """Создает SHA256 хеш на основе переданных данных.

    Args:
        json_data (dict[str, str]): Словарь с данными для хеширования, содержащий ключи "t" (timestamp) и "m" (message).

    Returns:
        SHA256: SHA256 хеш, полученный из строки, содержащей timestamp, message и секретный ключ.
    """
```

**Назначение**: Создает SHA256 хеш на основе переданных данных.

**Параметры**:
- `json_data` (dict[str, str]): Словарь с данными для хеширования, содержащий ключи "t" (timestamp) и "m" (message).

**Возвращает**:
- `SHA256`: SHA256 хеш, полученный из строки, содержащей timestamp, message и секретный ключ.

**Как работает функция**:
1. **Формирование базовой строки**: Функция формирует строку для хеширования, объединяя timestamp (из `json_data["t"]`), message (из `json_data["m"]`) и секретный ключ.
2. **Хеширование строки**: Используется `hashlib.sha256` для создания SHA256 хеша из базовой строки.
3. **Возврат хеша**: Возвращается SHA256 хеш в виде шестнадцатеричной строки.

**Внутренние функции**: Нет.

**ASCII flowchart**:
```
    Формирование базовой строки (timestamp:message:secret_key)
        │
    Хеширование строки (hashlib.sha256)
        │
    Возврат SHA256 хеша
        │
    Конец
```

**Примеры**:

```python
# Пример использования
# data = {"t": "1678886400", "m": "Hello"}
# hash_value = _hash(data)
# print(hash_value)
```

### `_format_timestamp`

```python
def _format_timestamp(timestamp: int) -> str:
    """Форматирует timestamp.

    Args:
        timestamp (int): Timestamp в виде целого числа.

    Returns:
        str: Форматированный timestamp в виде строки.
    """
```

**Назначение**: Форматирует timestamp, изменяя его последнюю цифру.

**Параметры**:
- `timestamp` (int): Timestamp в виде целого числа.

**Возвращает**:
- `str`: Форматированный timestamp в виде строки.

**Как работает функция**:
1. **Получение последней цифры**: Функция получает последнюю цифру timestamp.
2. **Проверка на четность**: Проверяется, является ли последняя цифра четной.
3. **Корректировка последней цифры**: Если последняя цифра четная, она увеличивается на 1; в противном случае остается без изменений.
4. **Форматирование и возврат**: Функция вычитает последнюю цифру из исходного timestamp, добавляет к результату скорректированную последнюю цифру и возвращает полученное значение в виде строки.

**Внутренние функции**: Нет.

**ASCII flowchart**:
```
    Получение последней цифры timestamp
        │
    Проверка последней цифры на четность
        │
    Если четная: увеличить на 1
        │
    Вычитание последней цифры из timestamp и добавление скорректированной цифры
        │
    Возврат форматированного timestamp
        │
    Конец
```

**Примеры**:

```python
# Пример использования
# timestamp = 1678886400
# formatted_timestamp = _format_timestamp(timestamp)
# print(formatted_timestamp)
```