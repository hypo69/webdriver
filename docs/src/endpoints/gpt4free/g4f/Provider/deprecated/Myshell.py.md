# Модуль Myshell

## Обзор

Модуль `Myshell` предоставляет асинхронный класс `Myshell`, который используется для взаимодействия с API Myshell AI для генерации текста. Он поддерживает модели `samantha`, `gpt-3.5-turbo` и `gpt-4`. Модуль использует вебсокеты для обмена сообщениями с сервером Myshell.

## Подробней

Этот модуль предназначен для асинхронного взаимодействия с сервисом Myshell AI. Он использует `aiohttp` для установления вебсокет-соединения и обмена сообщениями с сервером. Класс `Myshell` предоставляет метод `create_async_generator`, который создает асинхронный генератор для получения текстовых ответов от AI. Также модуль содержит функции для генерации `visitor_id` и `signature`, которые необходимы для аутентификации и авторизации запросов к API Myshell.

## Классы

### `Myshell`

**Описание**:
Асинхронный провайдер для взаимодействия с API Myshell AI.

**Наследует**:
`AsyncGeneratorProvider` - базовый класс для асинхронных провайдеров, генерирующих данные.

**Аттрибуты**:
- `url` (str): URL для чата Myshell AI.
- `working` (bool): Индикатор работоспособности провайдера (по умолчанию `False`).
- `supports_gpt_35_turbo` (bool): Поддержка модели `gpt-3.5-turbo` (по умолчанию `True`).
- `supports_gpt_4` (bool): Поддержка модели `gpt-4` (по умолчанию `True`).

#### Методы

- `create_async_generator`

## Функции

### `generate_timestamp`

```python
def generate_timestamp() -> str:
    """Генерирует timestamp для подписи запросов к API Myshell.

    Returns:
        str: Timestamp в виде строки.

    Как работает функция:
    1. Получает текущее время в миллисекундах.
    2. Преобразует время в строку, убирает последнюю цифру.
    3. Вычисляет сумму произведений цифр времени на 2 или 3 в зависимости от индекса.
    4. Добавляет последнюю цифру суммы к timestamp.

    Примеры:
    >>> generate_timestamp()
    '16967072000'
    """
```

**Назначение**: Генерация timestamp для подписи запросов к API Myshell.

**Возвращает**:
- `str`: Timestamp в виде строки.

**Как работает функция**:

```
Получение текущего времени в миллисекундах -> Преобразование времени в строку без последней цифры -> Вычисление суммы произведений цифр времени на 2 или 3 -> Добавление последней цифры суммы к timestamp
```

### `generate_signature`

```python
def generate_signature(text: str):
    """Генерирует подпись для запросов к API Myshell.

    Args:
        text (str): Текст запроса.

    Returns:
        dict: Словарь с подписью, timestamp и версией.
    """
```

**Назначение**: Генерация подписи для запросов к API Myshell.

**Параметры**:
- `text` (str): Текст запроса.

**Возвращает**:
- `dict`: Словарь с подписью, timestamp и версией.

**Как работает функция**:
1. Генерирует timestamp с помощью функции `generate_timestamp()`.
2. Определяет версию API и секретный ключ.
3. Формирует строку данных для подписи.
4. Вычисляет MD5-хеш от строки данных.
5. Инвертирует полученный хеш.
6. Возвращает словарь с подписью, timestamp и версией.

```
generate_timestamp() -> Формирование строки данных -> Вычисление MD5-хеша -> Инвертирование хеша -> Возврат словаря с подписью, timestamp и версией
```

**Примеры**:

```python
text = "Hello"
signature_data = generate_signature(text)
print(signature_data)
# {'signature': '...', 'timestamp': '...', 'version': 'v1.0.0'}
```

### `xor_hash`

```python
def xor_hash(B: str):
    """Вычисляет XOR-хеш строки.

    Args:
        B (str): Строка для вычисления хеша.

    Returns:
        str: XOR-хеш строки в шестнадцатеричном формате.
    """
```

**Назначение**: Вычисление XOR-хеша строки.

**Параметры**:
- `B` (str): Строка для вычисления хеша.

**Возвращает**:
- `str`: XOR-хеш строки в шестнадцатеричном формате.

**Как работает функция**:
1. Инициализирует пустой список `r` и переменную `i = 0`.
2. Для каждого символа в строке `B`:
    - Вычисляет ASCII-код символа и добавляет его в список `r`.
    - Если длина списка `r` >= 4:
        - Вызывает внутреннюю функцию `o` для вычисления XOR.
        - Очищает список `r`.
3. Если в списке `r` остались элементы, вызывает функцию `o` для их обработки.
4. Возвращает XOR-хеш в шестнадцатеричном формате.

**Внутренние функции**:

- `o(e, t)`: Вычисляет XOR между `e` и значением, полученным из списка `t`.
  - Аргументы:
    - `e`: Значение для XOR.
    - `t`: Список, используемый для вычисления значения.
  - Как работает:
    - Инициализирует `o_val = 0`.
    - Для каждого элемента в `t`:
      - Вычисляет значение, сдвигая элемент влево на 8 * индекс.
      - Выполняет операцию OR с `o_val`.
    - Возвращает XOR между `e` и `o_val`.

```
Инициализация -> Обработка каждого символа -> Вычисление XOR -> Возврат XOR-хеша
```

**Примеры**:

```python
string = "example"
hash_value = xor_hash(string)
print(hash_value)
# 9a6
```

### `performance`

```python
def performance() -> str:
    """Генерирует строку производительности на основе текущего времени.

    Returns:
        str: Строка производительности в шестнадцатеричном формате.
    """
```

**Назначение**: Генерация строки производительности на основе текущего времени.

**Возвращает**:
- `str`: Строка производительности в шестнадцатеричном формате.

**Как работает функция**:
1. Получает текущее время в миллисекундах.
2. Измеряет количество итераций цикла, пока время не изменится.
3. Возвращает шестнадцатеричное представление времени и количества итераций.

```
Получение текущего времени -> Измерение количества итераций -> Возврат строки производительности
```

**Примеры**:

```python
performance_string = performance()
print(performance_string)
# '18d0c7641'
```

### `generate_visitor_id`

```python
def generate_visitor_id(user_agent: str) -> str:
    """Генерирует visitor ID на основе user agent.

    Args:
        user_agent (str): User agent.

    Returns:
        str: Visitor ID.
    """
```

**Назначение**: Генерация visitor ID на основе user agent.

**Параметры**:
- `user_agent` (str): User agent.

**Возвращает**:
- `str`: Visitor ID.

**Как работает функция**:
1. Генерирует строку производительности с помощью функции `performance()`.
2. Генерирует случайное шестнадцатеричное число.
3. Вычисляет XOR-хеш user agent с помощью функции `xor_hash()`.
4. Формирует строку visitor ID, объединяя полученные значения.

```
performance() -> Генерация случайного числа -> xor_hash(user_agent) -> Формирование visitor ID
```

**Примеры**:

```python
user_agent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"
visitor_id = generate_visitor_id(user_agent)
print(visitor_id)
# 18d0c83-2d60612e81880000-81c-b40-18d0c83