# Модуль Aibn для работы с провайдером Aibn
## Обзор
Модуль предоставляет класс `Aibn`, который является асинхронным генераторным провайдером для взаимодействия с сервисом Aibn.cc. Он поддерживает использование GPT-3.5 Turbo и имеет возможность сохранения истории сообщений.

## Подробней

Данный модуль предназначен для обеспечения асинхронного взаимодействия с API сервиса Aibn.cc для генерации текста на основе предоставленных сообщений. Он использует асинхронные запросы для эффективной обработки данных и предоставляет возможность работы через прокси. Расположение файла в структуре проекта указывает на его роль как одного из провайдеров для gpt4free.

## Классы

### `Aibn`

**Описание**: Класс `Aibn` является асинхронным генераторным провайдером, который взаимодействует с сервисом Aibn.cc.

**Принцип работы**:
Класс наследуется от `AsyncGeneratorProvider` и переопределяет метод `create_async_generator` для отправки запросов к API Aibn.cc и получения ответов в виде асинхронного генератора. Он использует библиотеку `StreamSession` для выполнения асинхронных запросов и обработки потоковых данных.

**Атрибуты**:
- `url` (str): URL сервиса Aibn.cc.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `supports_message_history` (bool): Флаг, указывающий на поддержку истории сообщений.
- `supports_gpt_35_turbo` (bool): Флаг, указывающий на поддержку модели GPT-3.5 Turbo.

**Методы**:

- `create_async_generator`
    **Описание**: Асинхронный генератор для получения ответов от сервиса Aibn.cc.
    
    **Параметры**:
    - `model` (str): Название используемой модели.
    - `messages` (Messages): Список сообщений для отправки.
    - `proxy` (str, optional): Адрес прокси-сервера. По умолчанию `None`.
    - `timeout` (int, optional): Время ожидания ответа от сервера. По умолчанию `120`.
    - `**kwargs`: Дополнительные аргументы.

    **Возвращает**:
    - `AsyncResult`: Асинхронный генератор, выдающий чанки текста ответа.

    **Вызывает исключения**:
    - `HTTPError`: Если возникает ошибка при выполнении HTTP-запроса.

     **Как работает функция**:
     1. Функция `create_async_generator` инициализирует асинхронную сессию с использованием `StreamSession`. Это позволяет отправлять запросы и получать ответы в потоковом режиме.
     2. Формируется словарь `data`, включающий сообщения, временную метку и подпись, сгенерированную функцией `generate_signature`.
     3. Отправляется POST-запрос к API сервиса Aibn.cc с использованием асинхронной сессии.
     4. Полученный ответ обрабатывается по частям (чанками) и декодируется. Каждый чанк передается через `yield`, что делает функцию генератором.

     A
     ↓
     B
     ↓
     C
     ↓
     D

     Где:
     - A: Инициализация асинхронной сессии `StreamSession`.
     - B: Формирование данных запроса, включая генерацию подписи.
     - C: Отправка POST-запроса к API Aibn.cc.
     - D: Обработка потокового ответа и генерация чанков текста.

    **Примеры**:

    ```python
    async for chunk in Aibn.create_async_generator(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Hello"}], proxy="http://proxy.example.com"):
        print(chunk)
    ```

## Функции

### `generate_signature`

```python
def generate_signature(timestamp: int, message: str, secret: str = "undefined") -> str:
    """Генерирует подпись для запроса к API Aibn.cc.

    Args:
        timestamp (int): Временная метка запроса.
        message (str): Сообщение для подписи.
        secret (str, optional): Секретный ключ. По умолчанию "undefined".

    Returns:
        str: SHA256-хеш строки, сформированной из временной метки, сообщения и секретного ключа.

    """
```

**Назначение**: Генерация подписи для запроса к API Aibn.cc.

**Параметры**:
- `timestamp` (int): Временная метка запроса.
- `message` (str): Сообщение для подписи.
- `secret` (str, optional): Секретный ключ. По умолчанию "undefined".

**Возвращает**:
- `str`: SHA256-хеш строки, сформированной из временной метки, сообщения и секретного ключа.

**Как работает функция**:
1. Формирует строку, объединяя временную метку, сообщение и секретный ключ через двоеточие.
2. Кодирует строку в байты.
3. Вычисляет SHA256-хеш закодированной строки.
4. Возвращает полученный хеш в шестнадцатеричном формате.

A
     ↓
     B
     ↓
     C
     ↓
     D

     Где:
     - A: Формирование строки данных для подписи.
     - B: Кодирование строки в байты.
     - C: Вычисление SHA256-хеша.
     - D: Возврат хеша в шестнадцатеричном формате.

**Примеры**:

```python
signature = generate_signature(1678886400, "Hello", "mysecret")
print(signature)  # Вывод: example_signature