# Модуль Opchatgpts

## Обзор

Модуль `Opchatgpts` предоставляет асинхронный генератор для взаимодействия с сервисом `opchatgpts.net`. Он предназначен для получения ответов от модели GPT-3.5 Turbo через API этого сервиса. Модуль поддерживает сохранение истории сообщений.

## Подробней

Модуль использует библиотеку `aiohttp` для выполнения асинхронных HTTP-запросов. Он отправляет сообщения пользователя на сервер `opchatgpts.net` и получает ответы в режиме реального времени, обрабатывая их как поток данных.
Располагается в `hypotez/src/endpoints/gpt4free/g4f/Provider/deprecated/Opchatgpts.py`. `deprecated` говорит о том, что модуль устарел.

## Классы

### `Opchatgpts`

**Описание**: Класс `Opchatgpts` является провайдером асинхронного генератора, который взаимодействует с API `opchatgpts.net` для получения ответов от модели GPT-3.5 Turbo.

**Наследует**: `AsyncGeneratorProvider`

**Атрибуты**:

-   `url` (str): URL сервиса `opchatgpts.net`.
-   `working` (bool): Указывает, работает ли провайдер.
-   `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений.
-   `supports_gpt_35_turbo` (bool): Указывает, поддерживает ли провайдер модель GPT-3.5 Turbo.

## Функции

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None, **kwargs) -> AsyncResult:
        """Создает асинхронный генератор для взаимодействия с API opchatgpts.net.

        Args:
            model (str): Идентификатор модели, которую необходимо использовать.
            messages (Messages): Список сообщений для отправки в API.
            proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
            **kwargs: Дополнительные аргументы.

        Returns:
            AsyncResult: Асинхронный генератор, который выдает ответы от API.

        Raises:
            RuntimeError: Если полученная строка данных не соответствует ожидаемому формату.

        """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет сообщения пользователя на сервер `opchatgpts.net` и получает ответы в режиме реального времени.

**Параметры**:

-   `cls`: Ссылка на класс.
-   `model` (str): Идентификатор модели, которую необходимо использовать.
-   `messages` (Messages): Список сообщений для отправки в API.
-   `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
-   `**kwargs`: Дополнительные аргументы.

**Возвращает**:

-   `AsyncResult`: Асинхронный генератор, который выдает ответы от API.

**Вызывает исключения**:

-   `RuntimeError`: Если полученная строка данных не соответствует ожидаемому формату.

**Как работает функция**:

1.  **Подготовка заголовков**: Функция создает заголовки HTTP-запроса, включая User-Agent, Accept, Origin и Referer.
2.  **Создание сессии**: Создается асинхронная сессия `aiohttp` с использованием подготовленных заголовков.
3.  **Формирование данных**: Функция формирует данные для отправки в API, включая идентификаторы бота и чата, контекст, сообщения и флаг потоковой передачи.
4.  **Отправка запроса**: Асинхронно отправляет POST-запрос на URL `f"{cls.url}/wp-json/mwai-ui/v1/chats/submit"` с использованием сформированных данных и прокси-сервера (если указан).
5.  **Обработка ответа**: Функция асинхронно читает содержимое ответа построчно. Если строка начинается с `b"data: "`, она пытается разобрать JSON из этой строки.
6.  **Генерация ответов**: Если в JSON присутствует поле `type`, функция проверяет его значение. Если `type` равен `"live"`, функция выдает данные из поля `data`. Если `type` равен `"end"`, функция завершает работу генератора.
7.  **Обработка ошибок**: Если строка данных не соответствует ожидаемому формату, функция вызывает исключение `RuntimeError`.

**Внутренние функции**: Нет

**ASCII схема работы функции**:

```
    Запрос к API
    │
    │ Создание асинхронной сессии
    │
    │ Формирование данных для отправки
    │
    │ Отправка POST-запроса к API
    │
    │ Обработка ответа
    │ │
    │ ├── data: Получение данных из ответа
    │ │   │
    │ │   └── live: Выдача данных в генератор
    │ │   │
    │ │   └── end: Завершение генератора
    │ │
    │ └── Ошибка: Вызов исключения RuntimeError
    │
    Завершение
```

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio

async def main():
    model = "gpt-3.5-turbo"
    messages = [{"role": "user", "content": "Привет, как дела?"}]
    async for response in Opchatgpts.create_async_generator(model=model, messages=messages):
        print(response)

if __name__ == "__main__":
    asyncio.run(main())