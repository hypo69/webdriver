# Модуль `Goabror`

## Обзор

Модуль `Goabror` предоставляет асинхронный интерфейс для взаимодействия с сервисом Goabror.uz, который предоставляет доступ к модели `gpt-4`. Модуль использует `aiohttp` для выполнения асинхронных HTTP-запросов и обрабатывает ответы в формате JSON или текста.

## Подробнее

Этот модуль является частью проекта `hypotez` и предназначен для интеграции с другими компонентами, требующими доступа к языковой модели `gpt-4` через сервис Goabror. Модуль реализует асинхронный генератор для обработки ответов от API, что позволяет эффективно использовать ресурсы при работе с большими объемами данных.

## Классы

### `Goabror`

**Описание**: Класс `Goabror` реализует асинхронный интерфейс для работы с API Goabror.uz. Он наследует функциональность от `AsyncGeneratorProvider` и `ProviderModelMixin`, предоставляя методы для создания асинхронных генераторов и управления моделями.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает базовую функциональность для асинхронных провайдеров генераторов.
- `ProviderModelMixin`: Предоставляет методы для управления моделями, поддерживаемыми провайдером.

**Атрибуты**:
- `url` (str): URL сервиса Goabror.uz.
- `api_endpoint` (str): URL API для взаимодействия с моделью `gpt-4`.
- `working` (bool): Флаг, указывающий на работоспособность провайдера.
- `default_model` (str): Модель, используемая по умолчанию (`gpt-4`).
- `models` (list): Список поддерживаемых моделей (в данном случае только `gpt-4`).

**Методы**:
- `create_async_generator()`: Создает асинхронный генератор для взаимодействия с API Goabror.

## Функции

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """Создает асинхронный генератор для взаимодействия с API Goabror.

    Args:
        model (str): Модель для использования (в данном случае всегда `gpt-4`).
        messages (Messages): Список сообщений для отправки в API.
        proxy (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
        **kwargs: Дополнительные параметры.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий ответы от API.

    Raises:
        Exception: Если происходит ошибка при выполнении запроса или обработке ответа.
    """
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет запросы к API Goabror и возвращает ответы. Она использует `aiohttp` для выполнения асинхронных HTTP-запросов и обрабатывает ответы в формате JSON или текста.

**Параметры**:
- `cls`: Ссылка на класс `Goabror`.
- `model` (str): Модель для использования (в данном случае всегда `gpt-4`).
- `messages` (Messages): Список сообщений для отправки в API.
- `proxy` (str, optional): URL прокси-сервера для использования. По умолчанию `None`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, возвращающий ответы от API.

**Вызывает исключения**:
- `Exception`: Если происходит ошибка при выполнении запроса или обработке ответа.

**Как работает функция**:

1.  **Подготовка заголовков**: Функция начинает с подготовки HTTP-заголовков, которые будут отправлены вместе с запросом. Заголовки включают информацию о типе принимаемого контента, языке и User-Agent.
2.  **Создание сессии `aiohttp`**: Создается асинхронная сессия `aiohttp` с заданными заголовками. Это позволяет повторно использовать соединение для нескольких запросов.
3.  **Формирование параметров запроса**: Функция формирует параметры запроса, включая пользовательское сообщение и системное сообщение, используя функции `format_prompt` и `get_system_prompt`.
4.  **Выполнение GET-запроса**: Выполняется асинхронный GET-запрос к API Goabror с заданными параметрами и прокси-сервером (если указан).
5.  **Обработка ответа**: Функция обрабатывает ответ от API, проверяя статус код и извлекая данные. Если ответ имеет формат JSON, он декодируется и извлекается поле `data`. Если ответ не имеет формат JSON, он возвращается как текст.
6.  **Генерация результата**: Функция возвращает результат в виде асинхронного генератора, который выдает данные из ответа API.

```
Подготовка заголовков
↓
Создание асинхронной сессии aiohttp
↓
Формирование параметров запроса
↓
Выполнение GET-запроса к API Goabror
│
Обработка ответа:
│  ├── JSON? → Декодирование и извлечение 'data'
│  └── Текст → Возврат текста
↓
Генерация результата (асинхронный генератор)
```

**Примеры**:

```python
# Пример использования create_async_generator
import asyncio
from typing import List, Dict, AsyncGenerator

from src.endpoints.gpt4free.g4f.Provider.Goabror import Goabror

async def main():
    messages: List[Dict[str, str]] = [
        {"role": "user", "content": "Hello, how are you?"}
    ]
    async for response in Goabror.create_async_generator(model="gpt-4", messages=messages):
        print(response)

if __name__ == "__main__":
    asyncio.run(main())