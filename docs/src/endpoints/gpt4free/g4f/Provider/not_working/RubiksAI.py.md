# Модуль для работы с провайдером RubiksAI
=================================================

Модуль содержит класс :class:`RubiksAI`, который используется для взаимодействия с API Rubiks AI для генерации текста на основе предоставленных сообщений.

## Обзор

Модуль `RubiksAI` предоставляет асинхронный интерфейс для взаимодействия с API Rubiks AI. Он поддерживает потоковую передачу данных, системные сообщения и историю сообщений. Этот модуль позволяет использовать различные модели, предоставляемые Rubiks AI, такие как `gpt-4o-mini`, `gpt-4o`, `o1-mini`, `claude-3.5-sonnet`, `grok-beta`, `gemini-1.5-pro`, `nova-pro` и `llama-3.1-70b-versatile`.
Модуль позволяет выполнять поисковые запросы в интернете и возвращать источники найденной информации вместе с ответом.

## Подробнее

Модуль предназначен для использования в асинхронных приложениях, где требуется взаимодействие с API Rubiks AI для генерации текста. Он предоставляет методы для создания запросов к API и обработки ответов, включая потоковую передачу данных. Модуль также поддерживает использование прокси-серверов для обхода ограничений сети.

## Классы

### `RubiksAI`

**Описание**: Класс `RubiksAI` является провайдером для взаимодействия с API Rubiks AI. Он предоставляет методы для создания асинхронных генераторов, которые отправляют запросы к API и возвращают результаты.

**Наследует**:
- `AsyncGeneratorProvider`: Предоставляет базовый интерфейс для асинхронных провайдеров, генерирующих данные.
- `ProviderModelMixin`: Предоставляет функциональность для работы с моделями, поддерживаемыми провайдером.

**Аттрибуты**:
- `label` (str): Метка провайдера, `"Rubiks AI"`.
- `url` (str): URL провайдера, `"https://rubiks.ai"`.
- `api_endpoint` (str): URL API endpoint, `"https://rubiks.ai/search/api/"`.
- `working` (bool): Указывает, работает ли провайдер, `True`.
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных, `True`.
- `supports_system_message` (bool): Указывает, поддерживает ли провайдер системные сообщения, `True`.
- `supports_message_history` (bool): Указывает, поддерживает ли провайдер историю сообщений, `True`.
- `default_model` (str): Модель, используемая по умолчанию, `"gpt-4o-mini"`.
- `models` (List[str]): Список поддерживаемых моделей.
- `model_aliases` (Dict[str, str]): Словарь псевдонимов моделей.

**Методы**:
- `generate_mid()`: Генерирует строку `mid`.
- `create_referer()`: Создает URL Referer с динамическими значениями `q` и `mid`.
- `create_async_generator()`: Создает асинхронный генератор для отправки запросов к API Rubiks AI.

## Функции

### `generate_mid`

```python
 @staticmethod
 def generate_mid() -> str:
        """
        Generates a 'mid' string following the pattern:
        6 characters - 4 characters - 4 characters - 4 characters - 12 characters
        Example: 0r7v7b-quw4-kdy3-rvdu-ekief6xbuuq4
        """
        ...
```

**Назначение**: Генерирует строку `mid` в формате `6 символов - 4 символа - 4 символа - 4 символа - 12 символов`.

**Параметры**:
- Нет

**Возвращает**:
- `str`: Строка, сгенерированная случайным образом.

**Как работает функция**:
1. Определяются длины составных частей идентификатора `mid`.
2. Создаются пять частей идентификатора, каждая из которых состоит из случайных строчных букв и цифр.
3. Части соединяются дефисами.
4. Возвращается полученная строка.

```
Начало
  │
  │ Создание первой части (6 символов)
  │
  │ Создание второй части (4 символа)
  │
  │ Создание третьей части (4 символа)
  │
  │ Создание четвертой части (4 символа)
  │
  │ Создание пятой части (12 символов)
  │
  │ Соединение частей дефисами
  │
Конец
```

**Примеры**:
```python
mid = RubiksAI.generate_mid()
print(mid)  # Вывод: случайная строка, например, '0r7v7b-quw4-kdy3-rvdu-ekief6xbuuq4'
```

### `create_referer`

```python
    @staticmethod
    def create_referer(q: str, mid: str, model: str = '') -> str:
        """
        Creates a Referer URL with dynamic q and mid values, using urlencode for safe parameter encoding.
        """
        ...
```

**Назначение**: Создает URL Referer с динамическими значениями `q` (текст запроса) и `mid` (идентификатор сообщения), используя `urlencode` для безопасного кодирования параметров.

**Параметры**:
- `q` (str): Текст запроса.
- `mid` (str): Идентификатор сообщения.
- `model` (str, optional): Модель, используемая в запросе. По умолчанию `''`.

**Возвращает**:
- `str`: Сгенерированный URL Referer.

**Как работает функция**:
1. Создается словарь параметров, включающий `q`, `model` и `mid`.
2. Параметры кодируются с помощью `urlencode` для безопасной передачи в URL.
3. Формируется строка URL Referer с закодированными параметрами.
4. Возвращается полученный URL.

```
Начало
  │
  │ Создание словаря параметров (q, model, mid)
  │
  │ Кодирование параметров с помощью urlencode
  │
  │ Формирование URL Referer
  │
Конец
```

**Примеры**:
```python
q = "Как работает RubiksAI?"
mid = "0r7v7b-quw4-kdy3-rvdu-ekief6xbuuq4"
referer = RubiksAI.create_referer(q=q, mid=mid)
print(referer)  # Вывод: https://rubiks.ai/search/?q=Как+работает+RubiksAI%3F&model=&mid=0r7v7b-quw4-kdy3-rvdu-ekief6xbuuq4
```

### `create_async_generator`

```python
    @classmethod
    async def create_async_generator(
        cls,
        model: str,
        messages: Messages,
        proxy: str = None,
        web_search: bool = False,
        temperature: float = 0.6,
        **kwargs
    ) -> AsyncResult:
        """
        Creates an asynchronous generator that sends requests to the Rubiks AI API and yields the response.

        Parameters:
        - model (str): The model to use in the request.
        - messages (Messages): The messages to send as a prompt.
        - proxy (str, optional): Proxy URL, if needed.
        - web_search (bool, optional): Indicates whether to include search sources in the response. Defaults to False.
        """
        ...
```

**Назначение**: Создает асинхронный генератор, который отправляет запросы к API Rubiks AI и выдает ответ.

**Параметры**:
- `model` (str): Модель, используемая в запросе.
- `messages` (Messages): Сообщения, отправляемые в качестве запроса.
- `proxy` (str, optional): URL прокси-сервера, если необходимо. По умолчанию `None`.
- `web_search` (bool, optional): Указывает, следует ли включать источники поиска в ответ. По умолчанию `False`.
- `temperature` (float, optional): Температура для генерации текста. По умолчанию `0.6`.
- `**kwargs`: Дополнительные параметры.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, выдающий текст ответа.

**Как работает функция**:
1.  Определяется модель, которая будет использоваться в запросе.
2.  Генерируется уникальный идентификатор сообщения `mid_value`.
3.  Создается URL Referer с использованием текста последнего сообщения, идентификатора сообщения и модели.
4.  Формируются данные запроса, включающие сообщения, модель, флаг веб-поиска, флаг потоковой передачи и температуру.
5.  Формируются заголовки запроса, включая URL Referer, User-Agent и другие параметры.
6.  Отправляется POST-запрос к API Rubiks AI с использованием асинхронной сессии.
7.  Обрабатывается ответ от API, извлекаются данные и генерируются результаты.
8.  Если включен веб-поиск, извлекаются источники и добавляются в результаты.

```
Начало
  │
  │ Определение модели
  │
  │ Генерация mid_value
  │
  │ Создание URL Referer
  │
  │ Формирование данных запроса
  │
  │ Формирование заголовков запроса
  │
  │ Отправка POST-запроса к API Rubiks AI
  │
  │ Обработка ответа от API
  │   │
  │   └───► Извлечение данных и генерация результатов
  │
  │ Если включен веб-поиск:
  │   │
  │   └───► Извлечение источников и добавление в результаты
  │
Конец
```

**Примеры**:
```python
messages = [{"role": "user", "content": "Как работает RubiksAI?"}]
async for message in RubiksAI.create_async_generator(model="gpt-4o-mini", messages=messages):
    print(message)