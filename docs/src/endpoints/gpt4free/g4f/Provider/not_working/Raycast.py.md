# Модуль Raycast

## Обзор

Модуль `Raycast` предназначен для взаимодействия с API Raycast для получения ответов от AI моделей, таких как `gpt-3.5-turbo` и `gpt-4`. Этот модуль является частью проекта `hypotez` и предоставляет функциональность для создания запросов к Raycast API и обработки ответов.  Модуль требует аутентификации через токен `auth`.

## Подробней

Модуль определяет класс `Raycast`, который наследуется от `AbstractProvider`. Он содержит методы для создания запросов к API Raycast и обработки потоковых ответов. Модуль использует библиотеку `requests` для отправки HTTP-запросов и `json` для обработки JSON-данных.

## Классы

### `Raycast(AbstractProvider)`

**Описание**:
Класс `Raycast` предоставляет методы для взаимодействия с API Raycast для генерации текста на основе предоставленных сообщений. Он поддерживает потоковую передачу ответов.

**Наследует**:
- `AbstractProvider`:  `Raycast` наследует функциональность базового класса `AbstractProvider`, который, вероятно, определяет общие интерфейсы и методы для взаимодействия с различными провайдерами AI моделей.

**Атрибуты**:
- `url` (str): URL адрес сервиса Raycast (`"https://raycast.com"`).
- `supports_stream` (bool): Указывает, поддерживает ли провайдер потоковую передачу данных (в данном случае `True`).
- `needs_auth` (bool): Указывает, требуется ли аутентификация для работы с провайдером (в данном случае `True`).
- `working` (bool): Указывает, работает ли в данный момент провайдер (в данном случае `False`).
- `models` (List[str]): Список поддерживаемых моделей (`gpt-3.5-turbo`, `gpt-4`).

**Методы**:
- `create_completion`: Создает запрос к API Raycast и возвращает результат.

## Функции

### `create_completion`

```python
@staticmethod
def create_completion(
    model: str,
    messages: Messages,
    stream: bool,
    proxy: str = None,
    **kwargs,
) -> CreateResult:
    """ Функция создает запрос к API Raycast и возвращает результат в виде потока или полного ответа.

    Args:
        model (str): Имя используемой модели (`gpt-3.5-turbo`, `gpt-4`).
        messages (Messages): Список сообщений для отправки в API.
        stream (bool):  Указывает, следует ли возвращать ответ в виде потока (`True`) или полный ответ (`False`).
        proxy (str, optional):  URL прокси-сервера для использования при отправке запроса. По умолчанию `None`.
        **kwargs:  Дополнительные аргументы, такие как токен аутентификации (`auth`).

    Returns:
        CreateResult:  Результат запроса. Тип `CreateResult`, вероятно, определен в модуле `typing` и может быть `Generator[str, None, None]` при `stream=True` или `str` при `stream=False`.

    Raises:
        ValueError: Если не предоставлен токен аутентификации (`auth`).
    """
```

**Назначение**:
Функция `create_completion` отправляет запрос к API Raycast с использованием указанной модели и сообщений, и возвращает результат в виде потока или полного ответа.

**Параметры**:
- `model` (str): Имя используемой модели.
- `messages` (Messages): Список сообщений для отправки в API.
- `stream` (bool): Указывает, следует ли возвращать ответ в виде потока или полный ответ.
- `proxy` (str, optional): URL прокси-сервера для использования при отправке запроса. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы, такие как токен аутентификации (`auth`).

**Возвращает**:
- `CreateResult`: Результат запроса. Тип `CreateResult`, вероятно, определен в модуле `typing`.

**Вызывает исключения**:
- `ValueError`: Если не предоставлен токен аутентификации (`auth`).

**Как работает функция**:
1. **Проверка наличия токена аутентификации**:
   - Функция проверяет, передан ли токен аутентификации (`auth`) в `kwargs`. Если токен отсутствует, вызывается исключение `ValueError`.

2. **Формирование заголовков запроса**:
   - Создаются заголовки запроса, включающие токен аутентификации, тип контента и User-Agent.

3. **Преобразование сообщений**:
   - Список сообщений преобразуется в формат, ожидаемый API Raycast.

4. **Формирование данных запроса**:
   - Формируются данные запроса в формате JSON, включающие сообщения, модель, параметры и другие настройки.

5. **Отправка POST-запроса**:
   - Отправляется POST-запрос к API Raycast с использованием библиотеки `requests`. Указывается URL, заголовки, данные и параметры потоковой передачи.

6. **Обработка потоковых ответов**:
   - Если `stream=True`, функция итерируется по строкам ответа, извлекает полезные данные из JSON и возвращает их в виде потока.

7. **Обработка ошибок**:
   - Если возникает ошибка при отправке запроса или обработке ответа, вызывается исключение.

```
    A
    │
    ├── Проверка наличия токена аутентификации (`auth`)
    │   └── Если отсутствует, вызывается исключение `ValueError`
    │
    ├── Формирование заголовков запроса
    │   └── Включает токен аутентификации, тип контента и User-Agent
    │
    ├── Преобразование сообщений
    │   └── Преобразует список сообщений в формат, ожидаемый API Raycast
    │
    ├── Формирование данных запроса
    │   └── Включает сообщения, модель, параметры и настройки
    │
    ├── Отправка POST-запроса к API Raycast
    │   └── Используется библиотека `requests`
    │
    └── Обработка потоковых ответов (если `stream=True`)
        │
        └── Итерация по строкам ответа
            │
            └── Извлечение данных из JSON
                │
                └── Возврат данных в виде потока
```

**Примеры**:

```python
# Пример вызова функции create_completion
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
auth_token = "your_auth_token"  # Замените на ваш реальный токен

# Вызов create_completion с потоковой передачей
result = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token)

# Обработка потокового результата
if stream:
    for chunk in result:
        print(chunk, end="")
```
```python
# Пример вызова функции create_completion без потоковой передачи
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = False
auth_token = "your_auth_token"  # Замените на ваш реальный токен

# Вызов create_completion без потоковой передачи
try:
    result = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token)
    print(result)  # Вывод полного ответа
except ValueError as ex:
    print(f"Error: {ex}")
```
```python
# Пример вызова функции create_completion с использованием прокси
model = "gpt-3.5-turbo"
messages = [{"role": "user", "content": "Hello, how are you?"}]
stream = True
auth_token = "your_auth_token"
proxy = "http://your_proxy:8080"  # Замените на ваш прокси

# Вызов create_completion с потоковой передачей и использованием прокси
result = Raycast.create_completion(model=model, messages=messages, stream=stream, auth=auth_token, proxy=proxy)

# Обработка потокового результата
if stream:
    for chunk in result:
        print(chunk, end="")