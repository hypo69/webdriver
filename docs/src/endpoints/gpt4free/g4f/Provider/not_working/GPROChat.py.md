# Модуль `GPROChat.py`

## Обзор

Модуль предназначен для асинхронного взаимодействия с сервисом GPROChat. Он предоставляет функциональность для генерации текста на основе предоставленных сообщений, используя API GPROChat. Модуль включает в себя функции для форматирования запросов и создания цифровой подписи для обеспечения безопасности.

## Подробнее

Модуль `GPROChat` предоставляет класс `GPROChat`, который наследуется от `AsyncGeneratorProvider` и `ProviderModelMixin`. Это позволяет использовать его для асинхронной генерации контента и управления моделями.

## Классы

### `GPROChat`

**Описание**: Класс для взаимодействия с API GPROChat с использованием асинхронных генераторов.

**Наследует**:
- `AsyncGeneratorProvider`: Обеспечивает асинхронную генерацию данных.
- `ProviderModelMixin`: Предоставляет функциональность для управления моделями.

**Атрибуты**:
- `url` (str): URL сервиса GPROChat (`https://gprochat.com`).
- `api_endpoint` (str): URL API для генерации (`https://gprochat.com/api/generate`).
- `working` (bool): Указывает, работает ли провайдер (в данном случае `False`).
- `supports_stream` (bool): Поддержка потоковой передачи данных (`True`).
- `supports_message_history` (bool): Поддержка истории сообщений (`True`).
- `default_model` (str): Модель, используемая по умолчанию (`gemini-1.5-pro`).

**Методы**:
- `generate_signature(timestamp: int, message: str) -> str`: Генерирует цифровую подпись для запроса.
- `create_async_generator(model: str, messages: Messages, proxy: str = None, **kwargs) -> AsyncResult`: Создает асинхронный генератор для отправки запросов к API GPROChat.

## Функции

### `generate_signature`

```python
@staticmethod
def generate_signature(timestamp: int, message: str) -> str:
    """
    Генерирует цифровую подпись для запроса к API GPROChat.

    Args:
        timestamp (int): Временная метка в миллисекундах.
        message (str): Сообщение для подписи.

    Returns:
        str: Сгенерированная цифровая подпись.
    """
    ...
```

**Назначение**: Функция `generate_signature` создает цифровую подпись, используя алгоритм SHA256, для обеспечения безопасности при взаимодействии с API GPROChat. Подпись генерируется на основе временной метки, сообщения и секретного ключа.

**Параметры**:
- `timestamp` (int): Временная метка, используемая при генерации подписи.
- `message` (str): Сообщение, которое необходимо подписать.

**Возвращает**:
- `str`: Цифровая подпись, сгенерированная на основе входных параметров.

**Как работает функция**:
1. Функция принимает временную метку (`timestamp`) и сообщение (`message`).
2. Определяется секретный ключ `secret_key`.
3. Формируется входная строка `hash_input` путем объединения временной метки, сообщения и секретного ключа через двоеточие.
4. Вычисляется SHA256-хеш от `hash_input`, закодированной в UTF-8.
5. Возвращается полученный хеш в шестнадцатеричном формате.

```
A[Получение временной метки и сообщения]
|
B[Формирование входной строки для хеширования]
|
C[Вычисление SHA256-хеша]
|
D[Возврат хеша в шестнадцатеричном формате]
```

**Примеры**:
```python
timestamp = int(time.time() * 1000)
message = "Пример сообщения"
signature = GPROChat.generate_signature(timestamp, message)
print(f"Signature: {signature}")
```

### `create_async_generator`

```python
@classmethod
async def create_async_generator(
    cls,
    model: str,
    messages: Messages,
    proxy: str = None,
    **kwargs
) -> AsyncResult:
    """
    Создает асинхронный генератор для взаимодействия с API GPROChat.

    Args:
        model (str): Название используемой модели.
        messages (Messages): Список сообщений для отправки.
        proxy (str, optional): Адрес прокси-сервера. По умолчанию `None`.

    Returns:
        AsyncResult: Асинхронный генератор, возвращающий чанки данных из ответа API.
    """
    ...
```

**Назначение**: Функция `create_async_generator` создает асинхронный генератор, который отправляет запросы к API GPROChat и возвращает данные чанками. Это позволяет обрабатывать большие объемы данных асинхронно и эффективно.

**Параметры**:
- `model` (str): Название модели, используемой для генерации ответа.
- `messages` (Messages): Список сообщений, отправляемых в запросе.
- `proxy` (str, optional): Адрес прокси-сервера для использования при отправке запроса. По умолчанию `None`.
- `**kwargs`: Дополнительные аргументы.

**Возвращает**:
- `AsyncResult`: Асинхронный генератор, который выдает чанки данных из ответа API.

**Как работает функция**:
1. Функция принимает название модели (`model`), список сообщений (`messages`) и опциональный адрес прокси-сервера (`proxy`).
2. Получает модель с помощью `cls.get_model(model)`.
3. Генерирует временную метку (`timestamp`) и формирует запрос (`prompt`) из списка сообщений.
4. Создает цифровую подпись (`sign`) для запроса.
5. Определяет заголовки (`headers`) для HTTP-запроса.
6. Формирует данные (`data`) для отправки в теле запроса.
7. Отправляет асинхронный POST-запрос к API GPROChat и обрабатывает ответ чанками, возвращая их через генератор.

```
A[Получение параметров: model, messages, proxy]
|
B[Подготовка данных для запроса: timestamp, prompt, sign, headers, data]
|
C[Отправка асинхронного POST-запроса к API]
|
D[Обработка ответа чанками и выдача через генератор]
```

**Примеры**:
```python
messages = [{"role": "user", "content": "Привет!"}]
async for chunk in GPROChat.create_async_generator(model="gemini-1.5-pro", messages=messages):
    print(chunk)