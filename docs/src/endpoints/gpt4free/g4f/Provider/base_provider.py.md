# Документация модуля base_provider.py

## Обзор

Модуль `base_provider.py` содержит базовые классы и структуры данных, необходимые для реализации различных поставщиков (providers) в проекте `hypotez`. Он определяет абстрактные классы для поставщиков, а также типы и структуры данных для стриминга, ответов, источников и причин завершения.

## Подробней

Этот модуль является основой для создания новых поставщиков, обеспечивая единообразный интерфейс и структуру для взаимодействия с различными моделями и сервисами. Он содержит абстрактные классы, которые должны быть реализованы конкретными поставщиками, а также общие типы данных, используемые во всем проекте. В частности, он содержит импорт из `..providers.base_provider`, `..providers.types`, `.helper` и тд.

## Классы

### `BaseProvider`

**Описание**: Базовый класс для всех поставщиков. Он определяет интерфейс, который должны реализовывать все поставщики.

**Принцип работы**:
- Класс `BaseProvider` является абстрактным базовым классом для всех поставщиков. Он определяет общие атрибуты и методы, которые должны быть реализованы в подклассах.
- Он предоставляет возможность установки имени поставщика, поддержки потоковой передачи и определения рабочих запросов.

**Аттрибуты**:

- `name` (str): Имя поставщика.
- `supports_stream` (bool): Поддержка потоковой передачи.
- `working` (bool): Определяет, работает ли поставщик в данный момент.

**Методы**:
- `__init__(self, name: str, supports_stream: bool = False, working: bool = True)`: Конструктор класса.
- `__str__(self) -> str`: Возвращает имя поставщика.
- `__repr__(self) -> str`: Возвращает строковое представление объекта.
- `create_async_generator(self, response)`: Создает асинхронный генератор.
- `get_response(self)`: Получает ответ от поставщика.
- `stream_response(self)`: Получает потоковый ответ от поставщика.
- `conversation(self)`: Запускает разговор с поставщиком.

### `AsyncProvider`

**Описание**: Базовый класс для асинхронных поставщиков.

**Наследует**:
- `BaseProvider`: Наследует атрибуты и методы базового поставщика.

**Принцип работы**:
- Класс `AsyncProvider` является абстрактным базовым классом для асинхронных поставщиков. Он наследует функциональность `BaseProvider` и добавляет поддержку асинхронных операций.

**Аттрибуты**:
- Отсутствуют дополнительные атрибуты, кроме унаследованных от `BaseProvider`.

**Методы**:
- `__init__(self, name: str, supports_stream: bool = False, working: bool = True)`: Конструктор класса.
- `get_response(self)`: Асинхронно получает ответ от поставщика.
- `stream_response(self)`: Асинхронно получает потоковый ответ от поставщика.
- `conversation(self)`: Асинхронно запускает разговор с поставщиком.

## Функции

### `get_cookies`

```python
def get_cookies(url: str) -> dict:
    """Получает куки для указанного URL.

    Args:
        url (str): URL, для которого необходимо получить куки.

    Returns:
        dict: Словарь с куками.

    Raises:
        Exception: В случае ошибки при получении куки.

    """
```

**Назначение**: Получение куки для указанного URL.

**Параметры**:

- `url` (str): URL, для которого необходимо получить куки.

**Возвращает**:

- `dict`: Словарь с куками.

**Вызывает исключения**:

- `Exception`: В случае ошибки при получении куки.

**Как работает функция**:

1. Функция `get_cookies` получает URL в качестве аргумента.
2.  Использует `webdriver` для получения куки.
3. Возвращает словарь с куками.

**ASCII flowchart**:

```
URL -> Получение куки через webdriver -> Словарь с куками
```

**Примеры**:

```python
url = 'https://example.com'
cookies = get_cookies(url)
print(cookies)
```

### `format_prompt`

```python
def format_prompt(prompt: str, model: str) -> str:
    """Форматирует запрос для указанной модели.

    Args:
        prompt (str): Исходный запрос.
        model (str): Название модели.

    Returns:
        str: Отформатированный запрос.

    Raises:
        Exception: В случае ошибки при форматировании запроса.
    """
```

**Назначение**: Форматирует запрос для указанной модели.

**Параметры**:

- `prompt` (str): Исходный запрос.
- `model` (str): Название модели.

**Возвращает**:

- `str`: Отформатированный запрос.

**Вызывает исключения**:

- `Exception`: В случае ошибки при форматировании запроса.

**Как работает функция**:

1. Функция `format_prompt` принимает исходный запрос и название модели.
2.  Проверяет, является ли модель "llama2".
3.  Если модель "llama2", добавляет в начало и конец запроса специальные теги.
4.  Возвращает отформатированный запрос.

**ASCII flowchart**:

```
Prompt, Model -> Проверка Model == "llama2" -> Добавление тегов (если llama2) -> Отформатированный Prompt
```

**Примеры**:

```python
prompt = 'Hello, how are you?'
model = 'llama2'
formatted_prompt = format_prompt(prompt, model)
print(formatted_prompt)

prompt = 'Translate to French'
model = 'gemini'
formatted_prompt = format_prompt(prompt, model)
print(formatted_prompt)