# Модуль stubs

## Обзор

Модуль `stubs` содержит определения классов и моделей данных, используемых для представления структур данных, связанных с взаимодействием с API.
В основном, эти классы используются для типизации и валидации данных, отправляемых и получаемых от API, а также для обработки изображений.

## Подробнее

Этот модуль предоставляет базовые классы для работы с различными типами данных, такими как токены, использование ресурсов, вызовы инструментов, сообщения чата, выборки завершения чата и изображения. Кроме того, он включает функции для обработки и сохранения контента сообщений чата, а также для извлечения данных из URI изображений.

## Классы

### `BaseModel`

**Описание**: Базовый класс для моделей данных, используемый для представления различных структур данных.

**Принцип работы**:

Класс `BaseModel` предоставляет базовую функциональность для создания моделей данных. Он включает метод `model_construct`, который позволяет создавать экземпляры класса с заданными атрибутами. Если библиотека `pydantic` не установлена, используется упрощенная реализация `BaseModel` без валидации данных.

### `TokenDetails`

**Описание**: Модель данных, представляющая детали токенов.

**Атрибуты**:
- `cached_tokens` (int): Количество кэшированных токенов.

### `UsageModel`

**Описание**: Модель данных, представляющая использование ресурсов.

**Атрибуты**:
- `prompt_tokens` (int): Количество токенов, использованных в запросе.
- `completion_tokens` (int): Количество токенов, использованных в завершении.
- `total_tokens` (int): Общее количество использованных токенов.
- `prompt_tokens_details` (TokenDetails): Детали токенов, использованных в запросе.
- `completion_tokens_details` (TokenDetails): Детали токенов, использованных в завершении.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `UsageModel` с заданными атрибутами. Если `prompt_tokens_details` или `completion_tokens_details` не предоставлены, они инициализируются как экземпляры `TokenDetails` с `cached_tokens = 0`.

### `ToolFunctionModel`

**Описание**: Модель данных, представляющая функцию инструмента.

**Атрибуты**:
- `name` (str): Название функции инструмента.
- `arguments` (str): Аргументы функции инструмента.

### `ToolCallModel`

**Описание**: Модель данных, представляющая вызов инструмента.

**Атрибуты**:
- `id` (str): Идентификатор вызова инструмента.
- `type` (str): Тип вызова инструмента.
- `function` (ToolFunctionModel): Функция инструмента.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ToolCallModel` с заданными атрибутами. Если `function` не предоставлена, она инициализируется как экземпляр `ToolFunctionModel`.

### `ChatCompletionChunk`

**Описание**: Модель данных, представляющая фрагмент завершения чата.

**Атрибуты**:
- `id` (str): Идентификатор фрагмента завершения чата.
- `object` (str): Тип объекта.
- `created` (int): Временная метка создания.
- `model` (str): Модель, использованная для завершения чата.
- `provider` (Optional[str])`: Поставщик услуги.
- `choices` (List[ChatCompletionDeltaChoice]): Список выборок фрагмента завершения чата.
- `usage` (UsageModel): Использование ресурсов.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletionChunk` с заданными атрибутами.

### `ChatCompletionMessage`

**Описание**: Модель данных, представляющая сообщение чата.

**Атрибуты**:
- `role` (str): Роль отправителя сообщения.
- `content` (str): Содержание сообщения.
- `tool_calls` (list[ToolCallModel]): Список вызовов инструментов в сообщении.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletionMessage` с заданными атрибутами.
- `save`: Сохраняет содержимое сообщения в файл.

### `ChatCompletionChoice`

**Описание**: Модель данных, представляющая выборку завершения чата.

**Атрибуты**:
- `index` (int): Индекс выборки.
- `message` (ChatCompletionMessage): Сообщение чата.
- `finish_reason` (str): Причина завершения.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletionChoice` с заданными атрибутами.

### `ChatCompletion`

**Описание**: Модель данных, представляющая завершение чата.

**Атрибуты**:
- `id` (str): Идентификатор завершения чата.
- `object` (str): Тип объекта.
- `created` (int): Временная метка создания.
- `model` (str): Модель, использованная для завершения чата.
- `provider` (Optional[str])`: Поставщик услуги.
- `choices` (list[ChatCompletionChoice]): Список выборок завершения чата.
- `usage` (UsageModel): Использование ресурсов.
- `conversation` (dict): словарь, хранящий контекст разговора.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletion` с заданными атрибутами.

### `ChatCompletionDelta`

**Описание**: Модель данных, представляющая дельту завершения чата.

**Атрибуты**:
- `role` (str): Роль отправителя сообщения.
- `content` (str): Содержание сообщения.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletionDelta` с заданными атрибутами.

### `ChatCompletionDeltaChoice`

**Описание**: Модель данных, представляющая выборку дельты завершения чата.

**Атрибуты**:
- `index` (int): Индекс выборки.
- `delta` (ChatCompletionDelta): Дельта завершения чата.
- `finish_reason` (Optional[str])`: Причина завершения.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ChatCompletionDeltaChoice` с заданными атрибутами.

### `Image`

**Описание**: Модель данных, представляющая изображение.

**Атрибуты**:
- `url` (Optional[str])`: URL изображения.
- `b64_json` (Optional[str])`: Изображение в формате base64 JSON.
- `revised_prompt` (Optional[str])`: Пересмотренный запрос.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `Image` с заданными атрибутами.

### `ImagesResponse`

**Описание**: Модель данных, представляющая ответ с изображениями.

**Атрибуты**:
- `data` (List[Image]): Список изображений.
- `model` (str): Модель, использованная для генерации изображений.
- `provider` (str): Поставщик услуги.
- `created` (int): Временная метка создания.

**Методы**:
- `model_construct`: Конструктор модели, который создает экземпляр `ImagesResponse` с заданными атрибутами.

## Функции

### `filter_none`
В этом файле эта функция не вызывается. Подробное описание смотри в файле `helper.py`

## Как работает модуль

1.  Определяются базовые классы `BaseModel`, которые служат основой для создания моделей данных.
2.  Создаются классы моделей данных, такие как `TokenDetails`, `UsageModel`, `ToolFunctionModel`, `ToolCallModel`, `ChatCompletionChunk`, `ChatCompletionMessage`, `ChatCompletionChoice`, `ChatCompletion`, `ChatCompletionDelta`, `ChatCompletionDeltaChoice`, `Image` и `ImagesResponse`, которые используются для представления различных структур данных.
3.  Для каждого класса определяются атрибуты, представляющие различные свойства данных.
4.  Для некоторых классов определяются методы `model_construct`, которые используются для создания экземпляров класса с заданными атрибутами.
5.  Класс `ChatCompletionMessage` содержит метод `save`, который используется для сохранения содержимого сообщения в файл.
6.  Вспомогательные функции, такие как `filter_none`, используются для фильтрации `None` значений при создании экземпляров классов.
7.  Функция `extract_data_uri` из модуля `..image` используется для извлечения данных из URI изображений.

```text
  BaseModel
  |
  -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
  TokenDetails                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   UsageModel
  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
  ToolFunctionModel                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ChatCompletionChunk
  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
  ToolCallModel                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ChatCompletionMessage
  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
  ChatCompletionChoice                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ChatCompletion
  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
  ChatCompletionDelta                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ChatCompletionDeltaChoice
  |
  Image
  |
  ImagesResponse
```

## Примеры

### Создание экземпляра `UsageModel`

```python
usage = UsageModel.model_construct(
    prompt_tokens=10,
    completion_tokens=20,
    total_tokens=30,
    prompt_tokens_details={"cached_tokens": 5},
    completion_tokens_details={"cached_tokens": 10}
)
print(usage.prompt_tokens)
print(usage.completion_tokens)
print(usage.total_tokens)

# 10
# 20
# 30
```

### Создание экземпляра `ChatCompletionMessage` и сохранение содержимого в файл

```python
message = ChatCompletionMessage.model_construct(content="Hello, world!")
message.save("message.txt")