# Модуль для улучшения кода с использованием g4f
## Обзор

Этот модуль предназначен для улучшения существующего кода Python с использованием библиотеки `g4f` для взаимодействия с языковыми моделями. Он считывает код из указанного файла, отправляет его в модель `g4f` для улучшения (добавление type hints, если возможно), и затем перезаписывает файл улучшенным кодом.

## Подробней

Модуль предназначен для автоматического улучшения кода, главным образом, путем добавления аннотаций типов (type hints), что повышает читаемость и облегчает отладку кода. Он использует библиотеку `g4f` для генерации улучшенного кода с помощью языковой модели.
Данный код позволяет автоматизировать процесс улучшения кода, освобождая разработчиков от рутинной работы по добавлению аннотаций типов.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """Извлекает код Python из текстового блока, заключенного в тройные обратные кавычки.

    Args:
        text (str): Текст, содержащий код Python, заключенный в тройные обратные кавычки.

    Returns:
        str | None: Извлеченный код Python или `None`, если код не найден.

    Как работает функция:
    1.  Функция `read_code` использует регулярное выражение для поиска кода Python, заключенного в тройные обратные кавычки (```python ... ``` или ```py ... ```).
    2.  Если соответствующий блок кода найден, функция извлекает код из этого блока и возвращает его.
    3.  Если блок кода не найден, функция возвращает `None`.

    ASCII Flowchart:

    Начало --> Поиск кода с помощью регулярного выражения --> Код найден?
                                                                ├── Да --> Извлечение кода --> Возврат кода
                                                                └── Нет --> Возврат None

    Примеры:
    >>> read_code("```python\nprint('Hello')\n```")
    "print('Hello')"

    >>> read_code("Some text ```python\nprint('Hello')\n``` more text")
    "print('Hello')"

    >>> read_code("No code here")
    None
    """
    ```
- **Назначение**: Извлечение кода Python из текстового блока, заключенного в тройные обратные кавычки.

   **Параметры**:

   - `text` (str): Текст, содержащий код Python, заключенный в тройные обратные кавычки.

   **Возвращает**:

   - `str | None`: Извлеченный код Python или `None`, если код не найден.

   **Как работает функция**:

    - 1. Функция использует регулярное выражение для поиска кода Python, заключенного в тройные обратные кавычки (```python ... ``` или ```py ... ```).
    - 2. Если соответствующий блок кода найден, функция извлекает код из этого блока и возвращает его.
    - 3. Если блок кода не найден, функция возвращает `None`.

   **ASCII Flowchart**:
     Начало
     ↓
     Поиск кода с помощью регулярного выражения
     ↓
     Код найден?
     ├── Да --> Извлечение кода --> Возврат кода
     └── Нет --> Возврат None

   **Примеры**:
    ```python
    >>> read_code("```python\nprint('Hello')\n```")
    "print('Hello')"
    >>> read_code("Some text ```python\nprint('Hello')\n``` more text")
    "print('Hello')"
    >>> read_code("No code here")
    None
    ```
### Основной блок кода

Основной блок кода выполняет следующие действия:

1.  Запрашивает у пользователя путь к файлу.
2.  Считывает содержимое файла.
3.  Формирует запрос для языковой модели `g4f`, включающий код из файла.
4.  Отправляет запрос в модель `g4f` для улучшения кода.
5.  Извлекает улучшенный код из ответа модели.
6.  Записывает улучшенный код обратно в файл.
```python
path = input("Path: ")

with open(path, "r") as file:
    code = file.read()

prompt = f"""
Improve the code in this file:
```py
{code}
```
Don\'t remove anything.
Add typehints if possible.
Don\'t add any typehints to kwargs.
Don\'t remove license comments.
"""

print("Create code...")
response = []
for chunk in g4f.ChatCompletion.create(
    model=g4f.models.default,
    messages=[{"role": "user", "content": prompt}],
    timeout=300,
    stream=True
):
    response.append(chunk)
    print(chunk, end="", flush=True)
print()
response = "".join(response)

if code := read_code(response):
    with open(path, "w") as file:
        file.write(code)
```

**Как работает основной блок кода**:

1.  Запрашивает у пользователя путь к файлу.
2.  Считывает содержимое файла.
3.  Формирует запрос для языковой модели `g4f`, включающий код из файла.
4.  Отправляет запрос в модель `g4f` для улучшения кода.
5.  Извлекает улучшенный код из ответа модели.
6.  Записывает улучшенный код обратно в файл.

**ASCII Flowchart**:

     Начало
     ↓
     Ввод пути к файлу
     ↓
     Чтение содержимого файла
     ↓
     Формирование запроса для g4f
     ↓
     Отправка запроса в g4f
     ↓
     Получение ответа от g4f
     ↓
     Извлечение кода из ответа
     ↓
     Запись улучшенного кода в файл
     ↓
     Конец

**Примеры использования**:

1.  Запуск скрипта и ввод пути к файлу, например: `example.py`. Скрипт улучшит код в `example.py` и перезапишет файл.