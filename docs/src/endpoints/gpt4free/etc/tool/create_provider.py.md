# Модуль для создания провайдера G4F

## Обзор

Этот модуль предназначен для автоматического создания нового провайдера для библиотеки `g4f` (GPT4Free) на основе предоставленной cURL команды. Он принимает cURL команду в качестве входных данных, запрашивает у GPT-4 сгенерировать код провайдера на основе этой команды, и сохраняет сгенерированный код в файл.

## Подробнее

Модуль выполняет следующие шаги:

1.  Запрашивает имя для нового провайдера.
2.  Предлагает ввести или вставить cURL команду, которая будет использоваться для генерации кода провайдера.
3.  Использует модель GPT-4 для генерации кода провайдера на основе предоставленной cURL команды и примера кода.
4.  Сохраняет сгенерированный код в файл с именем `<имя_провайдера>.py` в директории `g4f/Provider/`.
5.  Добавляет импорт нового провайдера в файл `g4f/Provider/__init__.py`.

## Функции

### `read_code`

```python
def read_code(text: str) -> str | None:
    """Извлекает код Python из текста, заключенного в блоки кода, обозначенные тройными обратными кавычками.

    Args:
        text (str): Текст, содержащий код Python, заключенный в блоки кода.

    Returns:
        str | None: Извлеченный код Python или None, если код не найден.

    Как работает функция:
    1. Функция пытается найти блоки кода, начинающиеся и заканчивающиеся тройными обратными кавычками, с указанием языка (python|py).
    2. Если блок кода найден, функция извлекает содержимое блока кода и возвращает его.
    3. Если блок кода не найден, функция возвращает None.
    """

    if match := re.search(r"```(python|py|)\\n(?P<code>[\\S\\s]+?)\\n```", text):
        return match.group("code")

    """
    A
    |
    B
    |
    return

    Где:
    A = Поиск кода python
    B = Возвращает код python или `None`

    """
```

**Пример:**

```python
code = read_code("```python\nprint('Hello, world!')\n```")
print(code) # Выведет: print('Hello, world!')
```

### `input_command`

```python
def input_command() -> str:
    """Считывает многострочный ввод от пользователя из STDIN до тех пор, пока не будет получен символ EOF (End-of-File).

    Args:
        Нет аргументов.

    Returns:
        str: Объединенные в одну строку введенные пользователем строки.

    Как работает функция:
    1.  Выводит сообщение "Enter/Paste the cURL command. Ctrl-D or Ctrl-Z ( windows ) to save it." чтобы подсказать пользователю, что нужно ввести.
    2.  Инициализирует пустой список contents для хранения введенных строк.
    3.  Запускает бесконечный цикл while True.
    4.  Внутри цикла пытается прочитать строку из STDIN с помощью input().
    5.  Если возникает исключение EOFError (что происходит, когда пользователь нажимает Ctrl-D или Ctrl-Z), цикл прерывается.
    6.  Введенная строка добавляется в список contents.
    7.  После завершения цикла функция объединяет все строки из списка contents в одну строку, разделяя их символами новой строки "\\n".
    8.  Возвращает полученную объединенную строку.

    **Внутренние функции:**
    - Нет

    """
    print("Enter/Paste the cURL command. Ctrl-D or Ctrl-Z ( windows ) to save it.")
    contents = []
    while True:
        try:
            line = input()
        except EOFError:
            break
        contents.append(line)
    return "\n".join(contents)

"""
A
|
B
|
C
|
D
|
return

Где:
A = Запрос ввода команды от пользователя
B = Считывание ввода до символа EOF
C = Добавление каждой строки в список
D = Объединение строк в одну строку
"""
```

**Пример:**

```python
command = input_command()
print(command) # Выведет введенную команду
```

## Переменные

### `name`

```python
name: str
```

Имя для нового провайдера, запрошенное у пользователя.

### `provider_path`

```python
provider_path: str
```

Путь к файлу, в котором будет сохранен код нового провайдера.

### `example`

```python
example: str
```

Пример кода провайдера, используемый в запросе к GPT-4 для генерации нового провайдера.

## Логика работы скрипта

1.  Импортируются необходимые модули: `sys`, `re`, `pathlib`, `os`, `g4f`.
2.  Добавляется путь к родительской директории в `sys.path`, чтобы можно было импортировать модуль `g4f`.
3.  Если файл провайдера с указанным именем еще не существует, запрашивается cURL команда у пользователя.
4.  Формируется запрос к GPT-4, включающий cURL команду, пример кода провайдера и имя класса провайдера.
5.  GPT-4 генерирует код провайдера на основе запроса.
6.  Сгенерированный код извлекается из ответа GPT-4 с помощью функции `read_code`.
7.  Код сохраняется в файл с именем `<имя_провайдера>.py` в директории `g4f/Provider/`.
8.  В файл `g4f/Provider/__init__.py` добавляется строка импорта нового провайдера.
9.  Если файл провайдера уже существует, его содержимое считывается в переменную `code`.

```
A
|
B
|
C
|
D
|
E
|
F
|
G

Где:
A = Проверка существования файла провайдера
B = Запрос cURL команды (если файл не существует)
C = Формирование запроса к GPT-4
D = Генерация кода провайдера
E = Извлечение кода из ответа GPT-4
F = Сохранение кода в файл
G = Добавление импорта в __init__.py