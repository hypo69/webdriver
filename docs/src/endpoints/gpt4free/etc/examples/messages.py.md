# Документация для модуля `messages.py`

## Обзор

Модуль `messages.py` предназначен для обработки диалогов с использованием AI-моделей через библиотеку `g4f`. Он содержит класс `ConversationHandler`, который управляет историей диалога и взаимодействует с моделью для получения ответов. Этот модуль позволяет вести последовательные беседы с AI, сохраняя контекст предыдущих сообщений.

## Подробнее

Данный код предоставляет простой способ для поддержания контекста в разговоре с AI, используя класс `ConversationHandler`. Он может быть использован для создания чат-ботов или других приложений, требующих взаимодействия с AI в режиме диалога.

## Классы

### `ConversationHandler`

**Описание**: Класс для управления историей диалога и взаимодействия с AI-моделью.

**Принцип работы**:

Класс `ConversationHandler` инициализируется с указанием используемой модели (по умолчанию "gpt-4"). Он хранит историю диалога в атрибуте `conversation_history` и использует клиент `g4f.client.Client` для отправки запросов к модели и получения ответов.

**Атрибуты**:

-   `client` (g4f.client.Client): Клиент для взаимодействия с AI-моделью.
-   `model` (str): Название используемой AI-модели (по умолчанию "gpt-4").
-   `conversation_history` (list): Список словарей, представляющих историю диалога. Каждый словарь содержит ключи "role" (роль участника: "user" или "assistant") и "content" (сообщение).

**Методы**:

-   `__init__(model="gpt-4")`: Инициализирует класс `ConversationHandler`.
-   `add_user_message(content)`: Добавляет сообщение пользователя в историю диалога.
-   `get_response()`: Отправляет историю диалога в AI-модель и возвращает ответ ассистента.

### `__init__(self, model="gpt-4")`

```python
def __init__(self, model="gpt-4"):
    """
    Инициализирует класс `ConversationHandler`.

    Args:
        model (str): Название используемой AI-модели (по умолчанию "gpt-4").
    """
    ...
```

**Назначение**: Инициализация экземпляра класса `ConversationHandler`.

**Параметры**:

-   `model` (str): Название используемой AI-модели. По умолчанию "gpt-4".

**Как работает функция**:

1.  Создает экземпляр клиента `g4f.client.Client`.
2.  Устанавливает название модели.
3.  Инициализирует пустой список для хранения истории диалога.

### `add_user_message(self, content)`

```python
def add_user_message(self, content):
    """
    Добавляет сообщение пользователя в историю диалога.

    Args:
        content (str): Текст сообщения пользователя.
    """
    ...
```

**Назначение**: Добавление сообщения пользователя в историю диалога.

**Параметры**:

-   `content` (str): Текст сообщения пользователя.

**Как работает функция**:

1.  Создает словарь с ролью "user" и переданным сообщением.
2.  Добавляет этот словарь в конец списка `conversation_history`.

```
    Сообщение пользователя
        │
        ▼
    Создание словаря
        │
        ▼
    Добавление в историю
```

### `get_response(self)`

```python
def get_response(self):
    """
    Отправляет историю диалога в AI-модель и возвращает ответ ассистента.

    Returns:
        str: Текст ответа ассистента.
    """
    ...
```

**Назначение**: Получение ответа от AI-модели на основе истории диалога.

**Возвращает**:

-   `str`: Текст ответа ассистента.

**Как работает функция**:

1.  Отправляет запрос к AI-модели, используя текущую историю диалога.
2.  Извлекает роль и содержание ответа ассистента из ответа модели.
3.  Добавляет ответ ассистента в историю диалога.
4.  Возвращает текст ответа ассистента.

```
История диалога
    │
    ▼
Отправка запроса AI-модели
    │
    ▼
Извлечение ответа ассистента
    │
    ▼
Добавление ответа в историю
    │
    ▼
Возврат ответа ассистента
```

**Примеры**:

```python
conversation = ConversationHandler()
conversation.add_user_message("Hello!")
print("Assistant:", conversation.get_response())

conversation.add_user_message("How are you?")
print("Assistant:", conversation.get_response())