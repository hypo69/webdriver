# Модуль для взаимодействия с API Copilot для completions

## Обзор

Модуль предоставляет пример запроса к API Copilot для получения completions (завершений). Он отправляет два запроса с использованием библиотеки `requests` и обрабатывает потоковый ответ, выводя содержимое в консоль. Этот код демонстрирует способ взаимодействия с API для получения ответов в режиме реального времени.

## Подробней

Этот скрипт демонстрирует базовый способ взаимодействия с API Copilot через HTTP-запросы. Он выполняет два последовательных запроса: первый с приветствием, а второй с запросом информации о имени пользователя. Ответы обрабатываются потоково, что позволяет выводить содержимое по мере поступления, а не ждать завершения всего запроса.

## Функции

### Отправка запроса и обработка ответа

```python
# Пример тела запроса
body = {
    "model": "",
    "provider": "Copilot", 
    "stream": True,
    "messages": [
        {"role": "user", "content": "Hello, i am Heiner. How are you?"}
    ],
    "conversation_id": conversation_id
}
```

**Как работает функция**:
- 1. **Определение URL**: Определяется URL-адрес для отправки запроса completions. `url = "http://localhost:1337/v1/chat/completions"`
- 2. **Формирование тела запроса**: Создается тело запроса в формате JSON, включающее модель, провайдера (Copilot), режим потоковой передачи, сообщение пользователя и идентификатор разговора.
- 3. **Отправка POST-запроса**: Отправляется POST-запрос к API с использованием библиотеки `requests`. Указывается, что ответ должен быть потоковым (`stream=True`).
- 4. **Обработка потокового ответа**: Итерируется по строкам потокового ответа. Если строка начинается с `b"data: "`, то извлекается JSON-данные из этой строки.
- 5. **Извлечение и вывод содержимого**: Из JSON-данных извлекается содержимое ответа и выводится в консоль. Если встречается ошибка, она также выводится.
- 6. **Повторение для второго запроса**: Шаги 2-5 повторяются для второго запроса с другим сообщением пользователя.

```
A: Определение URL и тела запроса
|
-- B: Отправка POST-запроса к API (requests.post)
|
C: Итерация по строкам потокового ответа (response.iter_lines())
|
D: Проверка начала строки с "data: "
|
E: Извлечение JSON-данных из строки
|
F: Извлечение и вывод содержимого или ошибки
```

**Примеры**:

Пример 1: Отправка приветственного сообщения
```python
body = {
    "model": "",
    "provider": "Copilot", 
    "stream": True,
    "messages": [
        {"role": "user", "content": "Hello, i am Heiner. How are you?"}
    ],
    "conversation_id": conversation_id
}
response = requests.post(url, json=body, stream=True)
```

Пример 2: Запрос информации о имени
```python
body = {
    "model": "",
    "provider": "Copilot",
    "stream": True, 
    "messages": [
        {"role": "user", "content": "Tell me somethings about my name"}
    ],
    "conversation_id": conversation_id
}
response = requests.post(url, json=body, stream=True)