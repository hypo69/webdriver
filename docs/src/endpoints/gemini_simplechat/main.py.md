# Модуль `gemini_simplechat.main`

## Обзор

Модуль предоставляет простой чат, использующий модель Google Gemini для обработки и генерации ответов на сообщения пользователя. Он включает в себя FastAPI приложение с настроенным CORS middleware, endpoint для приема сообщений и отправки ответов, а также механизм для локального запуска сервера.

## Подробней

Этот модуль служит для создания и запуска API, которое позволяет взаимодействовать с моделью Google Gemini. Он использует FastAPI для обработки HTTP запросов, Pydantic для валидации данных, и модуль `src.ai.GoogleGenerativeAI` для взаимодействия с самой моделью Gemini. Модуль также содержит конфигурацию CORS для обеспечения возможности отправки запросов с других доменов, что полезно для разработки веб-интерфейсов, взаимодействующих с API.

## Классы

### `ChatRequest`

**Описание**: Pydantic модель для входящих запросов чата.

**Аттрибуты**:
- `message` (str): Сообщение пользователя.

## Функции

### `root`

```python
async def root() -> HTMLResponse:
    """
    Возвращает содержимое HTML-файла для корневого пути ("/").

    Args:
        Нет

    Returns:
        HTMLResponse: HTML-контент для отображения в браузере.

    Raises:
        HTTPException: В случае ошибки чтения HTML-файла, возвращает HTTP-ответ с кодом 500.

    Как работает функция:
    1.  Функция пытается прочитать содержимое HTML-файла, путь к которому определяется переменной `gs.fast_api.index_path`.
    2.  В случае успешного чтения, возвращает HTMLResponse с содержимым файла.
    3.  Если происходит исключение при чтении файла, функция логирует ошибку и вызывает HTTPException с кодом 500 и детальным описанием ошибки.

    ASCII flowchart:

    Начало --> Прочитать HTML-файл --> Успешно? --> Да: Вернуть HTMLResponse
                                        |
                                        Нет: Логировать ошибку --> Вызвать HTTPException --> Конец

    Примеры:
    - Пример успешного вызова:

        ```python
        response = await root()
        print(response.status_code) #  200
        ```

    - Пример вызова при ошибке чтения файла:
        В этом случае будет выброшено исключение HTTPException с кодом 500.
    """
    ...
```

### `chat`

```python
async def chat(request: ChatRequest) -> dict:
    """
    Принимает сообщение от пользователя и возвращает ответ от модели Google Gemini.

    Args:
        request (ChatRequest): Объект, содержащий сообщение пользователя.

    Returns:
        dict: Ответ от модели в формате словаря {"response": response}.

    Raises:
        HTTPException: В случае ошибки при взаимодействии с моделью, возвращает HTTP-ответ с кодом 500.

    Как работает функция:
    1.  Функция принимает объект `ChatRequest`, содержащий сообщение пользователя.
    2.  Передает сообщение в модель Google Gemini для получения ответа.
    3.  В случае успешного получения ответа, возвращает словарь с ответом.
    4.  Если происходит исключение при взаимодействии с моделью, функция логирует ошибку и вызывает HTTPException с кодом 500 и детальным описанием ошибки.

    ASCII flowchart:

    Начало --> Получить сообщение от пользователя --> Отправить сообщение в модель Gemini --> Получить ответ --> Успешно? --> Да: Вернуть ответ
                                                                                               |
                                                                                               Нет: Логировать ошибку --> Вызвать HTTPException --> Конец

    Примеры:
    - Пример успешного вызова:

        ```python
        request = ChatRequest(message="Привет, как дела?")
        response = await chat(request)
        print(response) #  {'response': 'Привет! У меня все хорошо, спасибо, что спросили.'}
        ```

    - Пример вызова при ошибке взаимодействия с моделью:
        В этом случае будет выброшено исключение HTTPException с кодом 500.
    """
    ...
```

## Локальный запуск сервера

```python
if __name__ == "__main__":
    uvicorn.run(app, host=gs.fast_api.host, port=int(gs.fast_api.port))
```

Этот блок кода запускает FastAPI приложение с использованием Uvicorn. Он использует параметры хоста и порта, определенные в `gs.fast_api`, для запуска сервера. Этот код выполняется только при непосредственном запуске файла, а не при импорте в качестве модуля.