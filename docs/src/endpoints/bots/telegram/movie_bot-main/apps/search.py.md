# Модуль для поиска кинопроизведений на Kinopoisk

## Обзор

Модуль предоставляет функцию `search_query`, которая выполняет поиск кинопроизведений (фильмов или сериалов) на сайте Kinopoisk через поисковую систему Google. Результаты поиска возвращаются в виде словаря, содержащего ссылку на страницу кинопроизведения, заголовок и краткое описание.

## Подробней

Этот модуль предназначен для автоматического поиска информации о кинопроизведениях на сайте Kinopoisk. Он использует библиотеку `requests` для выполнения HTTP-запросов к Google, библиотеку `bs4` (Beautiful Soup) для парсинга HTML-ответа и модуль `useragent` для получения случайного User-Agent, чтобы имитировать запросы от реальных пользователей. Результаты поиска обрабатываются для извлечения полезной информации и возвращаются в удобном формате.

## Функции

### `search_query`

```python
def search_query(query: str, type_movie: str = 'series') -> dict | None:
    """
    Выполняет поиск кинопроизведения на сайте Kinopoisk через Google.

    Args:
        query (str): Поисковой запрос (название фильма или сериала).
        type_movie (str, optional): Тип кинопроизведения ('series' или 'movie'). По умолчанию 'series'.

    Returns:
        dict | None: Словарь с информацией о кинопроизведении, содержащий ссылку, заголовок и описание.
                     Возвращает `None`, если ничего не найдено.
    """

    def get_useragent() -> str:
        """
        Получает случайный User-Agent.

        Returns:
            str: Случайный User-Agent.
        """
        ...

    # Создание поискового запроса для Google.
    # Выполнение HTTP-запроса к Google с заданными параметрами и заголовками.
    # Парсинг HTML-ответа с использованием BeautifulSoup.
    # Поиск блоков с результатами поиска.
    # Извлечение ссылки, заголовка и описания из каждого результата.
    # Проверка, является ли ссылка ссылкой на страницу кинопроизведения на Kinopoisk.
    # Формирование и возврат словаря с информацией о кинопроизведении.
    # Возврат None, если ничего не найдено.

    # ASCII схема работы функции:

    # Поисковой запрос --> HTTP-запрос --> HTML-ответ --> Парсинг HTML --> Извлечение данных --> Формирование результата
    #                                                                          ↑
    # Случайный User-Agent                                                      |
    #                                                                          |
    #                                                                   Проверка на Kinopoisk

    # Примеры:
    # >>> search_query('теория большого взрыва')
    # {'link': 'https://w2.kpfr.wiki/series/84366', 'title': 'Теория большого взрыва (сериал, 2007 – 2019) — описание ...', 'description': 'Сериал рассказывает о физиках, которые не очень хорошо разбираются в жизни.'}

    # >>> search_query('Игра престолов', 'series')
    # {'link': 'https://w2.kpfr.wiki/series/461315', 'title': 'Игра престолов (сериал, 2011 – 2019) — описание ...', 'description': 'Борьба за власть в вымышленном мире.'}

    # >>> search_query('Дюна', 'movie')
    # {'link': 'https://w2.kpfr.wiki/movie/111745', 'title': 'Дюна (2021) — описание фильма', 'description': 'История о доме Атрейдесов и их миссии на планете Арракис.'}

```
Как работает функция:

1.  **Создание поискового запроса**: Формируется поисковый запрос для Google, включающий указанный `query` (название фильма или сериала) и указание на сайт Kinopoisk (`site:www.kinopoisk.ru`).
2.  **Выполнение HTTP-запроса**: Выполняется HTTP-запрос к Google с использованием библиотеки `requests`. В запросе передаются параметры, включающие поисковый запрос, язык (`hl=ru`) и случайный User-Agent для имитации запроса от браузера.
3.  **Парсинг HTML-ответа**: Полученный HTML-ответ от Google парсится с использованием библиотеки `BeautifulSoup`.
4.  **Поиск блоков с результатами**: В распарсенном HTML-коде находятся блоки (`div`) с атрибутом `class="g"`, которые содержат результаты поиска.
5.  **Извлечение данных из результатов**: Для каждого найденного блока извлекаются ссылка (`a`), заголовок (`h3`) и описание (`div`) кинопроизведения.
6.  **Проверка ссылки**: Проверяется, что извлеченная ссылка ведет на страницу кинопроизведения на сайте Kinopoisk. Это делается путем проверки, что предпоследняя часть URL (идентификатор кинопроизведения) является числом.
7.  **Формирование результата**: Если все проверки пройдены успешно, формируется словарь с информацией о кинопроизведении, включающий ссылку, заголовок и описание.
8.  **Возврат результата**: Сформированный словарь возвращается как результат работы функции. Если ничего не найдено, возвращается `None`.

ASCII схема работы функции:

```
Начало
│
└──► Формирование_запроса (query, type_movie)
│       term = f'site:www.kinopoisk.ru/{type_movie} {query}'
│
└──► HTTP_запрос (url="https://www.google.com/search", headers, params)
│       resp = get(url, headers, params, timeout=5)
│
└──► Парсинг_HTML (resp.text)
│       soup = BeautifulSoup(resp.text, "html.parser")
│
└──► Поиск_блоков_результатов (soup)
│       result_block = soup.find_all("div", attrs={"class": "g"})
│
└──► Проход_по_блокам (result_block)
│   │
│   └──► Извлечение_данных (link, title, description)
│   │   │   link = result.find("a", href=True)
│   │   │   title = result.find("h3")
│   │   │   description = result.find("div", {"style": "-webkit-line-clamp:2"})
│   │   │
│   │   └──► Проверка_данных (link, title, description)
│   │       │   if link and title and description:
│   │       │       if link["href"].split("/")[-2].isdigit():
│   │       │           └──► Формирование_результата (link, title, description)
│   │       │               │   return {'link': ..., 'title': ..., 'description': ...}
│   │       │
│   └──► Конец_цикла
│
└──► Ничего_не_найдено
│   return None
│
Конец
```

## Примеры

```python
if __name__ == '__main__':
    print(search_query('теория большого взрыва'))