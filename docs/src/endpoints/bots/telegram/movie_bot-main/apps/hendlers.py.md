# Модуль обработчиков `hendlers.py`

## Обзор

Модуль `hendlers.py` предназначен для обработки сообщений и callback-запросов в Telegram-боте для поиска фильмов и сериалов. Он использует библиотеку `aiogram` для работы с Telegram API, а также модуль `apps.keyboard` для создания клавиатур и модуль `apps.search` для выполнения поисковых запросов.

## Подробнее

Этот модуль определяет обработчики для различных команд и действий пользователя, таких как запуск бота, выбор типа контента (фильм или сериал) и ввод названия для поиска. Он также использует конечные автоматы (FSM) для управления состоянием диалога с пользователем.

## Классы

### `Params`

**Описание**: Класс `Params` определяет состояния, используемые в конечном автомате (FSM) для отслеживания параметров поиска фильма или сериала.

**Наследует**:

- `StatesGroup` из `aiogram.fsm.state`

**Атрибуты**:

- `type_movie` (State): Состояние для хранения типа фильма (film или series).
- `name` (State): Состояние для хранения названия фильма или сериала.

## Функции

### `command_start_handler`

```python
async def command_start_handler(message: Message) -> None:
    """Обработчик команды `/start`. Отправляет приветственное сообщение пользователю и предлагает найти фильм.

    Args:
        message (Message): Объект сообщения от Telegram.

    Returns:
        None

    Example:
        Пользователь отправляет команду `/start`. Бот отвечает приветственным сообщением и кнопкой для поиска фильма.
    """
```

**Назначение**: Обрабатывает команду `/start`, отправляет приветственное сообщение пользователю и предлагает начать поиск фильма.

**Параметры**:

- `message` (Message): Объект сообщения, содержащий информацию о сообщении, отправленном пользователем.

**Возвращает**:

- `None`

**Как работает функция**:

1. Отправляет приветственное сообщение пользователю с использованием его имени из объекта `message`.
2. Предлагает пользователю найти интересующий фильм, отправляя сообщение с клавиатурой `kb.find_movie`.

**ASCII flowchart**:

```
Начало --> Приветствие пользователю --> Предложение найти фильм --> Конец
```

**Примеры**:

```python
# Пример вызова функции (обычно вызывается автоматически aiogram)
# message = Message(...)  # Создание объекта Message (здесь для примера)
# await command_start_handler(message)
```

### `movie_handler`

```python
async def movie_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса `new_movies`. Устанавливает состояние `Params.type_movie` и предлагает пользователю указать тип фильма или сериала.

    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект контекста FSM.

    Returns:
        None

    Example:
        Пользователь нажимает кнопку "Найти фильм". Бот предлагает выбрать тип контента (фильм или сериал).
    """
```

**Назначение**: Обрабатывает callback-запрос `new_movies`, устанавливает состояние `Params.type_movie` и предлагает пользователю выбрать тип контента (фильм или сериал).

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

**Возвращает**:

- `None`

**Как работает функция**:

1. Устанавливает состояние `Params.type_movie` в FSM, чтобы указать, что следующим шагом будет выбор типа контента.
2. Редактирует сообщение, отправляя пользователю клавиатуру `kb.choice` с вариантами выбора (фильм или сериал).

**ASCII flowchart**:

```
Начало --> Установка состояния Params.type_movie --> Предложение выбрать тип контента --> Конец
```

**Примеры**:

```python
# Пример вызова функции (обычно вызывается автоматически aiogram)
# callback = CallbackQuery(...)  # Создание объекта CallbackQuery (здесь для примера)
# state = FSMContext(...)  # Создание объекта FSMContext (здесь для примера)
# await movie_handler(callback, state)
```

### `series_handler`

```python
async def series_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса `series`. Удаляет предыдущее сообщение, обновляет данные в FSM, устанавливает состояние `Params.name` и запрашивает название сериала.

    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект контекста FSM.

    Returns:
        None

    Example:
        Пользователь выбирает "Сериал". Бот запрашивает название сериала.
    """
```

**Назначение**: Обрабатывает callback-запрос `series`, удаляет предыдущее сообщение, обновляет данные в FSM, устанавливает состояние `Params.name` и запрашивает название сериала.

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

**Возвращает**:

- `None`

**Как работает функция**:

1. Удаляет предыдущее сообщение с помощью `callback.message.delete()`.
2. Обновляет данные в FSM, устанавливая значение `type_movie` равным `'series'`.
3. Устанавливает состояние `Params.name` в FSM, чтобы указать, что следующим шагом будет ввод названия.
4. Отправляет пользователю сообщение с запросом названия сериала.

**ASCII flowchart**:

```
Начало --> Удаление предыдущего сообщения --> Обновление данных в FSM (type_movie = 'series') --> Установка состояния Params.name --> Запрос названия сериала --> Конец
```

**Примеры**:

```python
# Пример вызова функции (обычно вызывается автоматически aiogram)
# callback = CallbackQuery(...)  # Создание объекта CallbackQuery (здесь для примера)
# state = FSMContext(...)  # Создание объекта FSMContext (здесь для примера)
# await series_handler(callback, state)
```

### `film_handler`

```python
async def film_handler(callback: CallbackQuery, state: FSMContext) -> None:
    """Обработчик callback-запроса `film`. Удаляет предыдущее сообщение, обновляет данные в FSM, устанавливает состояние `Params.name` и запрашивает название фильма.

    Args:
        callback (CallbackQuery): Объект callback-запроса.
        state (FSMContext): Объект контекста FSM.

    Returns:
        None

    Example:
        Пользователь выбирает "Фильм". Бот запрашивает название фильма.
    """
```

**Назначение**: Обрабатывает callback-запрос `film`, удаляет предыдущее сообщение, обновляет данные в FSM, устанавливает состояние `Params.name` и запрашивает название фильма.

**Параметры**:

- `callback` (CallbackQuery): Объект callback-запроса, содержащий информацию о запросе, отправленном пользователем.
- `state` (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

**Возвращает**:

- `None`

**Как работает функция**:

1. Удаляет предыдущее сообщение с помощью `callback.message.delete()`.
2. Обновляет данные в FSM, устанавливая значение `type_movie` равным `'film'`.
3. Устанавливает состояние `Params.name` в FSM, чтобы указать, что следующим шагом будет ввод названия.
4. Отправляет пользователю сообщение с запросом названия фильма.

**ASCII flowchart**:

```
Начало --> Удаление предыдущего сообщения --> Обновление данных в FSM (type_movie = 'film') --> Установка состояния Params.name --> Запрос названия фильма --> Конец
```

**Примеры**:

```python
# Пример вызова функции (обычно вызывается автоматически aiogram)
# callback = CallbackQuery(...)  # Создание объекта CallbackQuery (здесь для примера)
# state = FSMContext(...)  # Создание объекта FSMContext (здесь для примера)
# await film_handler(callback, state)
```

### `name_handler`

```python
async def name_handler(message: Message, state: FSMContext) -> None:
    """Обработчик сообщений в состоянии `Params.name`. Обновляет данные в FSM, выполняет поиск фильма или сериала и отправляет результат пользователю.

    Args:
        message (Message): Объект сообщения от Telegram.
        state (FSMContext): Объект контекста FSM.

    Returns:
        None

    Example:
        Пользователь вводит название фильма или сериала. Бот выполняет поиск и отправляет результат.
    """
```

**Назначение**: Обрабатывает сообщение с названием фильма или сериала, выполняет поиск и отправляет результат пользователю.

**Параметры**:

- `message` (Message): Объект сообщения, содержащий информацию о сообщении, отправленном пользователем.
- `state` (FSMContext): Объект контекста FSM, используемый для управления состоянием диалога.

**Возвращает**:

- `None`

**Как работает функция**:

1. Обновляет данные в FSM, сохраняя название фильма или сериала из сообщения пользователя.
2. Извлекает данные из FSM, включая название и тип контента.
3. Вызывает функцию `search_query` из модуля `apps.search` для выполнения поиска.
4. Отправляет пользователю сообщение с информацией о запросе (название и тип).
5. Если найден фильм или сериал, отправляет сообщение с информацией о найденном контенте (название, описание, ссылка).
6. Если ничего не найдено, отправляет сообщение о том, что контент не найден.
7. Предлагает пользователю найти новый фильм или сериал, отправляя сообщение с клавиатурой `kb.find_movie`.
8. Очищает состояние FSM.

**ASCII flowchart**:

```
Начало --> Обновление данных в FSM (name = message.text) --> Извлечение данных из FSM --> Выполнение поиска (search_query) --> Отправка информации о запросе -->
|
+-- Контент найден? -- Да --> Отправка информации о найденном контенте --> Предложение найти новый фильм --> Очистка FSM --> Конец
|                  |
+------------------ Нет --> Отправка сообщения о том, что контент не найден --> Предложение найти новый фильм --> Очистка FSM --> Конец
```

**Примеры**:

```python
# Пример вызова функции (обычно вызывается автоматически aiogram)
# message = Message(...)  # Создание объекта Message (здесь для примера)
# state = FSMContext(...)  # Создание объекта FSMContext (здесь для примера)
# await name_handler(message, state)