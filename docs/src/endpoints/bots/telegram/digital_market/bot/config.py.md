# Модуль конфигурации Telegram-бота для цифрового рынка
=========================================================

Модуль содержит настройки для Telegram-бота, используемого в цифровом рынке.
Он включает в себя классы и переменные для управления конфигурацией бота,
такие как токен бота, идентификаторы администраторов, URL сайта и другие параметры.

## Обзор

Этот модуль содержит класс `Settings`, который использует `pydantic_settings` для загрузки настроек из переменных окружения и файла `.env`. Он также инициализирует объекты `Bot` и `Dispatcher` из библиотеки `aiogram` и настраивает логирование с помощью `loguru`.

## Подробней

Этот модуль предназначен для централизованного управления конфигурацией Telegram-бота. Он использует библиотеку `pydantic-settings` для автоматической загрузки настроек из переменных окружения и файла `.env`. Класс `Settings` определяет все необходимые параметры конфигурации, такие как токен бота, список идентификаторов администраторов, токен провайдера платежей, URL сайта и параметры доступа к базе данных.

Модуль также инициализирует объекты `Bot` и `Dispatcher` из библиотеки `aiogram`, которые используются для управления ботом и обработки входящих сообщений. Настройка логирования осуществляется с помощью библиотеки `loguru`, что позволяет записывать информацию о работе бота в файл.

## Классы

### `Settings`

**Описание**: Класс для хранения и управления настройками бота.

**Принцип работы**:
Класс `Settings` наследуется от `BaseSettings` и использует `SettingsConfigDict` для указания файла `.env`, из которого загружаются переменные окружения. Он определяет атрибуты для хранения различных параметров конфигурации, таких как токен бота, идентификаторы администраторов и URL сайта. Также класс содержит методы для динамического формирования URL-адресов для вебхуков.

**Аттрибуты**:
- `BOT_TOKEN` (str): Токен Telegram-бота.
- `ADMIN_IDS` (List[int]): Список идентификаторов администраторов бота.
- `PROVIDER_TOKEN` (str): Токен провайдера платежей.
- `FORMAT_LOG` (str): Формат записи логов (по умолчанию: "{time:YYYY-MM-DD at HH:mm:ss} | {level} | {message}").
- `LOG_ROTATION` (str): Размер ротации логов (по умолчанию: "10 MB").
- `DB_URL` (str): URL базы данных (по умолчанию: 'sqlite+aiosqlite:///data/db.sqlite3').
- `SITE_URL` (str): URL сайта.
- `SITE_HOST` (str): Хост сайта.
- `SITE_PORT` (int): Порт сайта.
- `MRH_LOGIN` (str): Логин MRH.
- `MRH_PASS_1` (str): Пароль MRH (часть 1).
- `MRH_PASS_2` (str): Пароль MRH (часть 2).
- `IN_TEST` (int): Флаг, указывающий на тестовую среду.
- `model_config` (SettingsConfigDict): Конфигурация для `pydantic-settings`.

**Методы**:
- `get_webhook_url()`: Динамически формирует URL для вебхука на основе токена и URL сайта.
- `get_provider_hook_url()`: Динамически формирует URL для вебхука провайдера платежей на основе токена и URL сайта.

### `Settings.get_webhook_url`

```python
def get_webhook_url(self) -> str:
    """Динамически формирует путь для вебхука на основе токена и URL сайта."""
    return f"{self.SITE_URL}/{self.BOT_TOKEN}"
```

**Назначение**: Формирует URL для вебхука Telegram-бота.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Settings`.

**Возвращает**:
- `str`: URL для вебхука, сформированный как `f"{self.SITE_URL}/{self.BOT_TOKEN}"`.

**Как работает функция**:

1. **Формирование URL**:
   - Функция объединяет `SITE_URL` и `BOT_TOKEN` для создания полного URL-адреса вебхука.

```
SITE_URL + BOT_TOKEN --> Webhook URL
```

**Примеры**:

```python
settings = Settings(BOT_TOKEN='test_token', SITE_URL='https://example.com')
webhook_url = settings.get_webhook_url()
print(webhook_url)  # Вывод: https://example.com/test_token
```

### `Settings.get_provider_hook_url`

```python
def get_provider_hook_url(self) -> str:
    """Динамически формирует путь для вебхука на основе токена и URL сайта."""
    return f"{self.SITE_URL}/robokassa"
```

**Назначение**: Формирует URL для вебхука провайдера платежей.

**Параметры**:
- `self`: Ссылка на экземпляр класса `Settings`.

**Возвращает**:
- `str`: URL для вебхука провайдера платежей, сформированный как `f"{self.SITE_URL}/robokassa"`.

**Как работает функция**:

1. **Формирование URL**:
   - Функция объединяет `SITE_URL` и строку `/robokassa` для создания полного URL-адреса вебхука провайдера платежей.

```
SITE_URL + "/robokassa" --> Provider Webhook URL
```

**Примеры**:

```python
settings = Settings(SITE_URL='https://example.com')
provider_webhook_url = settings.get_provider_hook_url()
print(provider_webhook_url)  # Вывод: https://example.com/robokassa
```

## Функции

### Нет функций, определенных в явном виде, кроме методов класса `Settings`.

## Переменные

### `settings`

**Описание**: Экземпляр класса `Settings` с загруженными настройками.

**Назначение**: Используется для доступа к параметрам конфигурации бота.

### `bot`

**Описание**: Экземпляр класса `Bot` из библиотеки `aiogram`.

**Назначение**: Используется для взаимодействия с Telegram API.

### `dp`

**Описание**: Экземпляр класса `Dispatcher` из библиотеки `aiogram`.

**Назначение**: Используется для регистрации обработчиков сообщений и управления состоянием бота.

### `admins`

**Описание**: Список идентификаторов администраторов бота.

**Назначение**: Используется для определения администраторов, имеющих особые права.

### `log_file_path`

**Описание**: Путь к файлу логов.

**Назначение**: Используется для указания места хранения логов.

### `logger`

**Описание**: Объект логгера из библиотеки `loguru`.

**Назначение**: Используется для записи информации о работе бота в файл.

### `database_url`

**Описание**: URL базы данных.

**Назначение**: Используется для подключения к базе данных.