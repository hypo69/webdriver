# Модуль миграции базы данных: Обновление таблицы покупок

## Обзор

Этот модуль содержит скрипт миграции базы данных, используемый Alembic для обновления таблицы `purchases`. Скрипт добавляет столбец `payment_type` и создает уникальный индекс для столбца `payment_id`.

## Подробней

Этот скрипт миграции используется для изменения структуры базы данных при обновлении версии программного обеспечения. Он добавляет новый столбец `payment_type` в таблицу `purchases`, который будет хранить тип платежа для каждой покупки. Также создается уникальный индекс для `payment_id`, чтобы гарантировать уникальность идентификаторов платежей. Скрипт также содержит функцию `downgrade`, которая выполняет обратное действие, удаляя столбец `payment_type` и индекс, если необходимо откатить миграцию.

## Функции

### `upgrade`

```python
def upgrade() -> None:
    """
    Добавляет столбец 'payment_type' в таблицу 'purchases' и создает уникальный индекс для столбца 'payment_id'.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: В случае ошибки при выполнении миграции.
    """
```

**Назначение**: Обновление структуры базы данных путем добавления столбца `payment_type` в таблицу `purchases` и создания уникального индекса для столбца `payment_id`.

**Как работает функция**:

1.  Добавление нового столбца `payment_type` типа `String` в таблицу `purchases`.  Указание `nullable=False` означает, что столбец не может содержать `NULL` значения.
2.  Создание уникального индекса для столбца `payment_id` в таблице `purchases`.

```
Добавление столбца payment_type в purchases
↓
Создание уникального индекса для payment_id в purchases
```

### `downgrade`

```python
def downgrade() -> None:
    """
    Удаляет столбец 'payment_type' и уникальный индекс из таблицы 'purchases' при откате миграции.

    Args:
        None

    Returns:
        None

    Raises:
        Exception: В случае ошибки при выполнении отката миграции.
    """
```

**Назначение**: Откат изменений, внесенных функцией `upgrade`, путем удаления столбца `payment_type` и уникального индекса из таблицы `purchases`.

**Как работает функция**:

1.  Удаление уникального индекса из таблицы `purchases`.
2.  Удаление столбца `payment_type` из таблицы `purchases`.

```
Удаление уникального индекса из purchases
↓
Удаление столбца payment_type из purchases