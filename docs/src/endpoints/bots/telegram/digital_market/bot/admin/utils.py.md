# Модуль для обработки удаления текстовых сообщений в Telegram боте
======================================================================

Модуль содержит асинхронную функцию `process_dell_text_msg`, которая используется для удаления последнего сообщения пользователя и текущего сообщения с командой в Telegram боте.

## Обзор

Этот модуль предназначен для обработки ситуаций, когда пользователь отправляет команду для удаления предыдущего сообщения. Функция `process_dell_text_msg` извлекает идентификатор последнего сообщения из FSMContext и пытается удалить как последнее сообщение, так и сообщение с командой.

## Подробней

Модуль обеспечивает механизм для удаления сообщений в чате с пользователем. Он использует данные, сохраненные в FSMContext, для определения идентификатора последнего сообщения и пытается удалить его, а также сообщение, содержащее команду удаления. Это полезно для очистки чата от ненужных сообщений и упрощения взаимодействия пользователя с ботом.

## Функции

### `process_dell_text_msg`

```python
async def process_dell_text_msg(message: Message, state: FSMContext):
    """ Функция выполняет удаление последнего сообщения пользователя и текущего сообщения с командой в Telegram боте.

    Args:
        message (Message): Объект сообщения Telegram, содержащий информацию о сообщении, отправителе и чате.
        state (FSMContext): Объект FSMContext, содержащий состояние конечного автомата для текущего пользователя.

    Returns:
        None

    Raises:
        Exception: Если происходит ошибка при удалении сообщения.

    """
```

**Назначение**: Удаление последнего сообщения пользователя и текущего сообщения с командой в Telegram боте.

**Параметры**:

- `message` (Message): Объект сообщения Telegram. Содержит информацию о сообщении, отправителе и чате.
- `state` (FSMContext): Объект FSMContext. Хранит состояние конечного автомата для текущего пользователя.

**Возвращает**:

- `None`: Функция ничего не возвращает.

**Вызывает исключения**:

- `Exception`: Возникает, если происходит ошибка при удалении сообщения.

**Как работает функция**:

1. **Извлечение данных из состояния**:
   - Функция извлекает данные из состояния FSMContext, используя `await state.get_data()`.
   - Получает идентификатор последнего сообщения (`last_msg_id`) извлекая его по ключу `last_msg_id` из полученных данных.

2. **Удаление сообщений**:
   - Проверяет, существует ли `last_msg_id`.
   - Если `last_msg_id` существует, функция пытается удалить сообщение с этим идентификатором, используя `await bot.delete_message(chat_id=message.from_user.id, message_id=last_msg_id)`.
   - Затем функция пытается удалить сообщение с командой, используя `await message.delete()`.

3. **Обработка ошибок**:
   - Если `last_msg_id` не найден, функция логирует предупреждение с помощью `logger.warning("Ошибка: Не удалось найти идентификатор последнего сообщения для удаления.")`.
   - Если происходит исключение в процессе удаления сообщения, функция логирует ошибку с помощью `logger.error(f"Произошла ошибка при удалении сообщения: {str(e)}")`.

```
    A: Получение данных из FSMContext
    |
    B: Проверка наличия last_msg_id
    |
    C: Удаление сообщения с last_msg_id
    |
    D: Удаление текущего сообщения
    |
    E: Обработка исключений
```

**Примеры**:

Пример 1: Успешное удаление сообщений

```python
# Предположим, что у пользователя есть последнее сообщение с id 123, и текущее сообщение с командой имеет id 456
message = Message(message_id=456, from_user=User(id=789))
state = FSMContext(...)  # Предположим, что FSMContext уже инициализирован и содержит данные
await state.update_data(last_msg_id=123)
await process_dell_text_msg(message, state)
# Ожидается, что сообщение с id 123 и 456 будут удалены
```

Пример 2: Ошибка при удалении сообщения

```python
# Предположим, что у пользователя нет последнего сообщения в FSMContext
message = Message(message_id=456, from_user=User(id=789))
state = FSMContext(...)  # Предположим, что FSMContext уже инициализирован, но не содержит данных о последнем сообщении
await process_dell_text_msg(message, state)
# Ожидается, что будет залогировано предупреждение об отсутствии last_msg_id и удалено только текущее сообщение