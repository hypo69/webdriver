# Модуль утилит для работы с MEGA

## Обзор

Модуль содержит набор утилитных функций, используемых для шифрования, дешифрования, кодирования и декодирования данных, необходимых при работе с MEGA API.

## Подробней

Этот модуль предоставляет функции для преобразования данных между различными форматами, такими как целые числа, строки, массивы 32-битных целых чисел и base64url-encoded строки. Он также включает функции для шифрования и дешифрования данных с использованием AES в режиме CBC. Эти утилиты важны для обеспечения безопасности и целостности данных при взаимодействии с MEGA.

## Функции

### `a32_to_str`

```python
def a32_to_str(a):
    """This if example function
    Args:
        a (List[int]): Список 32-битных целых чисел.

    Returns:
        str: Строка, полученная путем упаковки 32-битных целых чисел из списка `a`.

     Example:
         Примеры вызовов
    """
```

**Описание**: Преобразует список 32-битных целых чисел в строку.

**Как работает функция**: Функция принимает список 32-битных целых чисел и использует `struct.pack` для упаковки этих чисел в строку. Формат `>%dI` указывает, что нужно упаковать `len(a)` целых чисел в big-endian порядке.

**Параметры**:
- `a` (List[int]): Список 32-битных целых чисел, которые нужно преобразовать в строку.

**Возвращает**:
- `str`: Строка, полученная путем упаковки 32-битных целых чисел.

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """This if example function
    Args:
        data (bytes): Данные для шифрования.
        key (bytes): Ключ шифрования.

    Returns:
        bytes: Зашифрованные данные.

     Example:
         Примеры вызовов
    """
```

**Описание**: Шифрует данные с использованием AES в режиме CBC.

**Как работает функция**: Функция создает объект шифрования AES с использованием предоставленного ключа и режима CBC. Затем она шифрует предоставленные данные и возвращает зашифрованный результат.

**Параметры**:
- `data` (bytes): Данные для шифрования.
- `key` (bytes): Ключ шифрования.

**Возвращает**:
- `bytes`: Зашифрованные данные.

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """This if example function
    Args:
        data (List[int]): Данные для шифрования в виде списка 32-битных целых чисел.
        key (List[int]): Ключ шифрования в виде списка 32-битных целых чисел.

    Returns:
        List[int]: Зашифрованные данные в виде списка 32-битных целых чисел.

     Example:
         Примеры вызовов
    """
```

**Описание**: Шифрует данные, представленные в виде списка 32-битных целых чисел, с использованием AES в режиме CBC.

**Как работает функция**: Функция сначала преобразует входные списки 32-битных целых чисел в строки с помощью `a32_to_str`. Затем она шифрует данные с помощью `aes_cbc_encrypt` и преобразует зашифрованные данные обратно в список 32-битных целых чисел с помощью `str_to_a32`.

**Параметры**:
- `data` (List[int]): Данные для шифрования в виде списка 32-битных целых чисел.
- `key` (List[int]): Ключ шифрования в виде списка 32-битных целых чисел.

**Возвращает**:
- `List[int]: Зашифрованные данные в виде списка 32-битных целых чисел.

### `str_to_a32`

```python
def str_to_a32(b):
    """This if example function
    Args:
        b (str | bytes): Строка или байты для преобразования.

    Returns:
        Tuple[int]: Кортеж 32-битных целых чисел, полученный из строки.

     Example:
         Примеры вызовов
    """
```

**Описание**: Преобразует строку в кортеж 32-битных целых чисел.

**Как работает функция**: Функция принимает строку или байты, добавляет нулевую кодировку, если длина не кратна 4, и использует `struct.unpack` для преобразования строки в кортеж 32-битных целых чисел.

**Параметры**:
- `b` (str | bytes): Строка для преобразования.

**Возвращает**:
- `Tuple[int]`: Кортеж 32-битных целых чисел, полученный из строки.

### `mpi2int`

```python
def mpi2int(s):
    """This if example function
    Args:
        s (bytes): Последовательность байтов, представляющая целое число в формате MPI.

    Returns:
        int: Целое число, полученное из MPI-представления.

     Example:
         Примеры вызовов
    """
```

**Описание**: Преобразует целое число в формате MPI (Multi-Precision Integer) в обычное целое число.

**Как работает функция**: Функция принимает последовательность байтов, представляющую целое число в формате MPI, извлекает шестнадцатеричное представление значения и преобразует его в целое число.

**Параметры**:
- `s` (bytes): Последовательность байтов, представляющая целое число в формате MPI (должна начинаться с двух байтов, указывающих длину числа).

**Возвращает**:
- `int`: Целое число, полученное из MPI-представления.

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """This if example function
    Args:
        data (bytes): Данные для дешифрования.
        key (bytes): Ключ дешифрования.

    Returns:
        bytes: Дешифрованные данные.

     Example:
         Примеры вызовов
    """
```

**Описание**: Дешифрует данные с использованием AES в режиме CBC.

**Как работает функция**: Функция создает объект дешифрования AES с использованием предоставленного ключа и режима CBC. Затем она дешифрует предоставленные данные и возвращает дешифрованный результат.

**Параметры**:
- `data` (bytes): Данные для дешифрования.
- `key` (bytes): Ключ дешифрования.

**Возвращает**:
- `bytes`: Дешифрованные данные.

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """This if example function
    Args:
        data (List[int]): Данные для дешифрования в виде списка 32-битных целых чисел.
        key (List[int]): Ключ дешифрования в виде списка 32-битных целых чисел.

    Returns:
        List[int]: Дешифрованные данные в виде списка 32-битных целых чисел.

     Example:
         Примеры вызовов
    """
```

**Описание**: Дешифрует данные, представленные в виде списка 32-битных целых чисел, с использованием AES в режиме CBC.

**Как работает функция**: Функция сначала преобразует входные списки 32-битных целых чисел в строки с помощью `a32_to_str`. Затем она дешифрует данные с помощью `aes_cbc_decrypt` и преобразует дешифрованные данные обратно в список 32-битных целых чисел с помощью `str_to_a32`.

**Параметры**:
- `data` (List[int]): Данные для дешифрования в виде списка 32-битных целых чисел.
- `key` (List[int]): Ключ дешифрования в виде списка 32-битных целых чисел.

**Возвращает**:
- `List[int]`: Дешифрованные данные в виде списка 32-битных целых чисел.

### `base64urldecode`

```python
def base64urldecode(data):
    """This if example function
    Args:
        data (str): Строка в формате base64url.

    Returns:
        bytes: Декодированные данные.

     Example:
         Примеры вызовов
    """
```

**Описание**: Декодирует строку в формате base64url.

**Как работает функция**: Функция принимает строку base64url, добавляет недостающие символы '=', заменяет символы '-' на '+', '_' на '/', и ',' на '' (удаляет), а затем декодирует строку с помощью `base64.b64decode`.

**Параметры**:
- `data` (str): Строка в формате base64url.

**Возвращает**:
- `bytes`: Декодированные данные.

### `base64_to_a32`

```python
def base64_to_a32(s):
    """This if example function
    Args:
        s (str): Строка в формате base64url.

    Returns:
        Tuple[int]: Кортеж 32-битных целых чисел, полученный из base64url-строки.

     Example:
         Примеры вызовов
    """
```

**Описание**: Преобразует строку в формате base64url в кортеж 32-битных целых чисел.

**Как работает функция**: Функция сначала декодирует base64url-строку с помощью `base64urldecode`, а затем преобразует полученные байты в кортеж 32-битных целых чисел с помощью `str_to_a32`.

**Параметры**:
- `s` (str): Строка в формате base64url.

**Возвращает**:
- `Tuple[int]`: Кортеж 32-битных целых чисел, полученный из base64url-строки.

### `base64urlencode`

```python
def base64urlencode(data):
    """This if example function
    Args:
        data (bytes): Данные для кодирования.

    Returns:
        str: Строка в формате base64url.

     Example:
         Примеры вызовов
    """
```

**Описание**: Кодирует данные в формат base64url.

**Как работает функция**: Функция принимает данные, кодирует их в base64, заменяет символы '+', '/' и '=' на '-', '_' и '' соответственно, и возвращает закодированную строку.

**Параметры**:
- `data` (bytes): Данные для кодирования.

**Возвращает**:
- `str`: Строка в формате base64url.

### `a32_to_base64`

```python
def a32_to_base64(a):
    """This if example function
    Args:
        a (List[int]): Список 32-битных целых чисел.

    Returns:
        str: Строка в формате base64url, полученная из списка 32-битных целых чисел.

     Example:
         Примеры вызовов
    """
```

**Описание**: Преобразует список 32-битных целых чисел в строку в формате base64url.

**Как работает функция**: Функция сначала преобразует список 32-битных целых чисел в строку с помощью `a32_to_str`, а затем кодирует полученную строку в формат base64url с помощью `base64urlencode`.

**Параметры**:
- `a` (List[int]): Список 32-битных целых чисел.

**Возвращает**:
- `str`: Строка в формате base64url, полученная из списка 32-битных целых чисел.

### `get_chunks`

```python
def get_chunks(size):
    """This if example function
    Args:
        size (int): Общий размер данных.

    Returns:
        Dict[int, int]: Словарь, где ключ - начальная позиция чанка, а значение - его размер.

     Example:
         Примеры вызовов
    """
```

**Описание**: Разбивает данные на чанки разных размеров для параллельной загрузки.

**Как работает функция**: Функция принимает общий размер данных и разбивает их на чанки разных размеров. Первые чанки имеют размер, кратный `0x20000`, а остальные - `0x100000`. Последний чанк может иметь размер меньше `0x100000`. Функция возвращает словарь, где ключ - начальная позиция чанка, а значение - его размер.

**Параметры**:
- `size` (int): Общий размер данных.

**Возвращает**:
- `Dict[int, int]`: Словарь, где ключ - начальная позиция чанка, а значение - его размер.