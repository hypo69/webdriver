# Модуль crypto

## Обзор

Модуль `crypto.py` содержит функции для выполнения криптографических операций, используемых в Mega API. Он включает в себя функции шифрования и дешифрования AES в режиме CBC, хеширования строк и подготовки ключей.

## Подробней

Этот модуль предоставляет криптографические функции, необходимые для обеспечения безопасности данных при взаимодействии с сервисом Mega. Он включает в себя шифрование и дешифрование данных, хеширование строк для идентификации файлов и подготовку ключей для защиты информации.

## Функции

### `aes_cbc_encrypt`

```python
def aes_cbc_encrypt(data, key):
    """
    """
```

**Описание**: Шифрует данные с использованием алгоритма AES в режиме CBC.

**Как работает функция**:
1. Инициализирует объект шифрования AES с заданным ключом и режимом CBC, используя нулевой вектор инициализации.
2. Шифрует входные данные с использованием созданного объекта шифрования.

**Параметры**:
- `data` (bytes): Данные для шифрования.
- `key` (bytes): Ключ шифрования.

**Возвращает**:
- `bytes`: Зашифрованные данные.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
key = b'\\0' * 16
data = b'test data'
encrypted_data = aes_cbc_encrypt(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt`

```python
def aes_cbc_decrypt(data, key):
    """
    """
```

**Описание**: Дешифрует данные, зашифрованные алгоритмом AES в режиме CBC.

**Как работает функция**:
1. Инициализирует объект дешифрования AES с заданным ключом и режимом CBC, используя нулевой вектор инициализации.
2. Дешифрует входные данные с использованием созданного объекта дешифрования.

**Параметры**:
- `data` (bytes): Зашифрованные данные для дешифрования.
- `key` (bytes): Ключ дешифрования.

**Возвращает**:
- `bytes`: Дешифрованные данные.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
key = b'\\0' * 16
encrypted_data = b'\\x8ep\\xb6\\xafW\\x0f\\xbc\\xc1\\x1d\\x1b\\xb6F\\xbb\\xa8\\xa5'
decrypted_data = aes_cbc_decrypt(encrypted_data, key)
print(decrypted_data)
```

### `aes_cbc_encrypt_a32`

```python
def aes_cbc_encrypt_a32(data, key):
    """
    """
```

**Описание**: Шифрует данные в формате a32 с использованием алгоритма AES в режиме CBC.

**Как работает функция**:
1. Преобразует входные данные и ключ из формата a32 в строку байтов.
2. Шифрует преобразованные данные с использованием функции `aes_cbc_encrypt`.
3. Преобразует зашифрованные данные обратно в формат a32.

**Параметры**:
- `data` (list[int]): Данные для шифрования в формате a32.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `list[int]`: Зашифрованные данные в формате a32.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
encrypted_data = aes_cbc_encrypt_a32(data, key)
print(encrypted_data)
```

### `aes_cbc_decrypt_a32`

```python
def aes_cbc_decrypt_a32(data, key):
    """
    """
```

**Описание**: Дешифрует данные в формате a32, зашифрованные алгоритмом AES в режиме CBC.

**Как работает функция**:
1. Преобразует входные данные и ключ из формата a32 в строку байтов.
2. Дешифрует преобразованные данные с использованием функции `aes_cbc_decrypt`.
3. Преобразует дешифрованные данные обратно в формат a32.

**Параметры**:
- `data` (list[int]): Зашифрованные данные для дешифрования в формате a32.
- `key` (list[int]): Ключ дешифрования в формате a32.

**Возвращает**:
- `list[int]`: Дешифрованные данные в формате a32.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
data = [1, 2, 3, 4]
key = [5, 6, 7, 8]
decrypted_data = aes_cbc_decrypt_a32(data, key)
print(decrypted_data)
```

### `stringhash`

```python
def stringhash(s, aeskey):
    """
    """
```

**Описание**: Вычисляет хеш строки с использованием AES в режиме CBC.

**Как работает функция**:
1. Преобразует входную строку в формат a32.
2. Инициализирует хеш-значение `h32` нулями.
3. Выполняет XOR для каждого элемента преобразованной строки с элементами `h32`.
4. Выполняет 0x4000 итераций шифрования `h32` с использованием AES в режиме CBC и заданного ключа.
5. Преобразует первые два элемента `h32` в base64.

**Параметры**:
- `s` (str): Входная строка для хеширования.
- `aeskey` (list[int]): Ключ AES в формате a32.

**Возвращает**:
- `str`: Хеш строки в формате base64.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
s = 'example string'
aeskey = [1, 2, 3, 4]
hash_value = stringhash(s, aeskey)
print(hash_value)
```

### `prepare_key`

```python
def prepare_key(a):
    """
    """
```

**Описание**: Подготавливает ключ для шифрования.

**Как работает функция**:
1. Инициализирует `pkey` константами.
2. Выполняет 0x10000 итераций:
   - Разделяет входной массив `a` на блоки по 4 элемента.
   - Шифрует `pkey` с использованием AES в режиме CBC и текущего блока.

**Параметры**:
- `a` (list[int]): Входной массив для подготовки ключа.

**Возвращает**:
- `list[int]`: Подготовленный ключ.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
prepared_key = prepare_key(a)
print(prepared_key)
```

### `encrypt_key`

```python
def encrypt_key(a, key):
    """
    """
```

**Описание**: Шифрует ключ.

**Как работает функция**:
1. Разделяет входной массив `a` на блоки по 4 элемента.
2. Шифрует каждый блок с использованием AES в режиме CBC и заданного ключа.
3. Объединяет зашифрованные блоки в один массив.

**Параметры**:
- `a` (list[int]): Ключ для шифрования.
- `key` (list[int]): Ключ шифрования.

**Возвращает**:
- `list[int]`: Зашифрованный ключ.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
encrypted_key = encrypt_key(a, key)
print(encrypted_key)
```

### `decrypt_key`

```python
def decrypt_key(a, key):
    """
    """
```

**Описание**: Дешифрует ключ.

**Как работает функция**:
1. Разделяет входной массив `a` на блоки по 4 элемента.
2. Дешифрует каждый блок с использованием AES в режиме CBC и заданного ключа.
3. Объединяет дешифрованные блоки в один массив.

**Параметры**:
- `a` (list[int]): Ключ для дешифрования.
- `key` (list[int]): Ключ дешифрования.

**Возвращает**:
- `list[int]`: Дешифрованный ключ.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
a = [1, 2, 3, 4, 5, 6, 7, 8]
key = [9, 10, 11, 12]
decrypted_key = decrypt_key(a, key)
print(decrypted_key)
```

### `enc_attr`

```python
def enc_attr(attr, key):
    """
    """
```

**Описание**: Шифрует атрибуты с использованием AES в режиме CBC.

**Как работает функция**:
1. Преобразует входной атрибут в JSON-строку и добавляет префикс 'MEGA'.
2. Дополняет строку нулевыми символами до кратной длины 16 байт.
3. Шифрует полученную строку с использованием AES в режиме CBC и заданного ключа.

**Параметры**:
- `attr` (dict): Атрибуты для шифрования.
- `key` (list[int]): Ключ шифрования в формате a32.

**Возвращает**:
- `bytes`: Зашифрованные атрибуты.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
attr = {'name': 'example', 'size': 1024}
key = [1, 2, 3, 4]
encrypted_attr = enc_attr(attr, key)
print(encrypted_attr)
```

### `dec_attr`

```python
def dec_attr(attr, key):
    """
    """
```

**Описание**: Дешифрует атрибуты, зашифрованные с использованием AES в режиме CBC.

**Как работает функция**:
1. Дешифрует входные данные с использованием AES в режиме CBC и заданного ключа.
2. Удаляет нулевые символы в конце строки и префикс 'MEGA'.
3. Преобразует полученную строку из JSON в словарь.

**Параметры**:
- `attr` (bytes): Зашифрованные атрибуты.
- `key` (list[int]): Ключ дешифрования в формате a32.

**Возвращает**:
- `dict`: Дешифрованные атрибуты.

**Вызывает исключения**:
- Отсутствуют явные исключения.

**Примеры**:
```python
attr = b'J\\xb6\\xafW\\x0f\\xbc\\xc1\\x1d\\x1b\\xb6F\\xbb\\xa8\\xa5'
key = [1, 2, 3, 4]
decrypted_attr = dec_attr(attr, key)
print(decrypted_attr)