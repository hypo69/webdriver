# Модуль для тестирования TinyWorld
=================================================

Модуль содержит тесты для проверки функциональности класса `TinyWorld`, включая запуск симуляций, рассылку сообщений и кодирование/декодирование состояния мира.

## Обзор

Этот модуль содержит набор тестов, которые проверяют различные аспекты работы класса `TinyWorld`, используемого для моделирования взаимодействий агентов в симулированной среде. Тесты охватывают запуск симуляций с агентами, рассылку сообщений агентам и сохранение/восстановление состояния мира.

## Подробней

Модуль использует библиотеку `pytest` для организации и запуска тестов. Он проверяет основные функции класса `TinyWorld`, такие как:

- Запуск симуляции с пустым миром и миром, населенным агентами.
- Рассылка сообщений всем агентам в мире и проверка получения этих сообщений каждым агентом.
- Кодирование полного состояния мира в словарь и декодирование этого словаря обратно в объект `TinyWorld`.

## Классы

В данном модуле классы не определены.

## Функции

### `test_run`

```python
def test_run(setup, focus_group_world):
    """
    Проверяет запуск симуляции в TinyWorld.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
        focus_group_world: Фикстура pytest, представляющая мир с агентами.

    Raises:
        AssertionError: Если агенты взаимодействуют сами с собой в сообщениях.

    Example:
        test_run(setup_fixture, focus_group_world_fixture)
    """
```

**Назначение**: Проверяет корректность запуска симуляции в `TinyWorld` как для пустого мира, так и для мира с агентами. Также проверяет целостность разговоров между агентами.

**Параметры**:
- `setup`: Фикстура `pytest` для настройки тестовой среды.
- `focus_group_world`: Фикстура `pytest`, представляющая мир с агентами для тестирования.

**Возвращает**: Ничего. Функция проверяет утверждения и вызывает исключение `AssertionError` в случае неудачи.

**Вызывает исключения**:
- `AssertionError`: Если целевой агент в сообщении совпадает с отправителем.

**Как работает функция**:

1.  Создает экземпляр `TinyWorld` с пустым названием и списком агентов (`world_1`).
2.  Запускает симуляцию `world_1` на 2 шага.
3.  Создает экземпляр `TinyWorld`, используя фикстуру `focus_group_world` (`world_2`).
4.  Рассылает сообщение всем агентам в `world_2` с просьбой обсудить идеи для нового AI-продукта.
5.  Запускает симуляцию `world_2` на 2 шага.
6.  Проходит по всем агентам в `world_2` и извлекает все сообщения из их эпизодической памяти.
7.  Проверяет, что ни один агент не является целевым агентом в своих собственных сообщениях.
8.  TODO: добавить проверку целостности стимулов.

**ASII flowchart**:

```
Создание пустого мира (world_1)  --> Запуск симуляции world_1
                                   ↓
Создание мира с агентами (world_2) --> Рассылка сообщения агентам
                                   ↓
                             Запуск симуляции world_2 --> Проверка целостности сообщений
```

**Примеры**:

```python
# Пример использования фикстур pytest для вызова функции test_run
test_run(setup_fixture, focus_group_world_fixture)
```

### `test_broadcast`

```python
def test_broadcast(setup, focus_group_world):
    """
    Проверяет рассылку сообщений агентам в TinyWorld.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
        focus_group_world: Фикстура pytest, представляющая мир с агентами.

    Raises:
        AssertionError: Если агенты не получают широковещательное сообщение.

    Example:
        test_broadcast(setup_fixture, focus_group_world_fixture)
    """
```

**Назначение**: Проверяет, что широковещательные сообщения успешно доставляются всем агентам в `TinyWorld`.

**Параметры**:
- `setup`: Фикстура `pytest` для настройки тестовой среды.
- `focus_group_world`: Фикстура `pytest`, представляющая мир с агентами для тестирования.

**Возвращает**: Ничего. Функция проверяет утверждения и вызывает исключение `AssertionError` в случае неудачи.

**Вызывает исключения**:
- `AssertionError`: Если агент не получил широковещательное сообщение.

**Как работает функция**:

1.  Получает мир с агентами из фикстуры `focus_group_world`.
2.  Рассылает сообщение всем агентам с запросом на мозговой штурм идей для нового детского продукта.
3.  Проходит по всем агентам в мире.
4.  Проверяет, что каждый агент получил сообщение, проверив его эпизодическую память.

**ASII flowchart**:

```
Получение мира с агентами (focus_group_world) --> Рассылка широковещательного сообщения
                                             ↓
                                       Проверка получения сообщения каждым агентом
```

**Примеры**:

```python
# Пример использования фикстур pytest для вызова функции test_broadcast
test_broadcast(setup_fixture, focus_group_world_fixture)
```

### `test_encode_complete_state`

```python
def test_encode_complete_state(setup, focus_group_world):
    """
    Проверяет кодирование полного состояния TinyWorld.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
        focus_group_world: Фикстура pytest, представляющая мир с агентами.

    Raises:
        AssertionError: Если состояние мира не кодируется корректно.

    Example:
        test_encode_complete_state(setup_fixture, focus_group_world_fixture)
    """
```

**Назначение**: Проверяет, что состояние `TinyWorld` может быть закодировано в словарь.

**Параметры**:
- `setup`: Фикстура `pytest` для настройки тестовой среды.
- `focus_group_world`: Фикстура `pytest`, представляющая мир с агентами для тестирования.

**Возвращает**: Ничего. Функция проверяет утверждения и вызывает исключение `AssertionError` в случае неудачи.

**Вызывает исключения**:
- `AssertionError`: Если закодированное состояние мира равно `None`, не содержит имя мира или не содержит агентов.

**Как работает функция**:

1.  Получает мир с агентами из фикстуры `focus_group_world`.
2.  Кодирует полное состояние мира в словарь `state`.
3.  Проверяет, что `state` не равен `None`.
4.  Проверяет, что имя в `state` соответствует имени мира.
5.  Проверяет, что `state` содержит агентов.

**ASII flowchart**:

```
Получение мира с агентами (focus_group_world) --> Кодирование состояния мира
                                             ↓
                                      Проверка корректности закодированного состояния
```

**Примеры**:

```python
# Пример использования фикстур pytest для вызова функции test_encode_complete_state
test_encode_complete_state(setup_fixture, focus_group_world_fixture)
```

### `test_decode_complete_state`

```python
def test_decode_complete_state(setup, focus_group_world):
    """
    Проверяет декодирование полного состояния TinyWorld.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
        focus_group_world: Фикстура pytest, представляющая мир с агентами.

    Raises:
        AssertionError: Если состояние мира не декодируется корректно.

    Example:
        test_decode_complete_state(setup_fixture, focus_group_world_fixture)
    """
```

**Назначение**: Проверяет, что состояние `TinyWorld`, закодированное в словарь, может быть успешно декодировано обратно в объект `TinyWorld`.

**Параметры**:
- `setup`: Фикстура `pytest` для настройки тестовой среды.
- `focus_group_world`: Фикстура `pytest`, представляющая мир с агентами для тестирования.

**Возвращает**: Ничего. Функция проверяет утверждения и вызывает исключение `AssertionError` в случае неудачи.

**Вызывает исключения**:
- `AssertionError`: Если декодированный мир равен `None`, не имеет исходное имя или имеет неверное количество агентов.

**Как работает функция**:

1.  Получает мир с агентами из фикстуры `focus_group_world`.
2.  Сохраняет имя и количество агентов в мире.
3.  Кодирует состояние мира в словарь `state`.
4.  Изменяет имя мира и очищает список агентов.
5.  Декодирует состояние из `state` обратно в мир (`world_2`).
6.  Проверяет, что `world_2` не равен `None`.
7.  Проверяет, что имя `world_2` соответствует исходному имени.
8.  Проверяет, что количество агентов в `world_2` соответствует исходному количеству агентов.

**ASII flowchart**:

```
Получение мира с агентами (focus_group_world) --> Кодирование состояния мира
                                             ↓
                                   Изменение имени и очистка списка агентов
                                             ↓
                                       Декодирование состояния мира
                                             ↓
                                      Проверка корректности декодированного состояния
```

**Примеры**:

```python
# Пример использования фикстур pytest для вызова функции test_decode_complete_state
test_decode_complete_state(setup_fixture, focus_group_world_fixture)