# Модуль тестирования класса `TinyPerson`

## Обзор

Модуль содержит юнит-тесты для класса `TinyPerson`, используемого в проекте `hypotez`.
Тесты проверяют различные аспекты поведения агентов, такие как взаимодействие, восприятие, мышление, целеполагание и перемещение.
Этот модуль предназначен для проверки правильности работы агентов `TinyPerson` в различных сценариях.

## Подробнее

Модуль содержит набор тестов, которые охватывают основные функциональные возможности агентов `TinyPerson`. Каждый тест проверяет определенный аспект поведения агента, например:

- `test_act`: Проверяет способность агента выполнять действия в ответ на стимулы.
- `test_listen`: Проверяет способность агента воспринимать речь и обновлять свои сообщения.
- `test_define`: Проверяет способность агента определять значения конфигурации и обновлять свой промпт.
- `test_socialize`: Проверяет способность агента взаимодействовать с другими агентами.
- `test_see`: Проверяет способность агента воспринимать визуальные стимулы.
- `test_think`: Проверяет способность агента мыслить о чем-либо.
- `test_internalize_goal`: Проверяет способность агента усваивать цели.
- `test_move_to`: Проверяет способность агента перемещаться в новое местоположение.
- `test_change_context`: Проверяет способность агента изменять контекст.
- `test_save_specification`: Проверяет способность агента сохранять свою спецификацию в файл.
- `test_programmatic_definitions`: Проверяет способность агента программно определять параметры.

## Классы

В этом модуле нет классов, но он использует класс `TinyPerson` из модуля `tinytroupe`.

## Функции

### `test_act`

```python
def test_act(setup):
    """
    Проверяет, что агент выполняет действия в ответ на стимул.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Вызывает метод `listen_and_act` для каждого агента, передавая сообщение "Tell me a bit about your life." и запрашивая возвращение списка действий.
3.  Логирует текущие взаимодействия агента с помощью `logger.info(agent.pp_current_interactions())`.
4.  Проверяет, что агент выполняет хотя бы одно действие (`len(actions) >= 1`). Даже если это просто `DONE`.
5.  Проверяет, что среди действий есть действие типа `TALK`.
6.  Проверяет, что действия завершаются действием типа `DONE`.

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Запрос действий у агента ("Tell me a bit about your life")
    |
    C - Логирование текущих взаимодействий агента
    |
    D - Проверка наличия действий
    |
    E - Проверка наличия действия TALK
    |
    F - Проверка завершения действий действием DONE
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_act(setup)
```

### `test_listen`

```python
def test_listen(setup):
    """
    Проверяет, что агент воспринимает речь и обновляет свои сообщения.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Вызывает метод `listen` для каждого агента, передавая сообщение "Hello, how are you?".
3.  Проверяет, что у агента есть хотя бы одно сообщение в списке `current_messages`.
4.  Проверяет, что последнее сообщение в `episodic_memory` имеет роль `'user'`.
5.  Проверяет, что последнее сообщение содержит стимул типа `'CONVERSATION'`.
6.  Проверяет, что содержание последнего сообщения соответствует переданному тексту.

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент слушает сообщение ("Hello, how are you?")
    |
    C - Проверка наличия сообщений у агента
    |
    D - Проверка роли последнего сообщения (user)
    |
    E - Проверка типа стимула в последнем сообщении (CONVERSATION)
    |
    F - Проверка содержания последнего сообщения
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_listen(setup)
```

### `test_define`

```python
def test_define(setup):
    """
    Проверяет, что агент определяет значение конфигурации и сбрасывает свой промпт.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Сохраняет оригинальный промпт агента.
3.  Вызывает метод `define` для установки значения `'age'` равным `25`.
4.  Проверяет, что значение `'age'` установлено в конфигурации агента (`_persona`).
5.  Проверяет, что промпт агента изменился.
6.  Проверяет, что новый промпт содержит значение `'25'`.

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Сохранение оригинального промпта агента
    |
    C - Определение нового значения (age = 25)
    |
    D - Проверка значения age в конфигурации
    |
    E - Проверка изменения промпта
    |
    F - Проверка наличия нового значения в промпте
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_define(setup)
```

### `test_define_several`

```python
def test_define_several(setup):
    """
    Проверяет, что определение нескольких значений для группы работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Вызывает метод `define` для установки списка навыков (`"skills"`) агента.
3.  Проверяет, что каждый навык присутствует в конфигурации агента.

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Определение списка навыков (skills)
    |
    C - Проверка наличия каждого навыка в конфигурации
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_define_several(setup)
```

### `test_socialize`

```python
def test_socialize(setup):
    """
    Проверяет, что социализация с другим агентом работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Создает двух агентов: `an_oscar` и `a_lisa`.
2.  Перебирает агентов.
3.  Определяет другого агента для социализации.
4.  Делает другого агента доступным для текущего агента с помощью метода `make_agent_accessible`.
5.  Агент "слушает" приветствие от другого агента.
6.  Агент выполняет действия.
7.  Проверяет, что агент выполняет хотя бы одно действие.
8.  Проверяет, что среди действий есть действие типа `TALK`.
9.  Проверяет, что в действии `TALK` упоминается имя другого агента.

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Определение другого агента для социализации
    |
    C - Делаем агента доступным для другого агента
    |
    D - Агент "слушает" приветствие
    |
    E - Агент выполняет действия
    |
    F - Проверка наличия действий
    |
    G - Проверка наличия действия TALK
    |
    H - Проверка упоминания имени другого агента в действии TALK
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_socialize(setup)
```

### `test_see`

```python
def test_see(setup):
    """
    Проверяет, что восприятие визуального стимула работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Агент "видит" визуальный стимул ("A beautiful sunset over the ocean.").
3.  Агент выполняет действия.
4.  Проверяет, что агент выполняет хотя бы одно действие.
5.  Проверяет, что среди действий есть действие типа `THINK`.
6.  Проверяет, что в действии `THINK` упоминается "sunset".

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент "видит" визуальный стимул
    |
    C - Агент выполняет действия
    |
    D - Проверка наличия действий
    |
    E - Проверка наличия действия THINK
    |
    F - Проверка упоминания "sunset" в действии THINK
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_see(setup)
```

### `test_think`

```python
def test_think(setup):
    """
    Проверяет, что размышление о чем-либо работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Агент "думает" о чем-то ("I will tell everyone right now how awesome life is!").
3.  Агент выполняет действия.
4.  Проверяет, что агент выполняет хотя бы одно действие.
5.  Проверяет, что среди действий есть действие типа `TALK`.
6.  Проверяет, что в действии `TALK` упоминается "life".

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент "думает" о чем-то
    |
    C - Агент выполняет действия
    |
    D - Проверка наличия действий
    |
    E - Проверка наличия действия TALK
    |
    F - Проверка упоминания "life" в действии TALK
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_think(setup)
```

### `test_internalize_goal`

```python
def test_internalize_goal(setup):
    """
    Проверяет, что усвоение цели работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Агент усваивает цель ("I want to compose in my head a wonderful poem about how cats are glorious creatures.").
3.  Агент выполняет действия.
4.  Проверяет, что агент выполняет хотя бы одно действие.
5.  Проверяет, что среди действий есть действие типа `THINK`.
6.  Проверяет, что в действии `THINK` упоминаются "cats".

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент усваивает цель
    |
    C - Агент выполняет действия
    |
    D - Проверка наличия действий
    |
    E - Проверка наличия действия THINK
    |
    F - Проверка упоминания "cats" в действии THINK
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_internalize_goal(setup)
```

### `test_move_to`

```python
def test_move_to(setup):
    """
    Проверяет, что перемещение в новое местоположение работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Агент перемещается в "New York" с контекстом `["city", "busy", "diverse"]`.
3.  Проверяет, что текущее местоположение агента - "New York".
4.  Проверяет, что контекст агента содержит "city", "busy" и "diverse".

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент перемещается в "New York" с контекстом
    |
    C - Проверка текущего местоположения
    |
    D - Проверка контекста
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_move_to(setup)
```

### `test_change_context`

```python
def test_change_context(setup):
    """
    Проверяет, что изменение контекста работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Агент изменяет контекст на `["home", "relaxed", "comfortable"]`.
3.  Проверяет, что контекст агента содержит "home", "relaxed" и "comfortable".

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Агент изменяет контекст
    |
    C - Проверка контекста
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_change_context(setup)
```

### `test_save_specification`

```python
def test_save_specification(setup):
    """
    Проверяет, что сохранение спецификации агента работает как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect()` и `create_lisa_the_data_scientist()`.
2.  Сохраняет спецификацию агента в файл с помощью метода `save_specification`.
3.  Проверяет, что файл существует.
4.  Загружает спецификацию из файла с новым именем агента.
5.  Проверяет, что имя загруженного агента соответствует новому имени.
6.  Проверяет, что конфигурация загруженного агента совпадает с конфигурацией оригинального агента (за исключением имени).

```
    A - Создание агентов (Oscar, Lisa)
    |
    B - Сохранение спецификации агента в файл
    |
    C - Проверка существования файла
    |
    D - Загрузка спецификации из файла с новым именем
    |
    E - Проверка имени загруженного агента
    |
    F - Проверка конфигурации загруженного агента
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_save_specification(setup)
```

### `test_programmatic_definitions`

```python
def test_programmatic_definitions(setup):
    """
    Проверяет, что программные определения работают как ожидается.

    Args:
        setup: Фикстура pytest для настройки тестовой среды.
    """
```

**Как работает функция**:

1.  Перебирает предопределенных агентов: `create_oscar_the_architect_2()` и `create_lisa_the_data_scientist_2()`.  Эти агенты создаются с использованием программных определений.
2.  Вызывает метод `listen_and_act` для каждого агента с запросом "Tell me a bit about your life.".

```
    A - Создание агентов (Oscar_2, Lisa_2) с программными определениями
    |
    B - Запрос действий у агента ("Tell me a bit about your life")
```

**Примеры**:

```python
# Предполагается, что 'setup' - это pytest фикстура, которая инициализирует тестовую среду
test_programmatic_definitions(setup)