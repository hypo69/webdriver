# Модуль для обогащения контента с использованием AI-моделей

## Обзор

Модуль `enrichment.py` содержит класс `TinyEnricher`, который используется для обогащения контента с использованием AI-моделей. Он позволяет добавлять контекстную информацию к заданному контенту на основе предоставленных требований.

## Подробней

В данном модуле реализован класс `TinyEnricher`, который отвечает за обогащение контента. Он использует шаблоны Mustache для формирования запросов к AI-моделям и извлекает результаты из ответов. Модуль также предоставляет возможность использовать предыдущие результаты в контексте для улучшения качества обогащения.

## Классы

### `TinyEnricher`

**Описание**: Класс `TinyEnricher` предназначен для обогащения контента с использованием AI-моделей. Он позволяет добавлять контекстную информацию к заданному контенту на основе предоставленных требований.

**Принцип работы**:
1.  Класс инициализируется с параметром `use_past_results_in_context`, который определяет, следует ли использовать предыдущие результаты в контексте.
2.  Метод `enrich_content` принимает требования, контент, тип контента, контекстную информацию и кэш контекста в качестве входных данных.
3.  Формируются сообщения для AI-модели с использованием шаблонов Mustache и предоставленных данных.
4.  Сообщения отправляются в AI-модель для получения обогащенного контента.
5.  Результат извлекается из ответа AI-модели и возвращается.

**Атрибуты**:

*   `use_past_results_in_context` (bool): Определяет, следует ли использовать предыдущие результаты в контексте.
*   `context_cache` (list): Кэш для хранения предыдущих результатов.

**Методы**:

*   `__init__(self, use_past_results_in_context=False)`: Инициализирует экземпляр класса `TinyEnricher`.
*   `enrich_content(self, requirements: str, content: str, content_type: str = None, context_info: str = "", context_cache: list = None, verbose: bool = False)`: Обогащает контент с использованием AI-модели.

## Функции

### `__init__`

```python
def __init__(self, use_past_results_in_context=False) -> None:
    """
    Инициализирует экземпляр класса `TinyEnricher`.

    Args:
        use_past_results_in_context (bool, optional): Определяет, следует ли использовать предыдущие результаты в контексте. По умолчанию `False`.

    Returns:
        None
    """
    ...
```

**Назначение**: Инициализирует экземпляр класса `TinyEnricher`.

**Параметры**:

*   `use_past_results_in_context` (bool, optional): Определяет, следует ли использовать предыдущие результаты в контексте. По умолчанию `False`.

**Возвращает**:

*   `None`

**Как работает функция**:

1.  Функция принимает параметр `use_past_results_in_context`, который определяет, следует ли использовать предыдущие результаты в контексте.
2.  Устанавливает значение атрибута `use_past_results_in_context` равным переданному значению.
3.  Инициализирует пустой список `context_cache` для хранения предыдущих результатов.

```
A: Принимает параметр use_past_results_in_context
|
B: Устанавливает значение атрибута use_past_results_in_context
|
C: Инициализирует пустой список context_cache
```

**Примеры**:

```python
enricher = TinyEnricher()
enricher = TinyEnricher(use_past_results_in_context=True)
```

### `enrich_content`

```python
def enrich_content(self, requirements: str, content: str, content_type: str = None, context_info: str = "", context_cache: list = None, verbose: bool = False) -> str | None:
    """
    Обогащает контент с использованием AI-модели.

    Args:
        requirements (str): Требования к обогащению контента.
        content (str): Контент, который необходимо обогатить.
        content_type (str, optional): Тип контента. По умолчанию `None`.
        context_info (str, optional): Контекстная информация. По умолчанию `""`.
        context_cache (list, optional): Кэш контекста. По умолчанию `None`.
        verbose (bool, optional): Флаг для вывода отладочной информации. По умолчанию `False`.

    Returns:
        str | None: Обогащенный контент или `None`, если обогащение не удалось.

    Raises:
        Exception: Если возникает ошибка при взаимодействии с AI-моделью.
    """
    ...
```

**Назначение**: Обогащает контент с использованием AI-модели.

**Параметры**:

*   `requirements` (str): Требования к обогащению контента.
*   `content` (str): Контент, который необходимо обогатить.
*   `content_type` (str, optional): Тип контента. По умолчанию `None`.
*   `context_info` (str, optional): Контекстная информация. По умолчанию `""`.
*   `context_cache` (list, optional): Кэш контекста. По умолчанию `None`.
*   `verbose` (bool, optional): Флаг для вывода отладочной информации. По умолчанию `False`.

**Возвращает**:

*   `str | None`: Обогащенный контент или `None`, если обогащение не удалось.

**Как работает функция**:

1.  Функция принимает требования, контент, тип контента, контекстную информацию и кэш контекста в качестве входных данных.
2.  Формирует словарь `rendering_configs`, содержащий все входные данные.
3.  Составляет сообщения для AI-модели с использованием шаблонов Mustache (`enricher.system.mustache` и `enricher.user.mustache`) и `rendering_configs`.
4.  Отправляет сообщения в AI-модель с использованием `openai_utils.client().send_message`.
5.  Извлекает обогащенный контент из ответа AI-модели с помощью `utils.extract_code_block`.
6.  Возвращает обогащенный контент или `None`, если обогащение не удалось.

```
A: Принимает требования, контент, тип контента, контекстную информацию и кэш контекста
|
B: Формирует словарь rendering_configs
|
C: Составляет сообщения для AI-модели с использованием шаблонов Mustache
|
D: Отправляет сообщения в AI-модель
|
E: Извлекает обогащенный контент из ответа AI-модели
|
F: Возвращает обогащенный контент или None
```

**Примеры**:

```python
enricher = TinyEnricher()
enriched_content = enricher.enrich_content(
    requirements="Добавить больше деталей",
    content="Это простой текст",
    content_type="text",
    context_info="Дополнительная информация"
)

if enriched_content:
    print(f"Обогащенный контент: {enriched_content}")
else:
    print("Обогащение не удалось.")