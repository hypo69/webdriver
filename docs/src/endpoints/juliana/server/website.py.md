# Модуль для управления веб-сайтом

## Обзор

Модуль `website.py` предназначен для настройки и управления маршрутами веб-сайта с использованием фреймворка Flask. Он определяет основные маршруты, такие как главная страница, чат и статические ресурсы (assets). Модуль обеспечивает перенаправление на страницу чата, генерацию уникальных идентификаторов чатов и обслуживание статических файлов, таких как CSS и JavaScript.

## Подробней

Модуль `website.py` является частью веб-сервера `juliana` в проекте `hypotez`. Он использует Flask для определения маршрутов и обработки запросов. Основная задача модуля - предоставить пользователю веб-интерфейс для взаимодействия с системой. Он обрабатывает запросы к различным URL, отображает соответствующие шаблоны HTML и предоставляет статические ресурсы.

## Классы

### `Website`

**Описание**: Класс `Website` управляет маршрутами и отображением веб-страниц. Он инициализирует приложение Flask и определяет маршруты для главной страницы, чата и статических ресурсов.

**Принцип работы**:
Класс `Website` принимает экземпляр приложения Flask в качестве аргумента и определяет набор маршрутов, каждый из которых связан с определенной функцией и HTTP-методом. При получении запроса к одному из определенных маршрутов Flask вызывает соответствующую функцию, которая обрабатывает запрос и возвращает ответ.

**Атрибуты**:
- `app`: Экземпляр приложения Flask.
- `routes` (dict): Словарь, содержащий маршруты и связанные с ними функции и методы.

**Методы**:
- `__init__(self, app)`: Инициализирует класс `Website` с заданным приложением Flask и определяет маршруты.
- `_chat(self, conversation_id)`: Обрабатывает запросы к странице чата с заданным идентификатором.
- `_index(self)`: Обрабатывает запросы к главной странице и перенаправляет на страницу чата с уникальным идентификатором.
- `_assets(self, folder: str, file: str)`: Обрабатывает запросы к статическим ресурсам (assets) и возвращает запрошенный файл.

## Функции

### `_chat`

```python
def _chat(self, conversation_id):
    """
    Обрабатывает запросы к странице чата с заданным идентификатором.

    Args:
        conversation_id (str): Идентификатор беседы.

    Returns:
        flask.Response: Ответ Flask, содержащий отображенный шаблон `index.html` или перенаправление на главную страницу, если `conversation_id` недействителен.
    """
```

**Назначение**: Функция `_chat` обрабатывает запросы к странице чата с заданным идентификатором `conversation_id`. Если идентификатор содержит символ "-", функция отображает шаблон `index.html` с указанным `chat_id`. В противном случае происходит перенаправление на главную страницу (`/chat`).

**Как работает функция**:

1.  **Проверка `conversation_id`**: Проверяется, содержит ли переданный `conversation_id` символ "-".
2.  **Отображение шаблона или перенаправление**: Если символ "-" присутствует, отображается шаблон `index.html` с передачей `conversation_id` в качестве `chat_id`. В противном случае происходит перенаправление на главную страницу `/chat`.

```
Проверка conversation_id ("-" есть?)
|
Нет --> Перенаправление на /chat
|
Да --> Отображение index.html с chat_id = conversation_id
```

**Примеры**:

- Вызов функции с валидным `conversation_id`:

```python
website._chat('1234-5678-90ab-cdef-1234567890ab')
```

- Вызов функции с невалидным `conversation_id`:

```python
website._chat('1234567890ab')
```

### `_index`

```python
def _index(self):
    """
    Обрабатывает запросы к главной странице и перенаправляет на страницу чата с уникальным идентификатором.

    Returns:
        flask.Response: Ответ Flask, содержащий перенаправление на страницу чата с уникальным идентификатором.
    """
```

**Назначение**: Функция `_index` обрабатывает запросы к главной странице (`/chat/`) и перенаправляет пользователя на страницу чата с уникальным сгенерированным идентификатором.

**Как работает функция**:

1.  **Генерация уникального ID**: Генерируется уникальный идентификатор чата на основе случайных шестнадцатеричных чисел и текущего времени в миллисекундах.
2.  **Перенаправление**: Выполняется перенаправление на страницу чата (`/chat/<conversation_id>`) с сгенерированным идентификатором.

```
Генерация уникального ID
|
Перенаправление на /chat/<conversation_id>
```

**Примеры**:

- Вызов функции для перенаправления на страницу чата с новым идентификатором:

```python
website._index()
```

### `_assets`

```python
def _assets(self, folder: str, file: str):
    """
    Обрабатывает запросы к статическим ресурсам (assets) и возвращает запрошенный файл.

    Args:
        folder (str): Название папки, содержащей файл.
        file (str): Название файла.

    Returns:
        flask.Response: Содержимое файла, если он найден, или сообщение об ошибке 404, если файл не найден.
    """
```

**Назначение**: Функция `_assets` обрабатывает запросы к статическим ресурсам, таким как файлы CSS, JavaScript и изображения. Она пытается вернуть запрошенный файл из указанной папки. В случае неудачи возвращает сообщение об ошибке 404.

**Как работает функция**:

1.  **Попытка отправки файла**: Функция пытается отправить запрошенный файл из папки `../client/{folder}/{file}`.
2.  **Обработка исключения**: Если файл не найден, перехватывается исключение и возвращается сообщение об ошибке "File not found" с кодом 404.

```
Попытка отправки файла из ../client/{folder}/{file}
|
Успех --> Возврат содержимого файла
|
Ошибка --> Возврат "File not found", 404
```

**Примеры**:

- Вызов функции для получения файла `style.css` из папки `css`:

```python
website._assets('css', 'style.css')
```

- Вызов функции для несуществующего файла:

```python
website._assets('css', 'nonexistent.css')