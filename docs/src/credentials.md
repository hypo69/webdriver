# Модуль `src.credentials`

## Обзор

Модуль `src.credentials` предназначен для загрузки и хранения учетных данных (API-ключей, паролей и т. д.) из файла базы данных KeePass `credentials.kdbx`. Также включает функцию `set_project_root` для определения корневого каталога проекта.

## Подробней

Этот модуль играет важную роль в обеспечении безопасного хранения и доступа к различным учетным данным, необходимым для работы проекта. Он использует базу данных KeePass для хранения конфиденциальной информации и предоставляет удобные методы для загрузки и использования этих данных в различных частях проекта.

## Функции

### `set_project_root`

```python
def set_project_root(marker_files: tuple = ('__root__', '.git')) -> Path:
    """
    Находит корневой каталог проекта, начиная с текущего каталога файла,
    поиск вверх и остановка в первом каталоге, содержащем любой из маркерных файлов.

    Args:
        marker_files (tuple): Имена файлов или каталогов для идентификации корневого каталога проекта.

    Returns:
        Path: Путь к корневому каталогу, если он найден, в противном случае каталог, в котором расположен скрипт.
    """
```

**Описание**: Находит корневой каталог проекта, начиная с текущего каталога файла, и выполняет поиск вверх, пока не найдет каталог, содержащий один из указанных маркерных файлов.

**Как работает функция**:
Функция начинает поиск с каталога, в котором находится текущий файл. Она поднимается вверх по дереву каталогов, проверяя каждый каталог на наличие одного из маркерных файлов (например, `pyproject.toml`, `requirements.txt`, `.git`). Как только один из этих файлов найден, функция возвращает путь к этому каталогу. Если ни один из маркерных файлов не найден, функция возвращает путь к каталогу, в котором находится скрипт.

**Параметры**:
- `marker_files` (tuple): Кортеж имен файлов или каталогов, используемых для идентификации корневого каталога проекта. По умолчанию `('__root__', '.git')`.

**Возвращает**:
- `Path`: Путь к корневому каталогу проекта, если он найден. В противном случае возвращается путь к каталогу, где расположен скрипт.

### `singleton`

```python
def singleton(cls):
    """
    Декоратор для создания класса-одиночки.

    Args:
        cls: Класс, который нужно преобразовать в одиночку.

    Returns:
        function: Функция, возвращающая экземпляр класса-одиночки.
    """
```

**Описание**: Декоратор для создания класса-одиночки.

**Как работает функция**:
Декоратор `singleton` гарантирует, что у класса будет только один экземпляр. При первом вызове он создает экземпляр класса и сохраняет его. При последующих вызовах он возвращает сохраненный экземпляр.

**Параметры**:
- `cls`: Класс, который нужно преобразовать в одиночку.

**Возвращает**:
- `function`: Функция, возвращающая экземпляр класса-одиночки.

## Классы

### `ProgramSettings`

```python
class ProgramSettings:
    """
    Класс для настроек программы. Он устанавливает основные параметры и настройки проекта.
    Он загружает конфигурацию из `config.json` и данные учетных данных из файла базы данных KeePass `credentials.kdbx`.

    Attributes:
        host_name (str): Имя хоста.
        base_dir (Path): Путь к корневому каталогу проекта.
        config (SimpleNamespace): Объект, содержащий конфигурацию проекта.
        credentials (SimpleNamespace): Объект, содержащий учетные данные.
        MODE (str): Режим работы проекта (например, 'dev', 'prod').
        path (SimpleNamespace): Объект, содержащий пути к различным каталогам проекта.
    """
```

**Описание**: Класс для хранения и управления настройками программы, включая загрузку конфигурации и учетных данных.

**Как работает класс**:
Класс `ProgramSettings` инициализирует основные параметры и настройки проекта. Он загружает конфигурацию из файла `config.json` и учетные данные из базы данных KeePass `credentials.kdbx`. Класс также предоставляет атрибуты для доступа к различным каталогам проекта.

**Атрибуты**:
- `host_name` (str): Имя хоста.
- `base_dir` (Path): Путь к корневому каталогу проекта.
- `config` (SimpleNamespace): Объект, содержащий конфигурацию проекта.
- `credentials` (SimpleNamespace): Объект, содержащий учетные данные.
- `MODE` (str): Режим работы проекта (например, 'dev', 'prod').
- `path` (SimpleNamespace): Объект, содержащий пути к различным каталогам проекта.

**Методы**:

- `__init__(self, **kwargs)`: Инициализирует экземпляр класса.
    - Загружает конфигурацию проекта из `config.json`.
    - Инициализирует атрибут `path` путями к различным каталогам проекта.
    - Вызывает `check_latest_release` для проверки новой версии проекта.
    - Загружает учетные данные из `credentials.kdbx`.

- `_load_credentials(self) -> None`: Загружает учетные данные из KeePass.

- `_open_kp(self, retry: int = 3) -> PyKeePass | None`: Открывает базу данных KeePass. Обрабатывает возможные исключения при открытии базы данных.
    ```python
    def _open_kp(self, retry: int = 3) -> PyKeePass | None:
        """
        Открывает базу данных KeePass.
        Args:
            retry (int): Количество попыток.
        """
    ```

- `_load_aliexpress_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Aliexpress из KeePass.

- `_load_openai_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные OpenAI из KeePass.

- `_load_gemini_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные GoogleAI из KeePass.

- `_load_telegram_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Telegram из KeePass.

- `_load_discord_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Discord из KeePass.

- `_load_PrestaShop_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные PrestaShop из KeePass.

- `_load_presta_translations_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные PrestaShop Translations из KeePass.

- `_load_smtp_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные SMTP из KeePass.

- `_load_facebook_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Facebook из KeePass.

- `_load_gapi_credentials(self, kp: PyKeePass) -> bool`: Загружает учетные данные Google API из KeePass.

- `now(self) -> str`: Возвращает текущую временную метку в формате, указанном в файле `config.json`.

**Возможные исключения**:

- `BinaryError`: Исключение для ошибок двоичных данных.
- `CredentialsError`: Исключение для ошибок данных учетных данных.
- `DefaultSettingsException`: Исключение для ошибок настроек по умолчанию.
- `HeaderChecksumError`: Исключение для ошибок контрольной суммы заголовка.
- `KeePassException`: Исключение для ошибок базы данных KeePass.
- `PayloadChecksumError`: Исключение для ошибок контрольной суммы полезной нагрузки.
- `UnableToSendToRecycleBin`: Исключение для ошибок отправки в корзину.
- `Exception`: Общее исключение.

## Глобальный экземпляр `ProgramSettings`

```python
# Глобальный экземпляр ProgramSettings
gs: ProgramSettings = ProgramSettings()
```

**Описание**: Глобальный экземпляр класса `ProgramSettings`, обеспечивающий доступ к настройкам и учетным данным проекта из любой точки кода.

**Как работает**:
Глобальный экземпляр `gs` создается для обеспечения доступа к настройкам проекта и учетным данным из любой части кода. Это позволяет избежать создания новых экземпляров класса `ProgramSettings` каждый раз, когда требуется доступ к настройкам или учетным данным.

**Примеры**:
В других модулях проекта можно импортировать этот глобальный экземпляр и использовать его для доступа к настройкам и учетным данным:

```python
from src import gs

# Пример использования
api_key = gs.credentials.openai.api_key
```